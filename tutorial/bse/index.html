
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Abinit documentation">
      
      
      
        <meta name="author" content="The Abinit group">
      
      
        <link rel="canonical" href="https://docs.abinit.org/tutorial/bse/">
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.6">
    
    
      
        <title>Bethe-Salpeter - abinit</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2c0c5eaf.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#ff6e42">
        
      
    
    
    

    <!--
    IMPORTANT: Don't use boostrap in particular boostrap.css since it comes into conflict with mkdocs-material theme.
    Prefer low-level tools based on Jquery or JS library such as Tippyjs to get the work done.
    -->

    <!-- Jquery from Google CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Load Jquery UI -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- Handle jQuery plugin naming conflict between jQuery UI and Bootstrap
    https://stackoverflow.com/questions/13731400/jqueryui-tooltips-are-competing-with-twitter-bootstrap
    <script>
      $.widget.bridge('uibutton', $.ui.button);
      $.widget.bridge('uitooltip', $.ui.tooltip);
    </script>
    -->

    <!-- jQuery Modal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

    <!-- Tippyjs for popovers https://atomiks.github.io/tippyjs/ -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <!-- font-awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!--Pace support. http://github.hubspot.com/pace/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/white/pace-theme-big-counter.min.css" />

    <script>
        paceOptions = {
            ajax: true,      // disabled
            document: true,  // activated
            eventLag: false  // disabled
            //target: 'article'
            //elements: {selectors: ['.my-page']}
        };
    </script>

    <!-- MathJax support
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    -->

    <!-- This version is compatible with plotly. -->
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">
    </script>

    <!-- Configure MathJax to produce automatic equation numbers http://docs.mathjax.org/en/latest/tex.html -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        //jax: ["input/TeX","output/HTML-CSS"],
        //tex2jax: {inlineMath: [['$','$']]},
        //displayAlign: "center",
        TeX: {
            equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "boldsymbol.js"],
            Macros: {
                "*": "{\\dagger}",
                "ra": "{\\rangle}",
                "la": "{\\langle}",
                // Workaround for bm package. See https://github.com/mathjax/MathJax/issues/1219
                bm: ["{\\boldsymbol #1}",1],
                // Mathcal symbols
                mcL: "{\\mathcal{L}}",
                mcG: "{\\mathcal{G}}",
                mcR: "{\\mathcal{R}}",
                mcS: "{\\mathcal{S}}",
                mcC: "{\\mathcal{C}}",
                mcO: "{\\mathcal{O}}",
                // Acronyms
                KS: "{\\text{KS}}",
                eph: "{\\text{e-ph}}",
                ee: "{\\text{e-e}}",
                phph: "{\\text{ph-ph}}",
                FM: "{\\text{FM}}",
                DW: "{\\text{DW}}",
                QP: "{\\text{QP}}",
                BZ: "{\\text{BZ}}",
                sign: "{\\text{sign}}",
                xc: "{\\text{xc}}",
                tchi: "{\\tilde\\chi}",
                // Symbols commonly used (k-points, eigenvalues ...)
                rr: "{\\bf r}",
                RR: "{\\bf R}",
                tt: "{\\bf t}",
                GG: "{\\bf G}",
                bg: "{\\bf g}",
                kk: "{\\bf k}",
                qq: "{\\bf q}",
                kq: "{\\kk + \\qq}",
                qG: "{\\bf q + G}",
                kG: "{\\bf k + G}",
                kmq: "{\\kk - \\qq}",
                kpq: "{\\kk + \\qq}",
                kpG: "{\\kk + \\GG}",
                qpG: "{\\qq + \\GG}",
                nk: "{n \\kk}",
                mk: "{, \\kk}",
                nks: "{n \\kk\\sigma}",
                mks: "{m \\kk\\sigma}",
                enk: "{\\varepsilon_\\nk}",
                emkq: "{\\varepsilon_{m\\kk+\\qq}}",
                qnu: "{\\qq \\nu}",
                wqnu: "{\\omega_{\\qnu}}",
                vnk: "{\\mathbf{v}_{n\\kk}}",
                vmkq: "{\\mathbf{v}_{m\\kk+\\qq}}",
                vnka: "{\\mathrm{v}_{n\\kk,\\alpha}}",
                vnkb: "{\\mathrm{v}_{n\\kk,\\beta}}",
                ef: "{\\varepsilon_F}",
                // EPH quantities
                gkkp: "{g_{mn\\nu}(\\kk,\\qq)}",
                gkq: "{g_{mn\\nu}(\\kk,\\qq)}",
                //\newcommand{\gkkpL}{g_{mn\nu}^\Lc(\kb,\qb)}
                // Many-body theory
                Go: "{G_0}",
                Wo: "{W_0}",
                Ueff: "{U_{\\text{eff}}}",
                Gove: "{\\overline{G}}",
                Gund: "{\\underline{G}}",
                // Greek symbols + tilde version
                ee: "{\\epsilon}",
                tee: "{\\tilde{\\epsilon}}",
                ww: "{\\omega}",
                tww: "{\\tilde\\omega}",
                dd: "{\\,\\text{d}}",
                vxc: "{v_\\xc}",
                // symrel
                Ri: "{\\mcR^{-1}}",
                Rit: "{\\mcR^{-1\\tau}}",
                // symrec
                Si: "{\\mcS^{-1}}}",
                Sit: "{\\Si^\\tau}}",
                // partial and functional derivative.
                PDER: ["{\\dfrac{\\partial #1}{\\partial #2}}", 2],
                FDER: ["{\\dfrac{\\delta #1}{\\delta #2}}", 2],
                // PAW
                tPsi: "{\\tilde\\Psi}",
                tpsi: "{\\tilde\\psi}",
                tPhi: "{\\tilde\\Phi}",
                tphi: "{\\tilde\\phi}",
                tprj: "{\\tilde p}"
            }
          }
      });
    </script>

    

    

    <!-- Load fonts used for input variables -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">

    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/gallery.css">
    
      <link rel="stylesheet" href="../../css/my_codehilite.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-116681470-1","docs.abinit.org"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#tutorial-on-bethe-salpeter-calculations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="abinit" class="md-header__button md-logo" aria-label="abinit" data-md-component="logo">
      
  <img src="../../images/logo-abinit-2015.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            abinit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Bethe-Salpeter
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    github-abinit
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        User Guides
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../topics/features/" class="md-tabs__link">
        Topics
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../variables/" class="md-tabs__link">
        Variables
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        Tutorials
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../faq/configuration_and_compilation/" class="md-tabs__link">
        FAQ
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../theory/geometry/" class="md-tabs__link">
        Theory
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../developers/git_and_gitlab/" class="md-tabs__link">
        Developers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../about/release-notes/" class="md-tabs__link">
        About
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="abinit" class="md-nav__button md-logo" aria-label="abinit" data-md-component="logo">
      
  <img src="../../images/logo-abinit-2015.png" alt="logo">

    </a>
    abinit
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    github-abinit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      <label class="md-nav__link" for="__nav_1">
        User Guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          User Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        NewUser
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/abinit/" class="md-nav__link">
        Abinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/abitk/" class="md-nav__link">
        Abitk
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/aim/" class="md-nav__link">
        Aim
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/anaddb/" class="md-nav__link">
        Anaddb
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/atdep/" class="md-nav__link">
        aTDEP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/cut3d/" class="md-nav__link">
        Cut3d
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/fold2bloch/" class="md-nav__link">
        Fold2Bloch
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/mrgddb/" class="md-nav__link">
        Mrgddb
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/mrgscr/" class="md-nav__link">
        Mrgscr
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/multibinit/" class="md-nav__link">
        Multibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/optic/" class="md-nav__link">
        Optic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/respfn/" class="md-nav__link">
        Respfn
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/spacegroup/" class="md-nav__link">
        Spacegroup
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_15" type="checkbox" id="__nav_1_15" >
      
      <label class="md-nav__link" for="__nav_1_15">
        Installation
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Installation" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_15">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        HowTo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_MacOS/" class="md-nav__link">
        MacOS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_Ubuntu/" class="md-nav__link">
        Ubuntu
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_CentOS/" class="md-nav__link">
        CentOS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_EasyBuild/" class="md-nav__link">
        EasyBuild
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_gpu/" class="md-nav__link">
        GPUs
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Topics
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Topics" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Topics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/features/" class="md-nav__link">
        Features
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/" class="md-nav__link">
        Topic List
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Abipy/" class="md-nav__link">
        Abipy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/APPA/" class="md-nav__link">
        APPA
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Artificial/" class="md-nav__link">
        Artificial
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/aTDEP/" class="md-nav__link">
        aTDEP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/AtomCentered/" class="md-nav__link">
        AtomCentered
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/AtomManipulator/" class="md-nav__link">
        AtomManipulator
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/AtomTypes/" class="md-nav__link">
        AtomTypes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Bader/" class="md-nav__link">
        Bader
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Band2eps/" class="md-nav__link">
        Band2eps
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Berry/" class="md-nav__link">
        Berry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/BandOcc/" class="md-nav__link">
        BandOcc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/BSE/" class="md-nav__link">
        BSE
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/BoundingProcess/" class="md-nav__link">
        BoundingProcess
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ConstrainedDFT/" class="md-nav__link">
        ConstrainedDFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ConstrainedPol/" class="md-nav__link">
        ConstrainedPol
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Control/" class="md-nav__link">
        Control
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Coulomb/" class="md-nav__link">
        Coulomb
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/CrossingBarriers/" class="md-nav__link">
        CrossingBarriers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/CalcUJ/" class="md-nav__link">
        CalcUJ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/crystal/" class="md-nav__link">
        Crystal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DFT%2BU/" class="md-nav__link">
        DFT+U
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DeltaSCF/" class="md-nav__link">
        DeltaSCF
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DensityPotential/" class="md-nav__link">
        DensityPotential
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Dev/" class="md-nav__link">
        Dev
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DFPT/" class="md-nav__link">
        DFPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DMFT/" class="md-nav__link">
        DMFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DynamicsMultibinit/" class="md-nav__link">
        DynamicsMultibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/EffectiveMass/" class="md-nav__link">
        EffectiveMass
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/EFG/" class="md-nav__link">
        EFG
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Elastic/" class="md-nav__link">
        Elastic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElPhonInt/" class="md-nav__link">
        ElPhonInt
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElPhonTransport/" class="md-nav__link">
        ElPhonTransport
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElecDOS/" class="md-nav__link">
        ElecDOS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElecBandStructure/" class="md-nav__link">
        ElecBandStructure
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ExtFPMD/" class="md-nav__link">
        ExtFPMD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/FileFormats/" class="md-nav__link">
        FileFormats
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/FitProcess/" class="md-nav__link">
        FitProcess
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ForcesStresses/" class="md-nav__link">
        ForcesStresses
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/FrequencyMeshMBPT/" class="md-nav__link">
        FrequencyMeshMBPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GeoConstraints/" class="md-nav__link">
        GeoConstraints
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GeoOpt/" class="md-nav__link">
        GeoOpt
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Git/" class="md-nav__link">
        Git
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GSintroduction/" class="md-nav__link">
        GSintroduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GW/" class="md-nav__link">
        GW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GWR/" class="md-nav__link">
        GWR
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GWls/" class="md-nav__link">
        GWls
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Hybrids/" class="md-nav__link">
        Hybrids
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Install/" class="md-nav__link">
        Install
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/k-points/" class="md-nav__link">
        K points
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LatticeModel/" class="md-nav__link">
        LatticeModel
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LatticeWannier/" class="md-nav__link">
        LatticeWannier
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LWFModel/" class="md-nav__link">
        LWFModel
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LDAminushalf/" class="md-nav__link">
        LDAminushalf
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LOTF/" class="md-nav__link">
        LOTF
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/longwave/" class="md-nav__link">
        Longwave
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Macroave/" class="md-nav__link">
        Macroave
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/MagField/" class="md-nav__link">
        MagField
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/MagMom/" class="md-nav__link">
        MagMom
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/MolecularDynamics/" class="md-nav__link">
        MolecularDynamics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/multidtset/" class="md-nav__link">
        Multidtset
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/NMR/" class="md-nav__link">
        NMR
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/nonlinear/" class="md-nav__link">
        Nonlinear
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Optic/" class="md-nav__link">
        Optic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Output/" class="md-nav__link">
        Output
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/parallelism/" class="md-nav__link">
        Parallelism
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PAW/" class="md-nav__link">
        PAW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PIMD/" class="md-nav__link">
        PIMD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Planewaves/" class="md-nav__link">
        Planewaves
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Phonons/" class="md-nav__link">
        Phonons
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PhononBands/" class="md-nav__link">
        PhononBands
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PhononWidth/" class="md-nav__link">
        PhononWidth
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PortabilityNonRegression/" class="md-nav__link">
        PortabilityNonRegression
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/positron/" class="md-nav__link">
        Positron
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/printing/" class="md-nav__link">
        Printing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PseudosPAW/" class="md-nav__link">
        PseudosPAW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/q-points/" class="md-nav__link">
        Q points
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/RandStopPow/" class="md-nav__link">
        RandStopPow
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Recursion/" class="md-nav__link">
        Recursion
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/RPACorrEn/" class="md-nav__link">
        RPACorrEn
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SCFControl/" class="md-nav__link">
        SCFControl
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SCFAlgorithms/" class="md-nav__link">
        SCFAlgorithms
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SelfEnergy/" class="md-nav__link">
        SelfEnergy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SmartSymm/" class="md-nav__link">
        SmartSymm
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/spinpolarisation/" class="md-nav__link">
        Spinpolarisation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SpinDynamicsMultibinit/" class="md-nav__link">
        SpinDynamicsMultibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/STM/" class="md-nav__link">
        STM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Susceptibility/" class="md-nav__link">
        Susceptibility
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TDDFT/" class="md-nav__link">
        TDDFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TDepES/" class="md-nav__link">
        TDepES
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Temperature/" class="md-nav__link">
        Temperature
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TransPath/" class="md-nav__link">
        TransPath
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TuningSpeedMem/" class="md-nav__link">
        TuningSpeedMem
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Unfolding/" class="md-nav__link">
        Unfolding
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/UnitCell/" class="md-nav__link">
        UnitCell
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/vdw/" class="md-nav__link">
        Vdw
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Verification/" class="md-nav__link">
        Verification
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Wannier/" class="md-nav__link">
        Wannier
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Wavelets/" class="md-nav__link">
        Wavelets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/xc/" class="md-nav__link">
        Xc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/external_resources/" class="md-nav__link">
        External Resources
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Variables
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Variables" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Variables
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/" class="md-nav__link">
        All Variables
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        Abinit
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Abinit" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Abinit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/basic/" class="md-nav__link">
        Basic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/bse/" class="md-nav__link">
        Bethe-Salpeter
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/dev/" class="md-nav__link">
        Developers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/dmft/" class="md-nav__link">
        DMFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/eph/" class="md-nav__link">
        Electron-Phonon
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/ffield/" class="md-nav__link">
        Varff
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/files/" class="md-nav__link">
        File-handling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/geo/" class="md-nav__link">
        Geometry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/gstate/" class="md-nav__link">
        Ground-State
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/gw/" class="md-nav__link">
        GW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/internal/" class="md-nav__link">
        Internal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/paral/" class="md-nav__link">
        Parallelism
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/paw/" class="md-nav__link">
        PAW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/dfpt/" class="md-nav__link">
        DFPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/rlx/" class="md-nav__link">
        Relaxation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/vdw/" class="md-nav__link">
        VdW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/w90/" class="md-nav__link">
        Wannier90
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/anaddb/" class="md-nav__link">
        Anaddb
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/atdep/" class="md-nav__link">
        aTDEP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/multibinit/" class="md-nav__link">
        Multibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/optic/" class="md-nav__link">
        Optic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/aim/" class="md-nav__link">
        Aim
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/external_parameters/" class="md-nav__link">
        External Parameters
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/varset_stats/" class="md-nav__link">
        Statistics
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      <label class="md-nav__link" for="__nav_4_2">
        Basic tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Basic tutorials" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Basic tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../base1/" class="md-nav__link">
        basic1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../base2/" class="md-nav__link">
        basic2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../base3/" class="md-nav__link">
        basic3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../base4/" class="md-nav__link">
        basic4
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../abinit_build/" class="md-nav__link">
        ABINIT_build
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paw1/" class="md-nav__link">
        PAW1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../spin/" class="md-nav__link">
        Spin
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../polarization/" class="md-nav__link">
        Polarization & finite field
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rf1/" class="md-nav__link">
        DFPT1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rf2/" class="md-nav__link">
        DFPT2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../basepar/" class="md-nav__link">
        Parallelism
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_10" type="checkbox" id="__nav_4_10" >
      
      <label class="md-nav__link" for="__nav_4_10">
        ABINIT postprocessors
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="ABINIT postprocessors" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_10">
          <span class="md-nav__icon md-icon"></span>
          ABINIT postprocessors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../atdep1/" class="md-nav__link">
        aTDEP1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cut3d/" class="md-nav__link">
        cut3D
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../fold2bloch/" class="md-nav__link">
        fold2bloch
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../optic/" class="md-nav__link">
        optic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../wannier90/" class="md-nav__link">
        wannier90
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../z2pack/" class="md-nav__link">
        Z2pack
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_11" type="checkbox" id="__nav_4_11" >
      
      <label class="md-nav__link" for="__nav_4_11">
        DFT beyond basics
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DFT beyond basics" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_11">
          <span class="md-nav__icon md-icon"></span>
          DFT beyond basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../nuc/" class="md-nav__link">
        properties at the nucleus
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dftu/" class="md-nav__link">
        DFT+U
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ucalc_crpa/" class="md-nav__link">
        cRPA U(J)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lruj/" class="md-nav__link">
        Linear Response U(J)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paw2/" class="md-nav__link">
        PAW2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paw3/" class="md-nav__link">
        PAW3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../positron/" class="md-nav__link">
        positron
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_12" type="checkbox" id="__nav_4_12" checked>
      
      <label class="md-nav__link" for="__nav_4_12">
        Many-Body Theory & excitations
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Many-Body Theory & excitations" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_12">
          <span class="md-nav__icon md-icon"></span>
          Many-Body Theory & excitations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gw1/" class="md-nav__link">
        GW1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gw2/" class="md-nav__link">
        GW2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gwr_intro/" class="md-nav__link">
        GWR_intro
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gwr1/" class="md-nav__link">
        GWR1
      </a>
    </li>
  

          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Bethe-Salpeter
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Bethe-Salpeter
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#absorption-spectra-including-excitonic-effects" class="md-nav__link">
    Absorption spectra including excitonic effects.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparatory-steps-wfk-and-the-scr-file" class="md-nav__link">
    Preparatory steps (WFK and the SCR file)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#computing-the-absorption-spectrum-within-the-tamm-dancoff-approximation" class="md-nav__link">
    Computing the absorption spectrum within the Tamm-Dancoff approximation
  </a>
  
    <nav class="md-nav" aria-label="Computing the absorption spectrum within the Tamm-Dancoff approximation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-structure-of-the-input-file" class="md-nav__link">
    The structure of the input file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-files" class="md-nav__link">
    Output files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-exercises" class="md-nav__link">
    Optional Exercises
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preliminary-discussion-about-convergence-studies" class="md-nav__link">
    Preliminary discussion about convergence studies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convergence-with-respect-to-the-number-of-bands-in-the-transition-space" class="md-nav__link">
    Convergence with respect to the number of bands in the transition space
  </a>
  
    <nav class="md-nav" aria-label="Convergence with respect to the number of bands in the transition space">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tips-for-expert-users" class="md-nav__link">
    Tips for expert users
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convergence-with-respect-to-the-number-of-planewaves-in-the-screening" class="md-nav__link">
    Convergence with respect to the number of planewaves in the screening
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convergence-with-respect-to-the-number-of-k-points" class="md-nav__link">
    Convergence with respect to the number of k-points
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-exercises" class="md-nav__link">
    Additional exercises
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-on-the-mpi-implementation" class="md-nav__link">
    Notes on the MPI implementation
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dmft/" class="md-nav__link">
        DMFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tddft/" class="md-nav__link">
        TDDFT (Casida)
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_13" type="checkbox" id="__nav_4_13" >
      
      <label class="md-nav__link" for="__nav_4_13">
        DFPT & electron-phonon
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DFPT & electron-phonon" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_13">
          <span class="md-nav__icon md-icon"></span>
          DFPT & electron-phonon
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../elastic/" class="md-nav__link">
        elastic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../nlo/" class="md-nav__link">
        nonlinear
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lattice_wannier/" class="md-nav__link">
        lattice_wannier
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lw_quad/" class="md-nav__link">
        quadrupoles
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph_intro/" class="md-nav__link">
        eph_intro
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph4mob/" class="md-nav__link">
        eph for mobilities
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph4zpr/" class="md-nav__link">
        eph for zero-point renormalization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph_legacy/" class="md-nav__link">
        eph_legacy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph_tdep_legacy/" class="md-nav__link">
        eph_tdep_legacy
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_14" type="checkbox" id="__nav_4_14" >
      
      <label class="md-nav__link" for="__nav_4_14">
        Multibinit
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Multibinit" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_14">
          <span class="md-nav__icon md-icon"></span>
          Multibinit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../multibinit/" class="md-nav__link">
        introduction to multibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lattice_model/" class="md-nav__link">
        lattice_model
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../spin_model/" class="md-nav__link">
        spin_model
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lwf_model/" class="md-nav__link">
        lwf_model
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_15" type="checkbox" id="__nav_4_15" >
      
      <label class="md-nav__link" for="__nav_4_15">
        Advanced parallelism
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Advanced parallelism" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_15">
          <span class="md-nav__icon md-icon"></span>
          Advanced parallelism
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_bandpw/" class="md-nav__link">
        paral_band_PW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_gswvl/" class="md-nav__link">
        paral_wavelets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_moldyn/" class="md-nav__link">
        paral_MD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_images/" class="md-nav__link">
        paral_images
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_dfpt/" class="md-nav__link">
        paral_DFPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_mbt/" class="md-nav__link">
        paral_MBPT
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        FAQ
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="FAQ" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          FAQ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/configuration_and_compilation/" class="md-nav__link">
        Configuration and compilation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/general_questions/" class="md-nav__link">
        General questions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/pre_and_post_processing/" class="md-nav__link">
        Pre/Post processing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/ground_state/" class="md-nav__link">
        Ground state
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/dfpt/" class="md-nav__link">
        DFPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/Troubleshooting/" class="md-nav__link">
        Troubleshooting (old-dokuwiki)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/tuning_abinit/" class="md-nav__link">
        Tuning (old-dokuwiki)
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Theory
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Theory" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/geometry/" class="md-nav__link">
        Geometry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/spherical_harmonics/" class="md-nav__link">
        Spherical Harmonics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/wavefunctions/" class="md-nav__link">
        Wavefunctions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/noncollinear/" class="md-nav__link">
        Noncollinear
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/pseudopotentials/" class="md-nav__link">
        Pseudopotentials
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/mbt/" class="md-nav__link">
        Many-Body Perturbation Theory
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/bse/" class="md-nav__link">
        Bethe-Salpeter
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/documents/" class="md-nav__link">
        Documents
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/acknowledgments/" class="md-nav__link">
        Acknowledgments
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/bibliography/" class="md-nav__link">
        Bibliography
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/acronyms/" class="md-nav__link">
        Acronyms
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Developers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/git_and_gitlab/" class="md-nav__link">
        Git and Gitlab
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/developers_howto/" class="md-nav__link">
        HowTo for developers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/abimkdocs/" class="md-nav__link">
        Abimkdocs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/markdown/" class="md-nav__link">
        Markdown
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_5" type="checkbox" id="__nav_7_5" >
      
      <label class="md-nav__link" for="__nav_7_5">
        Test Suite
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Test Suite" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_5">
          <span class="md-nav__icon md-icon"></span>
          Test Suite
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/testsuite/" class="md-nav__link">
        Test list
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/testsuite_howto/" class="md-nav__link">
        Test Suite Howto
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/new_testsuite/" class="md-nav__link">
        YAML-based test suite Howto
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/yaml_tools_api/" class="md-nav__link">
        YAML-based test suite Python tools and API
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/XgType/" class="md-nav__link">
        XgType
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_7" type="checkbox" id="__nav_7_7" >
      
      <label class="md-nav__link" for="__nav_7_7">
        Pseudos
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Pseudos" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_7">
          <span class="md-nav__icon md-icon"></span>
          Pseudos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp1_info/" class="md-nav__link">
        psp1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp3_info/" class="md-nav__link">
        psp3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp45_info/" class="md-nav__link">
        psp45
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp5spinorbit_info/" class="md-nav__link">
        psp5
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp6_info/" class="md-nav__link">
        psp6
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp8_info/" class="md-nav__link">
        psp8
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/codestats/" class="md-nav__link">
        Code stats
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/autoconf_examples/" class="md-nav__link">
        Autoconf_examples
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/testlink/" class="md-nav__link">
        Test Page for linkcheck
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        About
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/release-notes/" class="md-nav__link">
        Release Notes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/history/" class="md-nav__link">
        History
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        License
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#absorption-spectra-including-excitonic-effects" class="md-nav__link">
    Absorption spectra including excitonic effects.
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#preparatory-steps-wfk-and-the-scr-file" class="md-nav__link">
    Preparatory steps (WFK and the SCR file)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#computing-the-absorption-spectrum-within-the-tamm-dancoff-approximation" class="md-nav__link">
    Computing the absorption spectrum within the Tamm-Dancoff approximation
  </a>
  
    <nav class="md-nav" aria-label="Computing the absorption spectrum within the Tamm-Dancoff approximation">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-structure-of-the-input-file" class="md-nav__link">
    The structure of the input file
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-files" class="md-nav__link">
    Output files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-exercises" class="md-nav__link">
    Optional Exercises
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#preliminary-discussion-about-convergence-studies" class="md-nav__link">
    Preliminary discussion about convergence studies
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convergence-with-respect-to-the-number-of-bands-in-the-transition-space" class="md-nav__link">
    Convergence with respect to the number of bands in the transition space
  </a>
  
    <nav class="md-nav" aria-label="Convergence with respect to the number of bands in the transition space">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#tips-for-expert-users" class="md-nav__link">
    Tips for expert users
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convergence-with-respect-to-the-number-of-planewaves-in-the-screening" class="md-nav__link">
    Convergence with respect to the number of planewaves in the screening
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#convergence-with-respect-to-the-number-of-k-points" class="md-nav__link">
    Convergence with respect to the number of k-points
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#additional-exercises" class="md-nav__link">
    Additional exercises
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#notes-on-the-mpi-implementation" class="md-nav__link">
    Notes on the MPI implementation
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              

                
                  <a href="https://github.com/abinit/abinit/edit/master/doc/tutorial/bse.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="tutorial-on-bethe-salpeter-calculations">Tutorial on Bethe-Salpeter calculations<a class="headerlink" href="#tutorial-on-bethe-salpeter-calculations" title="Permanent link">&para;</a></h1>
<h2 id="absorption-spectra-including-excitonic-effects">Absorption spectra including excitonic effects.<a class="headerlink" href="#absorption-spectra-including-excitonic-effects" title="Permanent link">&para;</a></h2>
<p>This tutorial discusses how to calculate the macroscopic dielectric function
including excitonic effects within the Bethe-Salpeter (BS) approach.
Crystalline silicon is used as test case. A brief description of the formalism
can be found in the <a class="wikilink theory-wikilink" href="/theory/bse">Bether-Salpeter notes</a>.</p>
<p>The user should be familiarized with the four basic tutorials of ABINIT and the <a href="/tutorial/gw1">first GW tutorial</a>.</p>
<p>Visualisation tools are NOT covered in this tutorial.
Powerful visualisation procedures have been developed in the Abipy context,
relying on matplotlib. See the README of <a href="https://github.com/abinit/abipy">Abipy</a>
and the <a href="https://github.com/abinit/abitutorials">Abipy tutorials</a>.</p>
<p>This tutorial should take about one hour to be completed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Supposing you made your own installation of ABINIT, the input files to run the examples
are in the <em>~abinit/tests/</em> directory where <em>~abinit</em> is the <strong>absolute path</strong> of the abinit top-level directory.
If you have NOT made your own install, ask your system administrator where to find the package,
especially the executable and test files.</p>
<p>In case you work on your own PC or workstation, to make things easier, we suggest you define
some handy environment variables by executing the following lines in the terminal:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">ABI_HOME</span><span class="o">=</span>Replace_with_absolute_path_to_abinit_top_level_dir <span class="c1"># Change this line</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$ABI_HOME</span>/src/98_main/:<span class="nv">$PATH</span>      <span class="c1"># Do not change this line: path to executable</span>
<span class="nb">export</span> <span class="nv">ABI_TESTS</span><span class="o">=</span><span class="nv">$ABI_HOME</span>/tests/             <span class="c1"># Do not change this line: path to tests dir</span>
<span class="nb">export</span> <span class="nv">ABI_PSPDIR</span><span class="o">=</span><span class="nv">$ABI_TESTS</span>/Psps_for_tests/  <span class="c1"># Do not change this line: path to pseudos dir</span>
</code></pre></div>
<p>Examples in this tutorial use these shell variables: copy and paste
the code snippets into the terminal (<strong>remember to set ABI_HOME first!</strong>) or, alternatively,
source the <code>set_abienv.sh</code> script located in the <em>~abinit</em> directory:</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span> ~abinit/set_abienv.sh
</code></pre></div>
<p>The &lsquo;export PATH&rsquo; line adds the directory containing the executables to your <a href="http://www.linfo.org/path_env_var.html">PATH</a>
so that you can invoke the code by simply typing <em>abinit</em> in the terminal instead of providing the absolute path.</p>
<p>To execute the tutorials, create a working directory (<code>Work*</code>) and
copy there the input files of the lesson.</p>
<p>Most of the tutorials do not rely on parallelism (except specific <a class="wikilink lesson-wikilink" href="/tutorial/basepar">tutorials on parallelism</a>).
However you can run most of the tutorial examples in parallel with MPI, see the <a class="wikilink topic-wikilink" data-tippy-content="How to set parameters for a parallel calculation" data-toggle="popover" href="/topics/parallelism">topic on parallelism</a>.</p>
</div>
<h2 id="preparatory-steps-wfk-and-the-scr-file">Preparatory steps (WFK and the SCR file)<a class="headerlink" href="#preparatory-steps-wfk-and-the-scr-file" title="Permanent link">&para;</a></h2>
<p>Before starting, you might consider to work in a different subdirectory as
for the other tutorials. Why not Work_bs?</p>
<p>Copy the input files <em>$ABI_TESTS/tutorial/Input/tbs_*.abi</em>.
in the working directory <em>Work_bs</em>.</p>
<p>Make sure that the Si.psp8 pseudopotential needed for running the tutorial is placed under 
<em>$ABI_PSPDIR/Pseudodojo_nc_sr_04_pw_standard_psp8</em>.</p>
<p>Now run immediately the calculation with the command:</p>
<div class="codehilite"><pre><span></span><code>abinit tbs_1.abi &gt; tbs_1.log 2&gt; err &amp;
</code></pre></div>

<p>so that we can analyze the input file while the code is running.</p>
<p>The input file is located in <em>$ABI_TESTS/tutorial/Input/tbs_1.abi</em>.
The header reports a brief description of the calculation so read it carefully.
Do not worry if some parts are not clear to you as we are going to discuss the
calculation in step by step fashion.</p>
<div class="text-center"><button id="uuid-89d62e23-c8c5-4267-b6df-e0bc3fbc276d" class="md-button md-button--secondary"> View tests/tutorial/Input/tbs_1.abi </button></div>
<div id="uuid-9b4a1e98-59c1-4e4e-9753-f755df75b890" class="my_dialog" title="tests/tutorial/Input/tbs_1.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Crystalline silicon </span>
<span class="c1"># Preparatory run for BS calculations</span>
<span class="c1">#</span>
<span class="c1"># There are four datasets specified in this input:</span>
<span class="c1"># 1) Ground-state calculation to get the density.</span>
<span class="c1"># 2) NSCF run to generate the WFK file on a symmetric k-mesh (4x4x4, gamma-centered) </span>
<span class="c1"># 3) NSCF run to generate another WFK file on a shifted 4x4x4 k-mesh that breaks the symmetry of the BZ sampling</span>
<span class="c1"># 4) SCR calculation with the WFK file generated in the second dataset </span>
<span class="c1">#</span>
ndtset <span class="m">4</span>

<span class="c1"># Definition of the k-point grid</span>
kptopt <span class="m">1</span>             <span class="c1"># Option for the automatic generation of k points,</span>
ngkpt  <span class="m">4</span> <span class="m">4</span> <span class="m">4</span>         <span class="c1"># This mesh is too coarse for optical properties.</span>
nshiftk <span class="m">1</span>
shiftk  <span class="m">0</span>.0 <span class="m">0</span>.0 <span class="m">0</span>.0  <span class="c1"># Gamma-centered k-mesh</span>

<span class="c1"># Dataset1: self-consistent calculation</span>
<span class="c1">#</span>
tolvrs1 <span class="m">1</span>.0d-8
prtden1 <span class="m">1</span>

<span class="c1"># Dataset2: definition of parameters for the calculation of the WFK file on the symmetric k-mesh.</span>
<span class="c1">#</span>
iscf2    -2       <span class="c1"># NSCF run</span>
getden2  <span class="m">1</span>        <span class="c1"># Read previous density file</span>
tolwfr2  <span class="m">1</span>.0d-8  
nband2    <span class="m">105</span>     <span class="c1"># bands treated in the CG algorithm</span>
nbdbuf2    <span class="m">5</span>      <span class="c1"># The last five states are excluded from the converge check</span>
                  <span class="c1"># to facilitate the convergence </span>

<span class="c1"># Dataset3: calculation of the WFK file on the shifted k-mesh to break the symmetry.</span>
<span class="c1">#</span>
iscf3    -2                
getden3   <span class="m">1</span>
tolwfr3  <span class="m">1</span>.0d-8  
nband3    <span class="m">15</span>               <span class="c1"># Here we can reduce the number of bands since this WFK file </span>
                           <span class="c1"># will be used to construct the transition space </span>
nbdbuf3    <span class="m">5</span>               
chksymbreak3 <span class="m">0</span>             <span class="c1"># To skip the check on the k-mesh.</span>
shiftk3    <span class="m">0</span>.11 <span class="m">0</span>.21 <span class="m">0</span>.31  <span class="c1"># This shift breaks the symmetry of the k-mesh.</span>

<span class="c1"># Dataset3: creation of the screening (eps^-1) matrix</span>
<span class="c1">#</span>
optdriver4 <span class="m">3</span>
gwpara4    <span class="m">2</span>
inclvkb4   <span class="m">2</span>
awtr4      <span class="m">1</span>
symchi4    <span class="m">1</span>
getwfk4    <span class="m">2</span>
ecuteps4   <span class="m">6</span>
ecutwfn4   <span class="m">12</span>
nband4    <span class="m">100</span>  <span class="c1"># This value leads to well converged QP energies, see the first GW tutorial</span>
nfreqre4   <span class="m">1</span>   <span class="c1"># Only the static limit is needed for standard BSE calculations.</span>
nfreqim4   <span class="m">0</span>

<span class="c1"># VARIABLES COMMON TO THE DIFFERENT DATASETS</span>

<span class="c1"># Definition of the unit cell: fcc</span>
acell <span class="m">3</span>*10.217         <span class="c1"># This is equivalent to   10.217 10.217 10.217</span>
rprim  <span class="m">0</span>.0  <span class="m">0</span>.5  <span class="m">0</span>.5   <span class="c1"># FCC primitive vectors (to be scaled by acell)</span>
       <span class="m">0</span>.5  <span class="m">0</span>.0  <span class="m">0</span>.5
       <span class="m">0</span>.5  <span class="m">0</span>.5  <span class="m">0</span>.0

<span class="c1"># Definition of the atom types</span>
ntypat <span class="m">1</span>         <span class="c1"># There is only one type of atom</span>
znucl <span class="m">14</span>         <span class="c1"># The keyword &quot;zatnum&quot; refers to the atomic number of the</span>
                 <span class="c1"># possible type(s) of atom. The pseudopotential(s)</span>
                 <span class="c1"># mentioned in the &quot;files&quot; file must correspond</span>
                 <span class="c1"># to the type(s) of atom. Here, the only type is Silicon.</span>

<span class="c1"># Definition of the atoms</span>
natom <span class="m">2</span>           <span class="c1"># There are two atoms</span>
typat <span class="m">1</span> <span class="m">1</span>         <span class="c1"># They both are of type 1, that is, Silicon.</span>
xred              <span class="c1"># Reduced coordinate of atoms</span>
   <span class="m">0</span>.0  <span class="m">0</span>.0  <span class="m">0</span>.0
   <span class="m">0</span>.25 <span class="m">0</span>.25 <span class="m">0</span>.25

<span class="c1"># Definition of the planewave basis set </span>
ecut <span class="m">12</span>         <span class="c1"># Maximal kinetic energy cut-off, in Hartree</span>

istwfk *1
nstep  <span class="m">50</span>      <span class="c1"># Maximal number of SCF cycles</span>
diemac <span class="m">12</span>.0


 pp_dirpath <span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span>
 pseudos <span class="s2">&quot;Pseudodojo_nc_sr_04_pw_standard_psp8/Si.psp8&quot;</span>

<span class="c1">##############################################################</span>
<span class="c1"># This section is used only for regression testing of ABINIT #</span>
<span class="c1">##############################################################</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% test_chain = tbs_1.abi, tbs_2.abi, tbs_3.abi, tbs_4.abi</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tbs_1.abo,  tolnlines= 20, tolabs=  1.1e-2,    tolrel=  4.0e-2</span>
<span class="c1">#%% [shell]</span>
<span class="c1">#%% post_commands =</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_2i_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_2i_SCR;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_3i_DS1_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_3i_DS1_SCR;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_3i_DS2_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_3i_DS2_SCR;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_3i_DS3_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_3i_DS3_SCR;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_3i_DS4_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_3i_DS4_SCR;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_3i_DS5_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_3i_DS5_SCR;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_4i_DS1_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_4i_DS1_SCR;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_4i_DS2_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_4i_DS2_SCR;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_4i_DS3_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_4i_DS3_SCR;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS3_WFK tbs_4i_DS4_WFK;</span>
<span class="c1">#%%  ww_cp tbs_1o_DS4_SCR tbs_4i_DS4_SCR; </span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 4</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Giantomassi</span>
<span class="c1">#%% keywords = GW, BSE</span>
<span class="c1">#%% description = </span>
<span class="c1">#%%  Crystalline silicon </span>
<span class="c1">#%%  Preparatory run for BS calculations</span>
<span class="c1">#%% </span>
<span class="c1">#%%  There are four datasets specified in this input:</span>
<span class="c1">#%%  1) Ground-state calculation to get the density.</span>
<span class="c1">#%%  2) NSCF run to generate the WFK file on a symmetric k-mesh (4x4x4, gamma-centered) </span>
<span class="c1">#%%  3) NSCF run to generate another WFK file on a shifted 4x4x4 k-mesh that breaks the symmetry of the BZ sampling</span>
<span class="c1">#%%  4) SCR calculation with the WFK file generated in the second dataset </span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-9b4a1e98-59c1-4e4e-9753-f755df75b890", "#uuid-89d62e23-c8c5-4267-b6df-e0bc3fbc276d") }); </script>

<p>This input file generates the two WFK files and the SCR file needed for
the subsequent Bethe-Salpeter computations. The first dataset performs a
rather standard ground-state calculation on an <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span>-centered 4x4x4 grid (64 k
points in the full Brillouin Zone, folding to 8 k points in the irreducible wedge).
Then the ground-state density is used in dataset 2 and 3 to generate
two WFK files with a standard NSCF run and the conjugate-gradient method.</p>
<p>Note that the WFK file computed in dataset 2 contains <strong>100 bands</strong> on the 4x4x4
<strong>gamma-centered</strong> k-mesh whereas the WFK file produced in dataset 3 has only
<strong>10 bands</strong> on a 4x4x4 k-mesh <strong>shifted</strong> along the direction</p>
<div class="codehilite"><pre><span></span><code>shiftk3    0.11 0.21 0.31  # This shift breaks the symmetry of the k-mesh.
</code></pre></div>

<p>The <span><span class="MathJax_Preview">\Gamma</span><script type="math/tex">\Gamma</script></span>-centered k-mesh contains 8 points in the IBZ while the
shifted k-mesh breaks the symmetry of the crystal leading to 64 points in the
IBZ (actually the IBZ now coincides with the full Brillouin zone). The second
mesh is clearly inefficient, so you might wonder why we are using such a
bizarre sampling and, besides, why we need to generate two different WFK files!</p>
<p>Indeed this approach strongly differs from the one we followed in the GW
tutorials, but there is a good reason for doing so.
It is anticipated that optical spectra <strong>converge slowly</strong> with the BZ sampling, and that
<strong>symmetry-breaking k-meshes</strong> lead to faster convergence in <a class="wikilink codevar-wikilink" href="/variables/basic#nkpt">nkpt</a> than the
standard symmetric k-meshes commonly used for ground-state or GW calculations.</p>
<p>This explains the bizarre shift but, still, why two WFK files? Why not 
simply use the WFK file on the shifted k-mesh to compute the screening?</p>
<p>The reason is that a screening calculation done with many empty bands on the
shifted k-mesh would be very memory demanding as the code should allocate a
huge portion of memory whose size scales with (<a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a> * <a class="wikilink codevar-wikilink" href="/variables/basic#nkpt">nkpt</a>), and no
symmetry can be used to reduce the number of k-points.</p>
<p>To summarize: the WFK with the symmetric k-point sampling and 100 bands will
be used to compute the screening, while the WFK file with the shifted k-mesh
and 10 bands will be used to construct the transition space employed for
solving the Bethe-Salpeter equation. The two k-meshes differ just for the
shift thus they produce the same set of q-points (the list of q-points in the
screening is defined as all the possible differences between the k-points of
the WFK file). This means that, in the Bethe-Salpeter run, we can use the SCR file
generated with the symmetric mesh even though the transition space is
constructed with the shifted k-mesh.</p>
<p>After this lengthy discussion needed to clarify this rather technical point,
we can finally proceed to analyze the screening computation performed in the
last dataset of <em>tbs_1.abi</em>.</p>
<p>The SCR file is calculated in dataset 4 using <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a> = 100 and <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a> = 6.0 Ha.
In the <a href="/tutorial/gw1">first GW tutorial</a>, these
values were found to give QP energies converged within 0.01 eV, so we are
confident that our SCR file is well converged and it can be safely used for
performing convergence tests in the Bethe-Salpeter part.</p>
<p>Note that, for efficiency reasons, only the static limit of W is computed:</p>
<div class="codehilite"><pre><span></span><code><span class="nv">nfreqre4</span>  <span class="mi">1</span>   # <span class="nv">Only</span> <span class="nv">the</span> <span class="nv">static</span> <span class="nv">limit</span> <span class="nv">of</span> <span class="nv">W</span> <span class="nv">is</span> <span class="nv">needed</span> <span class="k">for</span> <span class="nv">standard</span> <span class="nv">BSE</span> <span class="nv">calculations</span>.
<span class="nv">nfreqim4</span>  <span class="mi">0</span>
</code></pre></div>

<p>Indeed, in the standard formulation of the Bethe-Salpeter equation, only the
static limit of the screened interaction is needed to construct the Coulomb
term of the BS Hamiltonian. Using a single frequency allows us to save some
CPU time in the screening part, but keep in mind that this SCR file can only
be used either for Bethe-Salpeter computations or for GW calculations
employing the plasmon-pole models corresponding to <a class="wikilink codevar-wikilink" href="/variables/gw#ppmodel">ppmodel</a> = 3, 4.</p>
<p>At this point the calculation should have completed, but there is still one
thing that we have to do before moving to the next paragraph.</p>
<p>As we said, we will need the WFK file on the shifted k-mesh and the SCR file
for our BS calculations so do not delete them! It is also a good idea to
rename these precious files using more meaningful names <em>e.g.</em>:</p>
<div class="codehilite"><pre><span></span><code>mv tbs_1o_DS2_WFK 444_gamma_WFK
mv tbs_1o_DS3_WFK 444_shifted_WFK
mv tbs_1o_DS4_SCR 444_SCR
</code></pre></div>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The list of k-points specified in the BS input files <strong>must equal</strong> the one used
to generate the WFK file. Two new WFK files and a new SCR file must be
generated from scratch if we want to change the k-point sampling used to
construct the transition space.</p>
</div>
<h2 id="computing-the-absorption-spectrum-within-the-tamm-dancoff-approximation">Computing the absorption spectrum within the Tamm-Dancoff approximation<a class="headerlink" href="#computing-the-absorption-spectrum-within-the-tamm-dancoff-approximation" title="Permanent link">&para;</a></h2>
<p>This section is intended to show how to perform a standard excitonic
calculation within the Tamm-Dancoff approximation (TDA) using the Haydock iterative technique.
The input file is <em>$ABI_TESTS/tutorial/tutorial/Input/tbs_2.abi</em>.</p>
<p>Before running the job, we have to connect this calculation with the output
results produced in <em>tbs_1.abi</em>.</p>
<p>Use the Unix commands:</p>
<div class="codehilite"><pre><span></span><code>ln -s 444_shifted_WFK tbs_2i_WFK
ln -s 444_SCR tbs_2i_SCR
</code></pre></div>

<p>to create two symbolic links for the shifted WFK and the SCR file. The reason
for doing so will be clear afterwards once we discuss the input file.</p>
<p>This job lasts 1-2 minutes on a modern machine so it is worth running it
before inspecting the input file.</p>
<p>Copy the file <em>$ABI_TESTS/tutorial/Input/tbs_2.abi</em> in the working
directory and issue:</p>
<div class="codehilite"><pre><span></span><code>abinit tbs_2.abi &gt; tbs_2.log 2&gt; err &amp;
</code></pre></div>

<p>to put the job in background so that we can examine <em>tbs_2.abi</em>.</p>
<p>Now open <em>$ABI_TESTS/tutorial/Input/tbs_2.abi</em> in your preferred editor and go
to the next section where we discuss the most important variables governing a
typical BS computation.</p>
<div class="text-center"><button id="uuid-21fb1aab-4a35-4e46-ba27-c0f25240f788" class="md-button md-button--secondary"> View tests/tutorial/Input/tbs_2.abi </button></div>
<div id="uuid-d5ed1b8d-1d5d-4641-ba9f-120dd3fa6f95" class="my_dialog" title="tests/tutorial/Input/tbs_2.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Crystalline silicon</span>
<span class="c1"># BS run: Tamm-Dancoff approximation solved with the Haydock algorithm.</span>

<span class="c1"># BSE run with Haydock iterative method (only resonant + W + v)</span>
optdriver <span class="m">99</span>  <span class="c1"># BS calculation</span>
irdwfk  <span class="m">1</span>     <span class="c1"># Read the WFK file produced in tbs_1 </span>
irdscr  <span class="m">1</span>     <span class="c1"># Read the SCR file produced in tbs_1 </span>

bs_calctype       <span class="m">1</span>       <span class="c1"># L0 is constructed with KS orbitals and energies.</span>
mbpt_sciss          <span class="m">0</span>.8 eV  <span class="c1"># Scissors operator used to correct the KS band structure.</span>
bs_exchange_term  <span class="m">1</span>       <span class="c1"># Exchange term included.</span>
bs_coulomb_term   <span class="m">11</span>      <span class="c1"># Coulomb term included using the full matrix W_GG&#39;</span>
bs_coupling       <span class="m">0</span>       <span class="c1"># Tamm-Dancoff approximation.</span>

bs_loband         <span class="m">2</span> 
nband             <span class="m">8</span>

bs_freq_mesh <span class="m">0</span> <span class="m">6</span> <span class="m">0</span>.02 eV   <span class="c1"># Frequency mesh.</span>

bs_algorithm        <span class="m">2</span>      <span class="c1"># Haydock method.</span>
bs_haydock_niter   <span class="m">200</span>     <span class="c1"># Max number of iterations for the Haydock method.</span>
bs_haydock_tol     <span class="m">0</span>.05 <span class="m">0</span>  <span class="c1"># Tolerance for the iterative method.</span>
zcut               <span class="m">0</span>.15 eV <span class="c1"># complex shift to avoid divergences in the continued fraction.</span>

<span class="c1"># Definition of the k-point grid</span>
<span class="c1"># MUST be equal to the grid used for generating the WFK file.</span>
kptopt <span class="m">1</span>                  <span class="c1"># Option for the automatic generation of k points,</span>
ngkpt  <span class="m">4</span> <span class="m">4</span> <span class="m">4</span>              <span class="c1"># This mesh is too coarse for optical properties.</span>
nshiftk <span class="m">1</span>
shiftk    <span class="m">0</span>.11 <span class="m">0</span>.21 <span class="m">0</span>.31  <span class="c1"># This shift breaks the symmetry of the k-mesh.</span>
chksymbreak <span class="m">0</span>             <span class="c1"># Mandatory for using symmetry-breaking k-meshes in the BS code.</span>

ecutwfn <span class="m">12</span>.0               <span class="c1"># Cutoff for the wavefunction.</span>
ecuteps <span class="m">2</span>.0               <span class="c1"># Cutoff for W and /bare v used to calculate the BS matrix elements.</span>
inclvkb <span class="m">2</span>                 <span class="c1"># The commutator for the optical limit is correctly evaluated.</span>
gw_icutcoul <span class="m">3</span>               <span class="c1"># Legacy value</span>

<span class="c1"># VARIABLES COMMON TO THE DIFFERENT DATASETS</span>

<span class="c1"># Definition of the unit cell: fcc</span>
acell <span class="m">3</span>*10.217         <span class="c1"># This is equivalent to   10.217 10.217 10.217</span>
rprim  <span class="m">0</span>.0  <span class="m">0</span>.5  <span class="m">0</span>.5   <span class="c1"># FCC primitive vectors (to be scaled by acell)</span>
       <span class="m">0</span>.5  <span class="m">0</span>.0  <span class="m">0</span>.5
       <span class="m">0</span>.5  <span class="m">0</span>.5  <span class="m">0</span>.0

<span class="c1"># Definition of the atom types</span>
ntypat <span class="m">1</span>         <span class="c1"># There is only one type of atom</span>
znucl <span class="m">14</span>         <span class="c1"># The keyword &quot;zatnum&quot; refers to the atomic number of the</span>
                 <span class="c1"># possible type(s) of atom. The pseudopotential(s)</span>
                 <span class="c1"># mentioned in the &quot;files&quot; file must correspond</span>
                 <span class="c1"># to the type(s) of atom. Here, the only type is Silicon.</span>

<span class="c1"># Definition of the atoms</span>
natom <span class="m">2</span>           <span class="c1"># There are two atoms</span>
typat <span class="m">1</span> <span class="m">1</span>         <span class="c1"># They both are of type 1, that is, Silicon.</span>
xred              <span class="c1"># Reduced coordinate of atoms</span>
   <span class="m">0</span>.0  <span class="m">0</span>.0  <span class="m">0</span>.0
   <span class="m">0</span>.25 <span class="m">0</span>.25 <span class="m">0</span>.25

<span class="c1"># Definition of the planewave basis set </span>
ecut <span class="m">12</span>        <span class="c1"># Maximal kinetic energy cut-off, in Hartree</span>

istwfk *1
nstep  <span class="m">50</span>      <span class="c1"># Maximal number of SCF cycles</span>
diemac <span class="m">12</span>.0


 pp_dirpath <span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span>
 pseudos <span class="s2">&quot;Pseudodojo_nc_sr_04_pw_standard_psp8/Si.psp8&quot;</span>

<span class="c1">##############################################################</span>
<span class="c1"># This section is used only for regression testing of ABINIT #</span>
<span class="c1">##############################################################</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% test_chain = tbs_1.abi, tbs_2.abi, tbs_3.abi, tbs_4.abi</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tbs_2.abo, tolnlines= 10, tolabs=  1.1e-2,    tolrel=  4.0e-2, fld_options =-ridiculous</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 4</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Giantomassi</span>
<span class="c1">#%% keywords = GW, BSE</span>
<span class="c1">#%% description = </span>
<span class="c1">#%%  Crystalline silicon</span>
<span class="c1">#%%   BS run: Tamm-Dancoff approximation solved with the Haydock algorithm.</span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-d5ed1b8d-1d5d-4641-ba9f-120dd3fa6f95", "#uuid-21fb1aab-4a35-4e46-ba27-c0f25240f788") }); </script>

<h3 id="the-structure-of-the-input-file">The structure of the input file<a class="headerlink" href="#the-structure-of-the-input-file" title="Permanent link">&para;</a></h3>
<p>First we need to set <a class="wikilink codevar-wikilink" href="/variables/gstate#optdriver">optdriver</a> = 99 to call the BSE routines</p>
<div class="codehilite"><pre><span></span><code>optdriver  99   # BS calculation
</code></pre></div>

<p>The variables <a class="wikilink codevar-wikilink" href="/variables/files#irdwfk">irdwfk</a> and <a class="wikilink codevar-wikilink" href="/variables/files#irdscr">irdscr</a> are similar to other &ldquo;ird&rdquo; variables
of ABINIT and are used to read the files produced in the previous paragraph</p>
<div class="codehilite"><pre><span></span><code>irdwfk  1  # Read the WFK file produced in tbs_1
irdscr  1  # Read the SCR file produced in tbs_1
</code></pre></div>

<p>The code expects to find an input WFK file and an input SCR file.
This is the reason why we had to create the two symbolic links before running the code.</p>
<p>Then we have a list of five variables specifying how to construct the excitonic Hamiltonian.</p>
<div class="codehilite"><pre><span></span><code><span class="n">bs_calctype</span>       <span class="mi">1</span>    <span class="c1"># L0 constructed with KS orbitals and energies.</span>
<span class="n">mbpt_sciss</span>   <span class="mf">0.8</span> <span class="n">eV</span>    <span class="c1"># Scissors operator used to correct the KS band structure.</span>
<span class="n">bs_exchange_term</span>  <span class="mi">1</span>    <span class="c1"># Exchange term included.</span>
<span class="n">bs_coulomb_term</span>  <span class="mi">11</span>    <span class="c1"># Coulomb term included using the full matrix W_GG&#39;</span>
<span class="n">bs_coupling</span>       <span class="mi">0</span>    <span class="c1"># Tamm-Dancoff approximation.</span>
</code></pre></div>

<p>The value <a class="wikilink codevar-wikilink" href="/variables/bse#bs_calctype">bs_calctype</a> = 1 specifies that the independent-particle
polarizability should be constructed with the Kohn-Sham orbitals and energies
read from the WFK file. To simulate the self-energy correction, the KS
energies are corrected with a scissors operator of energy <a class="wikilink codevar-wikilink" href="/variables/gw#mbpt_sciss">mbpt_sciss</a> = 0.8 eV.
This permits us to avoid a cumbersome GW calculation for each state
included in our transition space. The use of the scissors operator is a
reasonable approximation for silicon but it might fail in more complicated
systems in which the GW corrections cannot be simulated in terms of a simple
rigid shift of the initial KS bands structure.</p>
<p>The remaining three variables specify how to construct the excitonic Hamiltonian.
<a class="wikilink codevar-wikilink" href="/variables/bse#bs_exchange_term">bs_exchange_term</a> = 1 tells the code to calculate the exchange
part of the kernel, hence this calculation includes local-field effects.
The variable <a class="wikilink codevar-wikilink" href="/variables/bse#bs_coulomb_term">bs_coulomb_term</a> is used to select among different options that
are available for the Coulomb term (please take some time to read the
description of the variable and the relevant equations in the <a class="wikilink theory-wikilink" href="/theory/bse">Bethe-Salpeter notes</a>.
Finally <a class="wikilink codevar-wikilink" href="/variables/bse#bs_coupling">bs_coupling</a> = 0 specifies that the off-diagonal coupling blocks
should be neglected (Tamm-Dancoff approximation).
This particular combination of parameters thus corresponds to a Bethe-Salpeter
calculation within the Tamm-Dancoff approximation with local field effects included.</p>
<p>Then we have the specification of the bands used to construct the transition space:</p>
<div class="codehilite"><pre><span></span><code>bs_loband   2
nband       8
</code></pre></div>

<p>In this case all the bands around the gap whose index is between 2 and 8 are
included in the basis set.</p>
<p>The frequency mesh for the macroscopic dielectric function is specified by <a class="wikilink codevar-wikilink" href="/variables/bse#bs_freq_mesh">bs_freq_mesh</a></p>
<div class="codehilite"><pre><span></span><code>bs_freq_mesh 0 6 0.02 eV  # Frequency mesh.
</code></pre></div>

<p>This triplet of real values defines a linear mesh that covers the range [0, 6] eV with a step of 0.02 eV.
The number of frequency points in the mesh does not
have any significant effect on the CPU time, but it is important to stress
that the number of bands included in the transition space defines, in
conjunction with the number of k-points, the frequency range that can be
described. As a consequence <a class="wikilink codevar-wikilink" href="/variables/bse#bs_loband">bs_loband</a> and <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a> should be subject to
an accurate converge study.</p>
<p>Then we have the parameters that define and control the algorithm employed to
calculate the macroscopic dielectric function</p>
<div class="codehilite"><pre><span></span><code><span class="nv">bs_algorithm</span>        <span class="mi">2</span>      # <span class="nv">Haydock</span> <span class="nv">method</span> <span class="ss">(</span><span class="nv">this</span> <span class="nv">is</span> <span class="nv">the</span> <span class="nv">default</span> <span class="nv">value</span><span class="ss">)</span>.
<span class="nv">bs_haydock_niter</span>   <span class="mi">100</span>     # <span class="nv">Max</span> <span class="nv">number</span> <span class="nv">of</span> <span class="nv">iterations</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">Haydock</span> <span class="nv">method</span>.
<span class="nv">bs_haydock_tol</span>     <span class="mi">0</span>.<span class="mi">05</span>    # <span class="nv">Tolerance</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">iterative</span> <span class="nv">method</span>.
<span class="nv">zcut</span>               <span class="mi">0</span>.<span class="mi">15</span> <span class="nv">eV</span> # <span class="nv">Complex</span> <span class="nv">shift</span> <span class="nv">to</span> <span class="nv">avoid</span> <span class="nv">divergences</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">continued</span> <span class="nv">fraction</span>.
</code></pre></div>

<p><a class="wikilink codevar-wikilink" href="/variables/bse#bs_algorithm">bs_algorithm</a> specifies the algorithm used to calculate the macroscopic dielectric function.
In this case we use the iterative Haydock technique whose
maximum number of iterations is given by <a class="wikilink codevar-wikilink" href="/variables/bse#bs_haydock_niter">bs_haydock_niter</a>.
The iterative algorithm stops when the difference between two consecutive evaluations of the
optical spectra is less than <a class="wikilink codevar-wikilink" href="/variables/bse#bs_haydock_tol">bs_haydock_tol</a>.
The input variable <a class="wikilink codevar-wikilink" href="/variables/gw#zcut">zcut</a> gives the complex shift to avoid divergences in the continued fraction.
From a physical point of view, this parameters mimics the experimental broadening of
the absorption peaks. In this test, due to the coarseness of the k-mesh, we
have to use a value slightly larger than the default one (0.1 eV) in order to
facilitate the convergence of the Haydock algorithm.
Ideally, one should perform a convergence study by decreasing the value of <a class="wikilink codevar-wikilink" href="/variables/gw#zcut">zcut</a> for increasing number of k-points.</p>
<p>The k-point sampling is specified by the set of variables.</p>
<div class="codehilite"><pre><span></span><code><span class="nv">kptopt</span> <span class="mi">1</span>                # <span class="nv">Option</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">automatic</span> <span class="nv">generation</span> <span class="nv">of</span> <span class="nv">k</span> <span class="nv">points</span>,
<span class="nv">ngkpt</span>  <span class="mi">4</span> <span class="mi">4</span> <span class="mi">4</span>            # <span class="nv">This</span> <span class="nv">mesh</span> <span class="nv">is</span> <span class="nv">too</span> <span class="nv">coarse</span> <span class="k">for</span> <span class="nv">optical</span> <span class="nv">properties</span>.
<span class="nv">nshiftk</span> <span class="mi">1</span>
<span class="nv">shiftk</span>  <span class="mi">0</span>.<span class="mi">11</span> <span class="mi">0</span>.<span class="mi">21</span> <span class="mi">0</span>.<span class="mi">31</span>  # <span class="nv">This</span> <span class="nv">shift</span> <span class="nv">breaks</span> <span class="nv">the</span> <span class="nv">symmetry</span> <span class="nv">of</span> <span class="nv">the</span> <span class="nv">k</span><span class="o">-</span><span class="nv">mesh</span>.
<span class="nv">chksymbreak</span> <span class="mi">0</span>           # <span class="nv">Mandatory</span> <span class="k">for</span> <span class="nv">using</span> <span class="nv">symmetry</span><span class="o">-</span><span class="nv">breaking</span> <span class="nv">k</span><span class="o">-</span><span class="nv">meshes</span> <span class="nv">in</span> <span class="nv">the</span> <span class="nv">BS</span> <span class="nv">code</span>.
</code></pre></div>

<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The values of <a class="wikilink codevar-wikilink" href="/variables/basic#kptopt">kptopt</a>, <a class="wikilink codevar-wikilink" href="/variables/basic#ngkpt">ngkpt</a>, <a class="wikilink codevar-wikilink" href="/variables/basic#nshiftk">nshiftk</a>, and <a class="wikilink codevar-wikilink" href="/variables/basic#shiftk">shiftk</a> <strong>must equal</strong>
the ones used to specify the grid for the WFK file.
<a class="wikilink codevar-wikilink" href="/variables/gstate#chksymbreak">chksymbreak</a> = 0 is used to bypass the check on symmetry breaking that, otherwise, would make the code stop.</p>
</div>
<p>The last section of the input file</p>
<div class="codehilite"><pre><span></span><code><span class="nv">ecutwfn</span> <span class="mi">12</span>.<span class="mi">0</span>   # <span class="nv">Cutoff</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">wavefunction</span>.
<span class="nv">ecuteps</span> <span class="mi">2</span>.<span class="mi">0</span>   # <span class="nv">Cutoff</span> <span class="k">for</span> <span class="nv">W</span> <span class="nv">and</span> <span class="o">/</span><span class="nv">bare</span> <span class="nv">v</span> <span class="nv">used</span> <span class="nv">to</span> <span class="nv">calculate</span> <span class="nv">the</span> <span class="nv">BS</span> <span class="nv">matrix</span> <span class="nv">elements</span>.
<span class="nv">inclvkb</span> <span class="mi">2</span>     # <span class="nv">The</span> <span class="nv">Commutator</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">optical</span> <span class="nv">limit</span> <span class="nv">is</span> <span class="nv">correctly</span> <span class="nv">evaluated</span>.
</code></pre></div>

<p>specifies the parameters used to calculate the kernel matrix elements and the
matrix elements of the dipole operator.
We have already encountered these variables in the <a href="/tutorial/gw1">first GW tutorial</a> of the GW tutorial
so their meaning is (hopefully) familiar to you.
A more detailed discussion of the role played by these variables in the BS code
can be found in the <a class="wikilink theory-wikilink" href="/theory/bse">Bether-Salpeter notes</a>.</p>
<h3 id="output-files">Output files<a class="headerlink" href="#output-files" title="Permanent link">&para;</a></h3>
<p>The output file, <em>tbs_2.abo</em>, reports the basic parameters of the calculation
and eventual WARNINGs that are issued if the iterative method does not converge.
Please take some time to understand its structure.</p>
<p>Could you answer the following questions?</p>
<ol>
<li>How many transitions are included in the basis set?</li>
<li>How many directions are used to evaluate the optical limit?</li>
<li>What is the value of the Lorentzian broadening used in the continued fraction?</li>
</ol>
<p>After this digression on the main output file, we can finally proceed to
analyse the output data of the computation.</p>
<p>The most important results are stored in five different files:</p>
<ul>
<li><em>tbs_2o_BSR</em></li>
<li><em>tbs_2o_HAYDR_SAVE</em></li>
<li><em>tbs_2o_RPA_NLF_MDF</em></li>
<li><em>tbs_2o_GW_NLF_MDF</em></li>
<li><em>tbs_2o_EXC_MDF</em></li>
</ul>
<p>In what follows, we provide a brief description of the format and of the
content of each output file.</p>
<dl>
<dt>tbs_2o_BSR:</dt>
<dd>
<p>This binary file stores the upper triangle of the resonant block (the matrix
is Hermitian hence only the non-redundant part is computed and saved on file).
The BSR file can be used to restart the run from a previous computation using
the variables <a class="wikilink codevar-wikilink" href="/variables/files#getbsreso">getbsreso</a> or <a class="wikilink codevar-wikilink" href="/variables/files#irdbsreso">irdbsreso</a>. This restart capability is
useful for restarting the Haydock method if convergence was not achieved or to
execute Haydock computations with different values of <a class="wikilink codevar-wikilink" href="/variables/gw#zcut">zcut</a>. <a class="wikilink codevar-wikilink" href="/variables/files#getbsreso">getbsreso</a>
and <a class="wikilink codevar-wikilink" href="/variables/files#irdbsreso">irdbsreso</a> are also handy if one wants to include the coupling on top
of a pre-existing TDA calculation since the code uses two different files to
store the resonant and the coupling block (BSC is the prefix used for the
files storing the coupling term).</p>
</dd>
<dt>tbs_2o_HAYDR_SAVE:</dt>
<dd>
<p>It is a binary file containing the results of the Haydock method: the
coefficient of the tridiagonal matrix and the three vectors employed in the
iterative algorithm. It is usually used to restart the algorithm if
convergence has not been achieved (see the related input variables <a class="wikilink codevar-wikilink" href="/variables/files#gethaydock">gethaydock</a> and <a class="wikilink codevar-wikilink" href="/variables/files#irdhaydock">irdhaydock</a>).</p>
</dd>
<dt>tbs_2o_RPA_NLF_MDF and tbs_2o_GW_NLF_MDF</dt>
<dd>
<p>The RPA spectrum without local field effects obtained with KS energies and the
GW energies, respectively (mnemonics: NLF stands for No Local Field, while MDF
stands for Macroscopic Dielectric Function).</p>
</dd>
<dt>tbs_2o_EXC_MDF</dt>
<dd>
<p>Formatted file reporting the macroscopic dielectric function with excitonic effects.</p>
</dd>
</dl>
<p>The <em>EXC_MDF</em> file contains the most important results of our
calculation so it is worth spending some time to discuss its format.</p>
<p>First we have a header reporting the basic parameters of the calculation:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Macroscopic dielectric function obtained with the BS equation.</span>
<span class="c1">#  RPA L0 with KS energies and KS wavefunctions     LOCAL FIELD EFFECTS INCLUDED</span>
<span class="c1"># RESONANT-ONLY calculation</span>
<span class="c1"># Coulomb term constructed with full W(G1,G2)</span>
<span class="c1"># Scissor operator energy =  0.8000 [eV]</span>
<span class="c1"># Tolerance =  0.0500 0.0000</span>
<span class="c1"># npweps  = 27</span>
<span class="c1"># npwwfn  = 531</span>
<span class="c1"># nbands  = 8</span>
<span class="c1"># loband  = 2</span>
<span class="c1"># nkibz   = 64</span>
<span class="c1"># nkbz    = 64</span>
<span class="c1"># Lorentzian broadening =  0.1500 [eV]</span>
</code></pre></div>
<p>then the list of q-points giving the direction of the incident photon:</p>
<div class="highlight"><pre><span></span><code><span class="c1">#  List of q-points for the optical limit:</span>
<span class="c1"># q =  0.938821, 0.000000, 0.000000, [Reduced coords]</span>
<span class="c1"># q =  0.000000, 0.938821, 0.000000, [Reduced coords]</span>
<span class="c1"># q =  0.000000, 0.000000, 0.938821, [Reduced coords]</span>
<span class="c1"># q =  0.000000, 0.813043, 0.813043, [Reduced coords]</span>
<span class="c1"># q =  0.813043, 0.000000, 0.813043, [Reduced coords]</span>
<span class="c1"># q =  0.813043, 0.813043, 0.000000, [Reduced coords]</span>
</code></pre></div>
<p>By default the code calculates the macroscopic dielectric function considering
six different directions in q-space (the three basis vectors of the reciprocal
lattice and the three Cartesian axis). It is possible to specify custom
directions using the input variables <a class="wikilink codevar-wikilink" href="/variables/gw#gw_nqlwl">gw_nqlwl</a> and <a class="wikilink codevar-wikilink" href="/variables/gw#gw_qlwl">gw_qlwl</a>.</p>
<p>Then comes the section with the real and the imaginary part of the macroscopic
dielectric as a function of frequency for the different directions:</p>
<div class="highlight"><pre><span></span><code><span class="c1"># omega [eV]    RE(eps(q=1)) IM(eps(q=1) RE(eps(q=2) ) ... </span>
  <span class="m">0</span>.000   <span class="m">17</span>.9912    <span class="m">0</span>.0000   <span class="m">17</span>.9578    <span class="m">0</span>.0000   <span class="m">14</span>.2584    <span class="m">0</span>.0000   <span class="m">13</span>.9627    <span class="m">0</span>.0000   <span class="m">17</span>.0848    <span class="m">0</span>.0000   <span class="m">17</span>.0421    <span class="m">0</span>.0000
.... .... ...
</code></pre></div>
<p>You can visualize the data using your preferred software. For instance, with <a href="http://www.gnuplot.info/">gnuplot</a> </p>
<div class="highlight"><pre><span></span><code><span class="k">p</span> <span class="s">&quot;tbs_2o_EXC_MDF&quot;</span> <span class="nb">u</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span> <span class="nb">w</span> <span class="n">l</span>
</code></pre></div>
<p>will plot the imaginary part of the macroscopic dielectric function (the
absorption spectrum) for the first q-point. You should obtain a graphic
similar to the one reported below</p>
<p><img alt="" src="../bse_assets/tbs2_1.png" /></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>These results are not converged, we postpone the discussion
about convergence tests to the next paragraphs of this tutorial.</p>
</div>
<p>The most important feature of the spectrum is the presence of two peaks
located at around 3.4 and 4.3 eV. To understand the nature of these peaks and
the role played by the BS kernel, it is useful to compare the excitonic
spectra with the RPA results obtained without local field effects.</p>
<p>Use the sequence of gnuplot command</p>
<div class="highlight"><pre><span></span><code><span class="k">p</span>   <span class="s">&quot;tbs_2o_EXC_MDF&quot;</span>     <span class="nb">u</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span> <span class="nb">w</span> <span class="n">l</span>
<span class="k">rep</span> <span class="s">&quot;tbs_2o_RPA_NLF_MDF&quot;</span> <span class="nb">u</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span> <span class="nb">w</span> <span class="n">l</span>
<span class="k">rep</span> <span class="s">&quot;tbs_2o_GW_NLF_MDF&quot;</span>  <span class="nb">u</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span> <span class="nb">w</span> <span class="n">l</span>
</code></pre></div>
<p>to plot the absorption spectrum obtained with the three different approaches.
The final result is reported in the figure below.</p>
<p><img alt="" src="../bse_assets/tbs2_2.png" /></p>
<p>The RPA-KS spectrum underestimates the experimental optical threshold due to
the well know band gap problem of DFT. Most importantly, the amplitude of the
first peak is underestimated, a problem than is not solved when local-field
effects are correctly included in the calculation.</p>
<p>The RPA-GW results with QP corrections simulated with <a class="wikilink codevar-wikilink" href="/variables/gw#mbpt_sciss">mbpt_sciss</a> does not
show any significant improvement over RPA-KS: the RPA-GW spectrum is just
shifted towards higher frequencies due to opening of the gap, but the shape of
the two spectra is very similar, in particular the amplitude of the first peak
is still underestimated.</p>
<p>On the contrary, the inclusion of the BS kernel leads to important changes
both in the optical threshold as well as in the amplitude of the first peak.
This simple analysis tells us that the first peak in the absorption spectrum
of silicon has a strong excitonic character that is not correctly described
within the RPA. Our first BS spectrum is not converged at all and it barely
resembles the experimental result, nevertheless this unconverged calculation
is already able to capture the most important physics.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If <a href="https://github.com/abinit/abipy">AbiPy</a>  is installed on your machine, you can use the <a href="http://abinit.github.io/abipy/scripts/abiopen.html">abiopen.py</a>  script
with the <code>--expose</code> option to visualize the dielectric functions stored in the MDF.nc file:</p>
<div class="codehilite"><pre><span></span><code>abiopen.py tbs_2o_MDF.nc --expose --seaborn
</code></pre></div>

<p><img alt="" src="../bse_assets/abiopen_tbs_2o_MDF.png" /></p>
<p>For further information about the MDF file and the post-processing tools provided by AbiPy,
please consult the <a href="https://nbviewer.jupyter.org/github/abinit/abitutorials/blob/master/abitutorials/mdf.ipynb">MdfFile notebook</a> .</p>
</div>
<h3 id="optional-exercises">Optional Exercises<a class="headerlink" href="#optional-exercises" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Change the value of the Lorentzian broadening <a class="wikilink codevar-wikilink" href="/variables/gw#zcut">zcut</a> used to avoid divergences in the continued fraction.
  Then restart the Haydock algorithm from the <em>_BSR</em> and <em>_HAYDR_SAVE</em> files using the appropriate variables.
  What is the main effect of the broadening on the final spectrum.
  Does the number of iterations needed to converge depend on the broadening?</p>
</li>
<li>
<p>Use the appropriate values for <a class="wikilink codevar-wikilink" href="/variables/bse#bs_exchange_term">bs_exchange_term</a> and <a class="wikilink codevar-wikilink" href="/variables/bse#bs_coulomb_term">bs_coulomb_term</a> to calculate the BS spectrum
  without local field effects. Compare the results obtained with and without local field effects.</p>
</li>
<li>
<p>Modify the input file tbs_2.abi so that the code reads in the resonant block produced in the previous run
  and calculates the spectrum employing the method based on the direct diagonalization (use <a class="wikilink codevar-wikilink" href="/variables/files#irdbsreso">irdbsreso</a>
  to restart the run but remember to rename the file with the resonant block).
  Compare the CPU time needed by the two algorithms as a function of the number of transitions in the transition space.
  Which one has the best scaling?</p>
</li>
</ul>
<h3 id="preliminary-discussion-about-convergence-studies">Preliminary discussion about convergence studies<a class="headerlink" href="#preliminary-discussion-about-convergence-studies" title="Permanent link">&para;</a></h3>
<p>Converging the excitonic spectrum requires a careful analysis of many different parameters:</p>
<ul>
<li><a class="wikilink codevar-wikilink" href="/variables/bse#bs_loband">bs_loband</a></li>
<li><a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a></li>
<li><a class="wikilink codevar-wikilink" href="/variables/gw#ecutwfn">ecutwfn</a></li>
<li><a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a></li>
<li><a class="wikilink codevar-wikilink" href="/variables/basic#ngkpt">ngkpt</a></li>
<li><a class="wikilink codevar-wikilink" href="/variables/basic#nshiftk">nshiftk</a></li>
<li><a class="wikilink codevar-wikilink" href="/variables/basic#shiftk">shiftk</a></li>
</ul>
<p>Since the memory requirements scale quadratically with the number of k-points
in the <strong>full</strong> Brillouin zone <strong>times</strong> the number of valence bands
<strong>times</strong> the number of conduction bands included in the transition space,
it is very important to find a good compromise between accuracy and computational efficiency.</p>
<p>First of all one should select the frequency range of interest since this
choice has an important effect on the number of valence and conduction states
that have to be included in the transition space. The optical spectrum is
expected to converge faster in the number of bands than the GW corrections
since only those transitions whose energy is &ldquo;close&rdquo; to the frequency range
under investigation are expected to contribute.</p>
<p><a class="wikilink codevar-wikilink" href="/variables/gw#ecutwfn">ecutwfn</a> usually plays a secondary role since it only affects the accuracy
of the oscillator matrix elements. We suggest avoiding any truncation of the
initial basis set by setting <a class="wikilink codevar-wikilink" href="/variables/gw#ecutwfn">ecutwfn</a> to a value slightly larger than the
value of <a class="wikilink codevar-wikilink" href="/variables/basic#ecut">ecut</a> used to generate the WFK file. One should truncate the
initial planewave basis set only when experiencing memory problems although
this kind of problems can be usually solved by just increasing the number of
processors or, alternatively, with an appropriate choice of <a class="wikilink codevar-wikilink" href="/variables/gw#gwmem">gwmem</a>.</p>
<p>The value of <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a> affects the accuracy of the matrix elements of the
Coulomb term, the fundamental term that drives the creation of the excitons.
As a consequence <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a> should be subject to an accurate convergence
test. As a rule of thumb, <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a> can be chosen equal or, sometimes, even
smaller than the value needed to converge the GW corrections.</p>
<p>As already stated: optical spectra converge slowly with the Brillouin zone
sampling. The convergence in the number of k-points thus represents the most
important and tedious part of our convergence study. For this reason, this
study should be done once converged values for the other parameters have been already found.</p>
<h2 id="convergence-with-respect-to-the-number-of-bands-in-the-transition-space">Convergence with respect to the number of bands in the transition space<a class="headerlink" href="#convergence-with-respect-to-the-number-of-bands-in-the-transition-space" title="Permanent link">&para;</a></h2>
<p>In this section we take advantage of the multi-dataset capabilities of ABINIT
to perform calculations with different values for <a class="wikilink codevar-wikilink" href="/variables/bse#bs_loband">bs_loband</a> and <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a></p>
<p>Before running the test take some time to read the input file <em>$ABI_TESTS/tutorial/Input/tbs_3.abi</em>.</p>
<div class="text-center"><button id="uuid-2b3fa11a-84fe-4a09-97af-0ee124b96cdb" class="md-button md-button--secondary"> View tests/tutorial/Input/tbs_3.abi </button></div>
<div id="uuid-558828d8-82c2-4486-9709-22024bb818ef" class="my_dialog" title="tests/tutorial/Input/tbs_3.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Crystalline silicon</span>
<span class="c1"># Convergence of the number of bands in the transition space.</span>

ndtset     <span class="m">2</span>
<span class="c1">#bs_loband1  4 nband1  5</span>
bs_loband1  <span class="m">3</span> nband1  <span class="m">6</span>
bs_loband2  <span class="m">2</span> nband2  <span class="m">7</span>
bs_loband3  <span class="m">2</span> nband3  <span class="m">8</span>
<span class="c1">#bs_loband5  1 nband5  8</span>

bs_coulomb_term      <span class="m">10</span> <span class="c1"># Coulomb term evaluated within the diagonal approximation.</span>

irdwfk  <span class="m">1</span>
irdscr  <span class="m">1</span>

<span class="c1">#getwfk  20              # Trick to read the same file tbs_o3_DS20_WFK in each dataset</span>
<span class="c1">#getscr  20              # Same trick for the SCR file</span>



<span class="c1"># Definition of the k-point grid</span>
<span class="c1"># MUST equal the grid used for generating the WFK file.</span>
kptopt <span class="m">1</span>          <span class="c1"># Option for the automatic generation of k points,</span>
ngkpt  <span class="m">4</span> <span class="m">4</span> <span class="m">4</span> 
nshiftk <span class="m">1</span>
chksymbreak <span class="m">0</span>             <span class="c1"># Mandatory for using symmetry-breaking k-meshes in the BS code.</span>
shiftk    <span class="m">0</span>.11 <span class="m">0</span>.21 <span class="m">0</span>.31  <span class="c1"># This shift breaks the symmetry of the k-mesh.</span>

<span class="c1"># BSE run with Haydock iterative method (only resonant + W + v)</span>
optdriver <span class="m">99</span>  <span class="c1"># BS calculation</span>

bs_calctype       <span class="m">1</span>
mbpt_sciss          <span class="m">0</span>.8 eV  <span class="c1"># Scissors operator used to correct the KS band structure.</span>
bs_exchange_term  <span class="m">1</span>       <span class="c1"># Exchange term included.</span>
bs_coupling       <span class="m">0</span>       <span class="c1"># Tamm-Dancoff approximation.</span>


bs_freq_mesh <span class="m">0</span> <span class="m">6</span> <span class="m">0</span>.02 eV  <span class="c1"># Frequency mesh.</span>

bs_algorithm        <span class="m">2</span>      <span class="c1"># Haydock method.</span>
bs_haydock_niter   <span class="m">100</span>     <span class="c1"># Max number of iterations for the Haydock method.</span>
bs_haydock_tol     <span class="m">0</span>.05 <span class="m">0</span>  <span class="c1"># Tolerance for the iterative method.</span>
zcut               <span class="m">0</span>.15 eV <span class="c1"># complex shift to avoid divergences in the continued fraction.</span>

ecutwfn <span class="m">12</span>.0               <span class="c1"># Cutoff for the wavefunction.</span>
ecuteps <span class="m">2</span>.0               <span class="c1"># Cutoff for W and /bare v used to calculate the BS matrix elements.</span>
inclvkb <span class="m">2</span>
gw_icutcoul <span class="m">3</span>               <span class="c1"># Legacy value</span>

<span class="c1"># VARIABLES COMMON TO THE DIFFERENT DATASETS</span>

<span class="c1"># Definition of the unit cell: fcc</span>
acell <span class="m">3</span>*10.217         <span class="c1"># This is equivalent to   10.217 10.217 10.217</span>
rprim  <span class="m">0</span>.0  <span class="m">0</span>.5  <span class="m">0</span>.5   <span class="c1"># FCC primitive vectors (to be scaled by acell)</span>
       <span class="m">0</span>.5  <span class="m">0</span>.0  <span class="m">0</span>.5
       <span class="m">0</span>.5  <span class="m">0</span>.5  <span class="m">0</span>.0

<span class="c1"># Definition of the atom types</span>
ntypat <span class="m">1</span>         <span class="c1"># There is only one type of atom</span>
znucl <span class="m">14</span>         <span class="c1"># The keyword &quot;zatnum&quot; refers to the atomic number of the</span>
                 <span class="c1"># possible type(s) of atom. The pseudopotential(s)</span>
                 <span class="c1"># mentioned in the &quot;files&quot; file must correspond</span>
                 <span class="c1"># to the type(s) of atom. Here, the only type is Silicon.</span>

<span class="c1"># Definition of the atoms</span>
natom <span class="m">2</span>           <span class="c1"># There are two atoms</span>
typat <span class="m">1</span> <span class="m">1</span>         <span class="c1"># They both are of type 1, that is, Silicon.</span>
xred              <span class="c1"># Reduced coordinate of atoms</span>
   <span class="m">0</span>.0  <span class="m">0</span>.0  <span class="m">0</span>.0
   <span class="m">0</span>.25 <span class="m">0</span>.25 <span class="m">0</span>.25

<span class="c1"># Definition of the planewave basis set </span>
ecut <span class="m">12</span>         <span class="c1"># Maximal kinetic energy cut-off, in Hartree</span>

istwfk *1
nstep  <span class="m">50</span>      <span class="c1"># Maximal number of SCF cycles</span>
diemac <span class="m">12</span>.0


 pp_dirpath <span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span>
 pseudos <span class="s2">&quot;Pseudodojo_nc_sr_04_pw_standard_psp8/Si.psp8&quot;</span>

<span class="c1">##############################################################</span>
<span class="c1"># This section is used only for regression testing of ABINIT #</span>
<span class="c1">##############################################################</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% test_chain = tbs_1.abi, tbs_2.abi, tbs_3.abi, tbs_4.abi</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tbs_3.abo, tolnlines= 10, tolabs=  1.1e-2,    tolrel=  4.0e-2, fld_options = -ridiculous</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 4</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Giantomassi</span>
<span class="c1">#%% keywords = GW, BSE</span>
<span class="c1">#%% description = </span>
<span class="c1">#%%   Crystalline silicon</span>
<span class="c1">#%%   Convergence of the number of bands in the transition space.</span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-558828d8-82c2-4486-9709-22024bb818ef", "#uuid-2b3fa11a-84fe-4a09-97af-0ee124b96cdb") }); </script>

<p>The convergence in the number of transitions is performed by defining two
datasets with different values for <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a> and <a class="wikilink codevar-wikilink" href="/variables/bse#bs_loband">bs_loband</a></p>
<div class="codehilite"><pre><span></span><code>ndtset     2
bs_loband1  3 nband1  6
bs_loband2  2 nband2  7
</code></pre></div>

<p>The parameters defining how to build the excitonic Hamiltonian are similar to
the ones used in <em>tbs_2.abi</em>. The only difference is in the value used for <a class="wikilink codevar-wikilink" href="/variables/bse#bs_coulomb_term">bs_coulomb_term</a>, <em>i.e.</em></p>
<div class="codehilite"><pre><span></span><code>bs_coulomb_term  10  # Coulomb term evaluated within the diagonal approximation.
</code></pre></div>

<p>that allows us to save some CPU time during the computation of the Coulomb term.</p>
<p>Also in this case, before running the test, we have to connect <em>tbs_3.abi</em> to the
WFK and the SCR file produced in the first step. Note that <em>tbs_3.abi</em> uses
<a class="wikilink codevar-wikilink" href="/variables/files#irdwfk">irdwfk</a> and <a class="wikilink codevar-wikilink" href="/variables/files#irdscr">irdscr</a> to read the external files, hence we have to create
symbolic links for each dataset:</p>
<div class="highlight"><pre><span></span><code>ln -s 444_SCR tbs_3i_DS1_SCR
ln -s 444_SCR tbs_3i_DS2_SCR
ln -s 444_shifted_WFK tbs_3i_DS1_WFK
ln -s 444_shifted_WFK tbs_3i_DS2_WFK
</code></pre></div>
<p>Now we can finally run the test with</p>
<div class="codehilite"><pre><span></span><code>abinit tbs_3.abi &gt; tbs3.log 2&gt; err &amp;
</code></pre></div>

<p>This job should last 3-4 minutes so be patient!</p>
<p>Let us hope that your calculation has been completed, and that we can examine
the output results.</p>
<p>Use the following sequence of <a href="http://www.gnuplot.info/">gnuplot</a>  commands:</p>
<div class="highlight"><pre><span></span><code><span class="k">p</span>   <span class="s">&quot;tbs_3o_DS1_EXC_MDF&quot;</span> <span class="nb">u</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span> <span class="nb">w</span> <span class="n">l</span>
<span class="k">rep</span> <span class="s">&quot;tbs_3o_DS2_EXC_MDF&quot;</span> <span class="nb">u</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span> <span class="nb">w</span> <span class="n">l</span>
</code></pre></div>
<p>to plot on the same graphic the absorption spectrum obtained with different
transition spaces. You should obtain a graphic similar (but not equal) to this one</p>
<p><img alt="" src="../bse_assets/tbs3.png" /></p>
<p>Note indeed that the above figure has been produced with more datasets in order
to highlight the convergence behaviour.</p>
<p>The results obtained with (<a class="wikilink codevar-wikilink" href="/variables/bse#bs_loband">bs_loband</a> = 4, <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a> = 5) are clearly
unconverged as the basis set contains too few transitions that are not able to
describe the frequency-dependence of the polarizability in the energy range
under investigation. For a converged spectrum, we have to include the
three higher occupied states and the first four conduction bands (the blue
curve corresponding to <a class="wikilink codevar-wikilink" href="/variables/bse#bs_loband">bs_loband</a> = 2, and <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a> = 7).</p>
<p>Note that adding the first occupied band, curve (1-8), gives results that are
almost on top of (2,8). This is due to the fact that, in silicon, the bottom
of the first band is located at around 12 eV from the top of the conduction
band therefore its inclusion does not lead to any significant improvement of
the transition space in the frequency range [0, 8] eV. For completeness, we
also report the results obtained in a separate calculation done with
<a class="wikilink codevar-wikilink" href="/variables/bse#bs_loband">bs_loband</a> = 2 <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a> = 9 to show that four empty states are enough to converge the spectrum.</p>
<p>We therefore fix the number of bands for the transition space using
<a class="wikilink codevar-wikilink" href="/variables/bse#bs_loband">bs_loband</a> = 2, <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a> = 7 and we proceed to analyse the
convergence of the spectrum with respect to the number of planewaves in the screening.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If <a href="https://github.com/abinit/abipy">AbiPy</a>  is installed on your machine, you can use the <a href="http://abinit.github.io/abipy/scripts/abicomp.html">abicomp.py</a>  script
with the <code>mdf</code> command and the <code>--expose</code> option to compare
multiple dielectric functions:</p>
<div class="codehilite"><pre><span></span><code>abicomp.py mdf tbs_3o_DS*_MDF.nc --expose --seaborn
</code></pre></div>

<p><img alt="" src="../bse_assets/abicomp_tbs_3o.png" /></p>
</div>
<h3 id="tips-for-expert-users">Tips for expert users<a class="headerlink" href="#tips-for-expert-users" title="Permanent link">&para;</a></h3>
<p>The use of <a class="wikilink codevar-wikilink" href="/variables/files#irdwfk">irdwfk</a> and <a class="wikilink codevar-wikilink" href="/variables/files#irdscr">irdscr</a> is not handy when we have several
datasets that are reading the <strong>same</strong> external file as we are forced to use
different names for the input of each dataset. To work around this annoyance,
one can introduce a fictitious dataset (say dataset 99), and let the code use
the output of this nonexistent dataset as the input of the real datasets. An
example will help clarify: Instead of using the lengthy list of links as done
before, we might use the much simpler sequence of commands</p>
<div class="codehilite"><pre><span></span><code>ln -s 444_shifted_WFK tbs_3o_DS99_WFK
ln -s 444_SCR         tbs_3o_DS99_SCR
</code></pre></div>

<p>provided that, in the input file, we replace <a class="wikilink codevar-wikilink" href="/variables/files#irdwfk">irdwfk</a> and <a class="wikilink codevar-wikilink" href="/variables/files#irdscr">irdscr</a> with</p>
<div class="codehilite"><pre><span></span><code><span class="nv">getwfk</span>  <span class="mi">99</span>   # <span class="nv">Trick</span> <span class="nv">to</span> <span class="nv">read</span> <span class="nv">the</span> <span class="nv">same</span> <span class="nv">file</span> <span class="nv">tbs_o3_DS99_WFK</span> <span class="nv">in</span> <span class="nv">each</span> <span class="nv">dataset</span>
<span class="nv">getscr</span>  <span class="mi">99</span>   # <span class="nv">Same</span> <span class="nv">trick</span> <span class="k">for</span> <span class="nv">the</span> <span class="nv">SCR</span> <span class="nv">file</span>
</code></pre></div>

<h2 id="convergence-with-respect-to-the-number-of-planewaves-in-the-screening">Convergence with respect to the number of planewaves in the screening<a class="headerlink" href="#convergence-with-respect-to-the-number-of-planewaves-in-the-screening" title="Permanent link">&para;</a></h2>
<p>First of all, before running the calculation, take some time to understand
what is done in <em>$ABI_TESTS/tutorial/Input/tbs_4.abi</em>.</p>
<p>The structure of the input file is very similar to the one of <em>tbs_3.abi</em>, the
main difference is in the first section:</p>
<div class="codehilite"><pre><span></span><code>ndtset    2
ecuteps: 2 ecuteps+ 1
bs_coulomb_term 11
</code></pre></div>

<p>that instructs the code to execute two calculations where the direct term is
constructed using different value of <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a>. We also relax the diagonal-only
approximation for the screening by setting <a class="wikilink codevar-wikilink" href="/variables/bse#bs_coulomb_term">bs_coulomb_term</a> = 11 so that
the non-locality of <span><span class="MathJax_Preview">W(\rr, \rr')</span><script type="math/tex">W(\rr, \rr')</script></span> is correctly taken into account.</p>
<p>It is important to stress that it is not necessary to recalculate the SCR file
from scratch just to modify the value of <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a> used in the BS run. The
SCR file calculated in the preparatory step contains G-vectors whose energy
extends up to ecuteps = 6.0 Ha. This is the <strong>maximum</strong> cutoff energy that can be
used in our convergence tests. If the value of <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a> specified in the
input file is smaller than the one stored on disk, the code will read a sub-
block of the initial matrix. A WARNING message is issued if the value
specified in the input file is larger than the one available in the SCR file.</p>
<p>Now we can finally run the calculation. As usual, we have to copy
<em>$ABI_TESTS/tutorial/Input/tbs_4.abi</em> in the working directory <em>Work_bs</em>,
then we have to create a bunch of symbolic links for the input WFK and SCR files:</p>
<div class="codehilite"><pre><span></span><code>ln -s 444_SCR tbs_4i_DS1_SCR
ln -s 444_SCR tbs_4i_DS2_SCR
ln -s 444_shifted_WFK tbs_4i_DS1_WFK
ln -s 444_shifted_WFK tbs_4i_DS2_WFK
</code></pre></div>

<p>Now issue</p>
<div class="codehilite"><pre><span></span><code>abinit tbs_4.abi &gt; tbs4.log 2&gt; err &amp;
</code></pre></div>

<p>to execute the test (it should take around 2 minutes).</p>
<div class="text-center"><button id="uuid-56087165-2ae1-42d7-9e63-975cb194e5ff" class="md-button md-button--secondary"> View tests/tutorial/Input/tbs_4.abi </button></div>
<div id="uuid-fe0722a6-a0c3-49e7-b3f6-6fb8894e360a" class="my_dialog" title="tests/tutorial/Input/tbs_4.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Crystalline silicon</span>
<span class="c1"># BS run: convergence in ecuteps </span>

ndtset    <span class="m">2</span>
ecuteps: <span class="m">2</span> ecuteps+ <span class="m">1</span>
bs_loband <span class="m">2</span>  nband  <span class="m">7</span>
bs_coulomb_term   <span class="m">11</span>    <span class="c1"># Full Coulomb term </span>

irdwfk  <span class="m">1</span>
irdscr  <span class="m">1</span>

<span class="c1">#getwfk  20              # Trick to read the same file tbs_o3_DS20_WFK in each dataset</span>
<span class="c1">#getscr  20              # Same trick for the SCR file</span>

<span class="c1"># Definition of the k-point grid</span>
<span class="c1"># MUST be equal to the grid used for generating the WFK file.</span>
kptopt <span class="m">1</span>                  <span class="c1"># Option for the automatic generation of k points,</span>
ngkpt  <span class="m">4</span> <span class="m">4</span> <span class="m">4</span>              <span class="c1"># This mesh is too coarse for optical properties.</span>
nshiftk <span class="m">1</span>
chksymbreak <span class="m">0</span>             <span class="c1"># Mandatory for using symmetry-breaking k-meshes in the BS code.</span>
shiftk    <span class="m">0</span>.11 <span class="m">0</span>.21 <span class="m">0</span>.31  <span class="c1"># This shift breaks the symmetry of the k-mesh.</span>

<span class="c1"># BSE run with Haydock iterative method (only resonant + W + v)</span>
optdriver <span class="m">99</span>  <span class="c1"># BS calculation</span>

bs_calctype       <span class="m">1</span>
mbpt_sciss          <span class="m">0</span>.8 eV  <span class="c1"># Scissors operator used to correct the KS band structure.</span>
bs_exchange_term  <span class="m">1</span>       <span class="c1"># Exchange term included.</span>
bs_coupling       <span class="m">0</span>       <span class="c1"># Tamm-Dancoff approximation.</span>


bs_freq_mesh <span class="m">0</span> <span class="m">6</span> <span class="m">0</span>.02 eV  <span class="c1"># Frequency mesh.</span>

bs_algorithm        <span class="m">2</span>      <span class="c1"># Haydock method.</span>
bs_haydock_niter   <span class="m">100</span>     <span class="c1"># Max number of iterations for the Haydock method.</span>
bs_haydock_tol     <span class="m">0</span>.05 <span class="m">0</span>  <span class="c1"># Tolerance for the iterative method.</span>
zcut               <span class="m">0</span>.15 eV <span class="c1"># complex shift to avoid divergences in the continued fraction.</span>

ecutwfn <span class="m">12</span>.0               <span class="c1"># Cutoff for the wavefunction.</span>
inclvkb <span class="m">2</span>
gw_icutcoul <span class="m">3</span>                <span class="c1"># Legacy value</span>

<span class="c1"># VARIABLES COMMON TO THE DIFFERENT DATASETS</span>

<span class="c1"># Definition of the unit cell: fcc</span>
acell <span class="m">3</span>*10.217         <span class="c1"># This is equivalent to   10.217 10.217 10.217</span>
rprim  <span class="m">0</span>.0  <span class="m">0</span>.5  <span class="m">0</span>.5   <span class="c1"># FCC primitive vectors (to be scaled by acell)</span>
       <span class="m">0</span>.5  <span class="m">0</span>.0  <span class="m">0</span>.5
       <span class="m">0</span>.5  <span class="m">0</span>.5  <span class="m">0</span>.0

<span class="c1"># Definition of the atom types</span>
ntypat <span class="m">1</span>         <span class="c1"># There is only one type of atom</span>
znucl <span class="m">14</span>         <span class="c1"># The keyword &quot;zatnum&quot; refers to the atomic number of the</span>
                 <span class="c1"># possible type(s) of atom. The pseudopotential(s)</span>
                 <span class="c1"># mentioned in the &quot;files&quot; file must correspond</span>
                 <span class="c1"># to the type(s) of atom. Here, the only type is Silicon.</span>

<span class="c1"># Definition of the atoms</span>
natom <span class="m">2</span>           <span class="c1"># There are two atoms</span>
typat <span class="m">1</span> <span class="m">1</span>         <span class="c1"># They both are of type 1, that is, Silicon.</span>
xred              <span class="c1"># Reduced coordinate of atoms</span>
   <span class="m">0</span>.0  <span class="m">0</span>.0  <span class="m">0</span>.0
   <span class="m">0</span>.25 <span class="m">0</span>.25 <span class="m">0</span>.25

<span class="c1"># Definition of the planewave basis set </span>
ecut <span class="m">12</span>         <span class="c1"># Maximal kinetic energy cut-off, in Hartree</span>

istwfk *1
nstep  <span class="m">50</span>      <span class="c1"># Maximal number of SCF cycles</span>
diemac <span class="m">12</span>.0


 pp_dirpath <span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span>
 pseudos <span class="s2">&quot;Pseudodojo_nc_sr_04_pw_standard_psp8/Si.psp8&quot;</span>

<span class="c1">##############################################################</span>
<span class="c1"># This section is used only for regression testing of ABINIT #</span>
<span class="c1">##############################################################</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% test_chain = tbs_1.abi, tbs_2.abi, tbs_3.abi, tbs_4.abi</span>
<span class="c1">#%% [files]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tbs_4.abo, tolnlines= 10, tolabs=  1.1e-2,    tolrel=  4.0e-2, fld_options = -ridiculous</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 4</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = M. Giantomassi</span>
<span class="c1">#%% keywords = GW, BSE</span>
<span class="c1">#%% description = </span>
<span class="c1">#%%   Crystalline silicon</span>
<span class="c1">#%%   BS run: convergence in ecuteps </span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-fe0722a6-a0c3-49e7-b3f6-6fb8894e360a", "#uuid-56087165-2ae1-42d7-9e63-975cb194e5ff") }); </script>

<p>Once the calculation is completed, plot the spectra obtained with different <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a> using <a href="http://www.gnuplot.info/">gnuplot</a> :</p>
<div class="highlight"><pre><span></span><code><span class="k">p</span> <span class="s">&quot;tbs_4o_DS1_EXC_MDF&quot;</span> <span class="nb">u</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span> <span class="nb">w</span> <span class="n">l</span>
<span class="k">rep</span> <span class="s">&quot;tbs_4o_DS2_EXC_MDF&quot;</span> <span class="nb">u</span> <span class="mi">1</span><span class="o">:</span><span class="mi">3</span> <span class="nb">w</span> <span class="n">l</span>
</code></pre></div>
<p>Here we show the results of a convergence study done with <em>four</em> different values or <code>ecuteps</code>
to highlight the convergence behavior:</p>
<p><img alt="" src="../bse_assets/tbs4.png" /></p>
<p>The spectrum is found to converge quickly in <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a>. The curves obtained
with <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a> = 3 and 4 Ha are almost indistinguishable from each other. Our
final estimate for <a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a> is therefore 3 Ha.</p>
<p>Note that this value is smaller than the one required to converge the QP
corrections within 0.01 eV (in the <a href="/tutorial/gw1">first GW tutorial</a> of the GW
tutorial we obtained 6.0 Ha). This is a general behavior, in the sense that
Bethe-Salpeter spectra, unlike GW corrections, are not very sensitive
to truncations in the planewave expansion of W. Reasonable BS spectra are
obtained even when W is treated within the diagonal approximation or,
alternatively, with model dielectric functions.</p>
<p>Note also how the two peaks are affected in a different way by the change of
<a class="wikilink codevar-wikilink" href="/variables/gw#ecuteps">ecuteps</a>, with the first peak affected the most. This behavior is
consistent with our affirmation that the first peak of silicon has a strong excitonic character.</p>
<h2 id="convergence-with-respect-to-the-number-of-k-points">Convergence with respect to the number of k-points<a class="headerlink" href="#convergence-with-respect-to-the-number-of-k-points" title="Permanent link">&para;</a></h2>
<p>The last parameter that should be checked for convergence is the number of
k-points. This convergence study represents the most tedious and difficult
part since it requires the generation of new WFK files and of the new SCR file
for each k-mesh (the list of k-points for the wavefunctions and the set of
q-points in the screening must be consistent with each other).</p>
<p>The file <em>$ABI_TESTS/tutorial/Input/tbs_5.abi</em> gathers the different steps of
a standard BS calculation (generation of two WFK file, screening calculation,
BS run) into a single input. The calculation is done with the converged
parameters found in the previous studies, only <a class="wikilink codevar-wikilink" href="/variables/basic#ngkpt">ngkpt</a> has been intentionally left undefined.</p>
<div class="text-center"><button id="uuid-67ca4b20-e78d-4c74-872b-d095936b724a" class="md-button md-button--secondary"> View tests/tutorial/Input/tbs_5.abi </button></div>
<div id="uuid-3b00d4c5-efe4-4c38-ae59-e2295262dd79" class="my_dialog" title="tests/tutorial/Input/tbs_5.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1"># Crystalline silicon </span>
<span class="c1"># Template for converge study on ngkpt</span>
<span class="c1"># 1) GS</span>
<span class="c1"># 2) generation of the WFK file on a symmetric k-mesh</span>
<span class="c1"># 3) generation of the WFK file on a shifted k-mesh that breaks the symmetry of the BZ sampling</span>
<span class="c1"># 4) SCR calculation using the WFK generated in the second dataset </span>
<span class="c1"># 5) BS run with Haydock method (no coupling)</span>
<span class="c1">#</span>
ndtset <span class="m">5</span>

<span class="c1"># Definition of the k-point grid</span>
kptopt <span class="m">1</span>             <span class="c1"># Option for the automatic generation of k points,</span>
ngkpt  <span class="m">5</span> <span class="m">5</span> <span class="m">5</span>
nshiftk <span class="m">1</span>
shiftk  <span class="m">0</span>.0 <span class="m">0</span>.0 <span class="m">0</span>.0  <span class="c1"># Gamma-centered k-mesh is </span>

<span class="c1"># Dataset1: self-consistent calculation</span>
tolvrs1 <span class="m">1</span>.0d-8
prtden1 <span class="m">1</span>

<span class="c1"># Dataset2: definition of parameters for the calculation of the wfk file on the symmetric k-mesh.</span>
iscf2    -2       <span class="c1"># non self-consistency, read previous density file</span>
getden2  <span class="m">1</span>
tolwfr2  <span class="m">1</span>.0d-8  
nband2    <span class="m">105</span>
nbdbuf2    <span class="m">5</span>      <span class="c1"># The last five states are excluded from the converge check</span>

<span class="c1"># Dataset3: calculation of the WFK file on the shifted k-mesh to break the symmetry.</span>
iscf3    -2 <span class="c1"># non self-consistency, read previous density file</span>
getden3   <span class="m">1</span>
tolwfr3  <span class="m">1</span>.0d-8  
nband3    <span class="m">15</span>            <span class="c1"># Here we can reduce the number of bands since this WFK file is only used in the BS run.</span>
nbdbuf3    <span class="m">5</span>            <span class="c1"># The last five states are excluded from the converge check</span>
chksymbreak3 <span class="m">0</span>          <span class="c1"># To skip the check on the k-mesh.</span>
shiftk3    <span class="m">0</span>.11 <span class="m">0</span>.21 <span class="m">0</span>.31  <span class="c1"># This shift breaks the symmetry of the k-mesh.</span>

<span class="c1"># Dataset3: creation of the screening (eps^-1) matrix</span>
optdriver4 <span class="m">3</span>
gwpara4    <span class="m">2</span>
inclvkb4   <span class="m">2</span>
awtr4      <span class="m">1</span>
symchi4    <span class="m">1</span>
getwfk4    <span class="m">2</span>
ecuteps4   <span class="m">6</span>
ecutwfn4   <span class="m">8</span>
nband4    <span class="m">100</span>
nfreqre4   <span class="m">1</span>   <span class="c1"># Only the static limit is needed for standard BSE calculations.</span>
nfreqim4   <span class="m">0</span>

<span class="c1"># BSE run with Haydock iterative method (only resonant + W + v)</span>
optdriver5 <span class="m">99</span>              <span class="c1"># BS calculation</span>
getscr5    <span class="m">4</span>
getwfk5    <span class="m">3</span>               <span class="c1"># Read the WFK generated on the shifted k-mesh.</span>
chksymbreak5 <span class="m">0</span>          <span class="c1"># To skip the check on the k-mesh.</span>
shiftk5    <span class="m">0</span>.11 <span class="m">0</span>.21 <span class="m">0</span>.31  <span class="c1"># This shift breaks the symmetry of the k-mesh.</span>

bs_calctype5       <span class="m">1</span>
mbpt_sciss5          <span class="m">0</span>.8 eV  <span class="c1"># Scissors operator used to correct the KS band structure.</span>
bs_exchange_term5  <span class="m">1</span>       <span class="c1"># Exchange term included.</span>
bs_coulomb_term5   <span class="m">11</span>
bs_coupling5       <span class="m">0</span>       <span class="c1"># Tamm-Dancoff approximation.</span>

bs_loband5 <span class="m">2</span>  
nband5     <span class="m">8</span>
ecuteps5   <span class="m">3</span>

bs_freq_mesh5 <span class="m">0</span> <span class="m">6</span> <span class="m">0</span>.02 eV  <span class="c1"># Frequency mesh.</span>

bs_algorithm5        <span class="m">2</span>      <span class="c1"># Haydock method.</span>
bs_haydock_niter5   <span class="m">100</span>     <span class="c1"># Max number of iterations for the Haydock method.</span>
bs_haydock_tol5     <span class="m">0</span>.05 <span class="m">0</span>  <span class="c1"># Tolerance for the iterative method.</span>
zcut5               <span class="m">0</span>.1 eV  <span class="c1"># complex shift to avoid divergences in the continued fraction.</span>

ecutwfn5 <span class="m">8</span>.0               <span class="c1"># Cutoff for the wavefunction.</span>
inclvkb5 <span class="m">2</span>

<span class="c1"># VARIABLES COMMON TO THE DIFFERENT DATASETS</span>

<span class="c1"># Definition of the unit cell: fcc</span>
acell <span class="m">3</span>*10.217         <span class="c1"># This is equivalent to   10.217 10.217 10.217</span>
rprim  <span class="m">0</span>.0  <span class="m">0</span>.5  <span class="m">0</span>.5   <span class="c1"># FCC primitive vectors (to be scaled by acell)</span>
       <span class="m">0</span>.5  <span class="m">0</span>.0  <span class="m">0</span>.5
       <span class="m">0</span>.5  <span class="m">0</span>.5  <span class="m">0</span>.0

<span class="c1"># Definition of the atom types</span>
ntypat <span class="m">1</span>         <span class="c1"># There is only one type of atom</span>
znucl <span class="m">14</span>         <span class="c1"># The keyword &quot;zatnum&quot; refers to the atomic number of the</span>
                 <span class="c1"># possible type(s) of atom. The pseudopotential(s)</span>
                 <span class="c1"># mentioned in the &quot;files&quot; file must correspond</span>
                 <span class="c1"># to the type(s) of atom. Here, the only type is Silicon.</span>

<span class="c1"># Definition of the atoms</span>
natom <span class="m">2</span>           <span class="c1"># There are two atoms</span>
typat <span class="m">1</span> <span class="m">1</span>         <span class="c1"># They both are of type 1, that is, Silicon.</span>
xred              <span class="c1"># Reduced coordinate of atoms</span>
   <span class="m">0</span>.0  <span class="m">0</span>.0  <span class="m">0</span>.0
   <span class="m">0</span>.25 <span class="m">0</span>.25 <span class="m">0</span>.25

<span class="c1"># Definition of the planewave basis set </span>
ecut <span class="m">8</span>         <span class="c1"># Maximal kinetic energy cut-off, in Hartree</span>

istwfk *1
nstep  <span class="m">50</span>      <span class="c1"># Maximal number of SCF cycles</span>
diemac <span class="m">12</span>.0


 pp_dirpath <span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span>
 pseudos <span class="s2">&quot;PseudosTM_pwteter/14si.pspnc&quot;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-3b00d4c5-efe4-4c38-ae59-e2295262dd79", "#uuid-67ca4b20-e78d-4c74-872b-d095936b724a") }); </script>

<p>Use <em>tbs_5.abi</em> as a template for performing BS calculations with different
k-meshes. For example, you might try to compare the three meshes 4x4x4, 5x5x5,
and 6x6x6. To facilitate the analysis of the results, we suggest to run the
calculations in different directories so that we can keep the output results separated.</p>
<p>Be aware that both the CPU time as well as the memory requirements increase
quickly with the number of divisions in the mesh. These are, for example, the
CPU times required by different k-meshes on Intel Xeon X5570:</p>
<div class="codehilite"><pre><span></span><code><span class="mf">4</span><span class="n">x4x4</span><span class="p">:</span>    <span class="o">+</span><span class="n">Overall</span> <span class="n">time</span> <span class="n">at</span> <span class="kr">end</span> <span class="p">(</span><span class="n">sec</span><span class="p">)</span> <span class="p">:</span> <span class="n">cpu</span><span class="o">=</span>        <span class="mf">112.4</span>  <span class="n">wall</span><span class="o">=</span>        <span class="mf">112.4</span>
<span class="mf">5</span><span class="n">x5x5</span><span class="p">:</span>    <span class="o">+</span><span class="n">Overall</span> <span class="n">time</span> <span class="n">at</span> <span class="kr">end</span> <span class="p">(</span><span class="n">sec</span><span class="p">)</span> <span class="p">:</span> <span class="n">cpu</span><span class="o">=</span>        <span class="mf">362.8</span>  <span class="n">wall</span><span class="o">=</span>        <span class="mf">362.8</span>
<span class="mf">6</span><span class="n">x6x6</span><span class="p">:</span>    <span class="o">+</span><span class="n">Overall</span> <span class="n">time</span> <span class="n">at</span> <span class="kr">end</span> <span class="p">(</span><span class="n">sec</span><span class="p">)</span> <span class="p">:</span> <span class="n">cpu</span><span class="o">=</span>        <span class="mf">914.8</span>  <span class="n">wall</span><span class="o">=</span>        <span class="mf">914.8</span>
<span class="mf">8</span><span class="n">x8x8</span><span class="p">:</span>    <span class="o">+</span><span class="n">Overall</span> <span class="n">time</span> <span class="n">at</span> <span class="kr">end</span> <span class="p">(</span><span class="n">sec</span><span class="p">)</span> <span class="p">:</span> <span class="n">cpu</span><span class="o">=</span>       <span class="mf">5813.3</span>  <span class="n">wall</span><span class="o">=</span>       <span class="mf">5813.3</span>
<span class="mf">10</span><span class="n">x10x10</span><span class="p">:</span> <span class="o">+</span><span class="n">Overall</span> <span class="n">time</span> <span class="n">at</span> <span class="kr">end</span> <span class="p">(</span><span class="n">sec</span><span class="p">)</span> <span class="p">:</span> <span class="n">cpu</span><span class="o">=</span>      <span class="mf">20907.1</span>  <span class="n">wall</span><span class="o">=</span>      <span class="mf">20907.1</span>
<span class="mf">12</span><span class="n">x12x12</span><span class="p">:</span> <span class="o">+</span><span class="n">Overall</span> <span class="n">time</span> <span class="n">at</span> <span class="kr">end</span> <span class="p">(</span><span class="n">sec</span><span class="p">)</span> <span class="p">:</span> <span class="n">cpu</span><span class="o">=</span>      <span class="mf">62738.2</span>  <span class="n">wall</span><span class="o">=</span>      <span class="mf">62738.2</span>
</code></pre></div>

<p>6x6x6 is likely the most dense sampling you can afford on a single-CPU
machine. For you convenience, we have collected the results of the convergence
test in the figure below.</p>
<p><img alt="" src="../bse_assets/tbs5.png" /></p>
<p>As anticipated, the spectrum converges slowly with the number of k-points and
our first calculation done with the 4x4x4 grid is severely unconverged. The
most accurate results are obtained with the 12x12x12 k-mesh, but even this
sampling leads to converged results only for frequencies below 4.5 eV. This is
a problem common to all BS computations, in the sense that it is extremely
difficult to achieve global converge in the spectra. This analysis shows that
we can trust the 12x12x12 results in the [0:4,5] eV range while the correct
description of the spectrum at higher energies would require the inclusion of
more k-point and, possibly, more bands so that the band dispersion is
correctly taken into account (even the RPA spectrum does not converge at high
frequencies when 12x12x12 is used).</p>
<p>It should be stressed that <a class="wikilink codevar-wikilink" href="/variables/gw#zcut">zcut</a> plays a very important role in these
converge tests. For example, the results obtained with the 8x8x8 or the
10x10x10 k-mesh can be brought closer to the 12x12x12 by just increasing the
Lorentzian broadening. When comparing theory with experiments, it is common to
treat <a class="wikilink codevar-wikilink" href="/variables/gw#zcut">zcut</a> as an <em>a posteriori</em> parameter chosen to produce the best
agreement with the experiment.</p>
<h2 id="additional-exercises">Additional exercises<a class="headerlink" href="#additional-exercises" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Use <a class="wikilink codevar-wikilink" href="/variables/bse#bs_coupling">bs_coupling</a> = 1 to perform an excitonic calculation for silicon including the coupling term.
  Compare the imaginary part of the macroscopic dielectric function obtained with and without coupling.
  Do you find significant differences? (Caveat: calculations with coupling cannot use the Haydock method
  and are much more CPU demanding. You might have to decrease some input parameters to have results in reasonable time.)</p>
</li>
<li>
<p>Calculate the one-shot GW corrections for silicon following the <a href="/tutorial/gw1">first GW tutorial</a>.
  Then use the <code>_GW</code> file produced by the code to calculate the absorption spectrum.</p>
</li>
<li>
<p>Learn how to use AbiPy to automate BS calculations as described in this
  <a href="https://nbviewer.jupyter.org/github/abinit/abitutorials/blob/master/abitutorials/bse/lesson_bse.ipynb">jupyter notebook</a>.</p>
</li>
</ul>
<h2 id="notes-on-the-mpi-implementation">Notes on the MPI implementation<a class="headerlink" href="#notes-on-the-mpi-implementation" title="Permanent link">&para;</a></h2>
<p>In this section, we discuss the approach used to parallelize the two steps of
the BS run, <em>i.e.</em> the construction of the H matrix and the evaluation of the
macroscopic dielectric function.</p>
<p>First of all, it is important to stress that, unlike the GW code, the BS
routines do not employ any kind of memory distribution for the wavefunctions.
The entire set of orbitals used to construct the transition space is stored on
each node This choice has been dictated by the fact that the size of H is
usually much larger than the array used to store the wavefunction, hence it is
much more important to distribute the matrix than the wavefunctions. Besides,
having all the states on each node simplifies the calculation of several
intermediate quantities needed at run-time.</p>
<p>The memory allocated for the wavefunctions and the screening thus will not
scale with the number of processors. However, for very memory demanding
calculations, the real space orbitals can be calculated on the fly with an
increase in computational time instead. This option is controlled by the
second digit of the input variable <a class="wikilink codevar-wikilink" href="/variables/gw#gwmem">gwmem</a>.</p>
<p>When discussing the MPI parallelization of the Bethe-Salpeter routines, we
have to consider the two steps separately.</p>
<p>In the first step, the upper triangle of the resonant (coupling) block is
distributed among the nodes. Each CPU computes its own portion and stores the
results in a temporary array. At the end of the computation, the portions of
the upper triangle are communicated to the master node which writes the binary file BSR (BSC).</p>
<p>In the second step, each node reads the data stored in the external files in
order to build the excitonic Hamiltonian. The matrix is distributed using a
column-block partitioning, so that the matrix-vector multiplications required
in the Haydock iterative scheme can be easily performed in parallel (see the
schematic representation reported below). A similar distribution scheme is
also employed for the conjugate-gradient minimization. For a balanced
distribution of computational work, the number of processors should divide the
total number of resonant transitions.</p>
<p><img alt="" src="../paral_mbt_assets/MPI_mv.png" /></p>
                
                  
                
              

<!--
Add dropdown button with toolbar (based on https://bootsnipp.com/snippets/featured/inbox-by-gmail)
and return to Top button (based on https://codepen.io/rdallaire/pen/apoyx)
-->
<div class="md-container">
  <div class="row">
    <div id="inbox">
      <div class="fab btn-group show-on-hover dropup">
        <div data-toggle="tooltip" data-placement="left" title="Menu" style="margin-left: 42px;">
          <button id="return-to-top" type="button" class="btn btn-primary btn-io dropdown-toggle" data-toggle="dropdown">
            <span class="fa-stack fa-2x">
               <i class="fa fa-circle fa-stack-2x fab-backdrop"></i>
               <i class="fa fa-chevron-up fa-stack-1x fa-inverse fab-primary"></i>
               <i class="fa fa-map-signs fa-stack-1x fa-inverse fab-secondary"></i>
            </span>
          </button>
        </div>
        <ul class="dropdown-menu dropdown-menu-right" role="menu">
        
        
          <li>
            <a href="https://docs.abinit.org/about/release-notes/"
               data-toggle="popover" data-tippy-content="About">
               <i class="fa fa-info-circle"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/developers/git_and_gitlab/"
               data-toggle="popover" data-tippy-content="Developers">
               <i class="fa fa-terminal"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/theory/geometry/"
               data-toggle="popover" data-tippy-content="Theory">
               <i class="fa fa-book"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/faq/configuration_and_compilation/"
               data-toggle="popover" data-tippy-content="FAQ">
               <i class="fa fa-graduation-cap"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/tutorial/"
               data-toggle="popover" data-tippy-content="Tutorials">
               <i class="fa fa-file-text-o"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/variables/"
               data-toggle="popover" data-tippy-content="Variables">
               <i class="fa fa-question"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/topics/features/"
               data-toggle="popover" data-tippy-content="Topics">
               <i class="fa fa-user-circle-o"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/"
               data-toggle="popover" data-tippy-content="User Guides">
               <i class="fa "></i>
            </a>
          </li>
        
        </ul>
      </div>
    </div>
  </div>
</div>

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../gwr1/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              GWR1
            </div>
          </div>
        </a>
      
      
        <a href="../dmft/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              DMFT
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
            <center>Abinit version b'10.2.3-dirty'</center>
        
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020-2024 The Abinit Group
            
            (MG, MS)
            
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/abinit/abinit" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.youtube.com/watch?v=gcbfb_Mteo4" target="_blank" rel="noopener" title="www.youtube.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="http://www.facebook.com/abinit.org" target="_blank" rel="noopener" title="www.facebook.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/hashtag/abinit" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "header.autohide"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": "b'10.2.3-dirty'"}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1c7c35e.min.js"></script>
      
        <script src="../../extra_javascript/abidocs.js"></script>
      
    
  </body>
</html>