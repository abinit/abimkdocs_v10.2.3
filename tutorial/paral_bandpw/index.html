
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Abinit documentation">
      
      
      
        <meta name="author" content="The Abinit group">
      
      
        <link rel="canonical" href="https://docs.abinit.org/tutorial/paral_bandpw/">
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-7.0.6">
    
    
      
        <title>Parallelization of ground state - abinit</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.2c0c5eaf.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.7fa14f5b.min.css">
        
          
          
          <meta name="theme-color" content="#ff6e42">
        
      
    
    
    

    <!--
    IMPORTANT: Don't use boostrap in particular boostrap.css since it comes into conflict with mkdocs-material theme.
    Prefer low-level tools based on Jquery or JS library such as Tippyjs to get the work done.
    -->

    <!-- Jquery from Google CDN -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Load Jquery UI -->
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    <!-- Handle jQuery plugin naming conflict between jQuery UI and Bootstrap
    https://stackoverflow.com/questions/13731400/jqueryui-tooltips-are-competing-with-twitter-bootstrap
    <script>
      $.widget.bridge('uibutton', $.ui.button);
      $.widget.bridge('uitooltip', $.ui.tooltip);
    </script>
    -->

    <!-- jQuery Modal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />

    <!-- Tippyjs for popovers https://atomiks.github.io/tippyjs/ -->
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://unpkg.com/tippy.js@6"></script>

    <!-- font-awesome -->
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

    <!--Pace support. http://github.hubspot.com/pace/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/pace.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/pace/1.0.2/themes/white/pace-theme-big-counter.min.css" />

    <script>
        paceOptions = {
            ajax: true,      // disabled
            document: true,  // activated
            eventLag: false  // disabled
            //target: 'article'
            //elements: {selectors: ['.my-page']}
        };
    </script>

    <!-- MathJax support
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML">
    </script>
    -->

    <!-- This version is compatible with plotly. -->
    <script type="text/javascript" async
        src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_SVG">
    </script>

    <!-- Configure MathJax to produce automatic equation numbers http://docs.mathjax.org/en/latest/tex.html -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        //jax: ["input/TeX","output/HTML-CSS"],
        //tex2jax: {inlineMath: [['$','$']]},
        //displayAlign: "center",
        TeX: {
            equationNumbers: { autoNumber: "AMS" },
            extensions: ["AMSmath.js", "boldsymbol.js"],
            Macros: {
                "*": "{\\dagger}",
                "ra": "{\\rangle}",
                "la": "{\\langle}",
                // Workaround for bm package. See https://github.com/mathjax/MathJax/issues/1219
                bm: ["{\\boldsymbol #1}",1],
                // Mathcal symbols
                mcL: "{\\mathcal{L}}",
                mcG: "{\\mathcal{G}}",
                mcR: "{\\mathcal{R}}",
                mcS: "{\\mathcal{S}}",
                mcC: "{\\mathcal{C}}",
                mcO: "{\\mathcal{O}}",
                // Acronyms
                KS: "{\\text{KS}}",
                eph: "{\\text{e-ph}}",
                ee: "{\\text{e-e}}",
                phph: "{\\text{ph-ph}}",
                FM: "{\\text{FM}}",
                DW: "{\\text{DW}}",
                QP: "{\\text{QP}}",
                BZ: "{\\text{BZ}}",
                sign: "{\\text{sign}}",
                xc: "{\\text{xc}}",
                tchi: "{\\tilde\\chi}",
                // Symbols commonly used (k-points, eigenvalues ...)
                rr: "{\\bf r}",
                RR: "{\\bf R}",
                tt: "{\\bf t}",
                GG: "{\\bf G}",
                bg: "{\\bf g}",
                kk: "{\\bf k}",
                qq: "{\\bf q}",
                kq: "{\\kk + \\qq}",
                qG: "{\\bf q + G}",
                kG: "{\\bf k + G}",
                kmq: "{\\kk - \\qq}",
                kpq: "{\\kk + \\qq}",
                kpG: "{\\kk + \\GG}",
                qpG: "{\\qq + \\GG}",
                nk: "{n \\kk}",
                mk: "{, \\kk}",
                nks: "{n \\kk\\sigma}",
                mks: "{m \\kk\\sigma}",
                enk: "{\\varepsilon_\\nk}",
                emkq: "{\\varepsilon_{m\\kk+\\qq}}",
                qnu: "{\\qq \\nu}",
                wqnu: "{\\omega_{\\qnu}}",
                vnk: "{\\mathbf{v}_{n\\kk}}",
                vmkq: "{\\mathbf{v}_{m\\kk+\\qq}}",
                vnka: "{\\mathrm{v}_{n\\kk,\\alpha}}",
                vnkb: "{\\mathrm{v}_{n\\kk,\\beta}}",
                ef: "{\\varepsilon_F}",
                // EPH quantities
                gkkp: "{g_{mn\\nu}(\\kk,\\qq)}",
                gkq: "{g_{mn\\nu}(\\kk,\\qq)}",
                //\newcommand{\gkkpL}{g_{mn\nu}^\Lc(\kb,\qb)}
                // Many-body theory
                Go: "{G_0}",
                Wo: "{W_0}",
                Ueff: "{U_{\\text{eff}}}",
                Gove: "{\\overline{G}}",
                Gund: "{\\underline{G}}",
                // Greek symbols + tilde version
                ee: "{\\epsilon}",
                tee: "{\\tilde{\\epsilon}}",
                ww: "{\\omega}",
                tww: "{\\tilde\\omega}",
                dd: "{\\,\\text{d}}",
                vxc: "{v_\\xc}",
                // symrel
                Ri: "{\\mcR^{-1}}",
                Rit: "{\\mcR^{-1\\tau}}",
                // symrec
                Si: "{\\mcS^{-1}}}",
                Sit: "{\\Si^\\tau}}",
                // partial and functional derivative.
                PDER: ["{\\dfrac{\\partial #1}{\\partial #2}}", 2],
                FDER: ["{\\dfrac{\\delta #1}{\\delta #2}}", 2],
                // PAW
                tPsi: "{\\tilde\\Psi}",
                tpsi: "{\\tilde\\psi}",
                tPhi: "{\\tilde\\Phi}",
                tphi: "{\\tilde\\phi}",
                tprj: "{\\tilde p}"
            }
          }
      });
    </script>

    

    

    <!-- Load fonts used for input variables -->
    <link href="https://fonts.googleapis.com/css?family=Inconsolata" rel="stylesheet">

    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font-family:"Roboto";--md-code-font-family:"Roboto Mono"}</style>
      
    
    
    
      <link rel="stylesheet" href="../../css/extra.css">
    
      <link rel="stylesheet" href="../../css/gallery.css">
    
      <link rel="stylesheet" href="../../css/my_codehilite.css">
    
    
      
        
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-116681470-1","docs.abinit.org"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){var e;this.value&&(e=document.location.pathname,ga("send","pageview",e+"?q="+this.value))}),"undefined"!=typeof location$&&location$.subscribe(function(e){ga("send","pageview",e.pathname)})})</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="deep-orange" data-md-color-accent="deep-orange">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#parallelization-of-ground-state-calculations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="abinit" class="md-header__button md-logo" aria-label="abinit" data-md-component="logo">
      
  <img src="../../images/logo-abinit-2015.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            abinit
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Parallelization of ground state
            
          </span>
        </div>
      </div>
    </div>
    <div class="md-header__options">
      
    </div>
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        
<a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    github-abinit
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        User Guides
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../topics/features/" class="md-tabs__link">
        Topics
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../variables/" class="md-tabs__link">
        Variables
      </a>
    </li>
  

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../" class="md-tabs__link md-tabs__link--active">
        Tutorials
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../faq/configuration_and_compilation/" class="md-tabs__link">
        FAQ
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../theory/geometry/" class="md-tabs__link">
        Theory
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../developers/git_and_gitlab/" class="md-tabs__link">
        Developers
      </a>
    </li>
  

      
        
  
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../about/release-notes/" class="md-tabs__link">
        About
      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="abinit" class="md-nav__button md-logo" aria-label="abinit" data-md-component="logo">
      
  <img src="../../images/logo-abinit-2015.png" alt="logo">

    </a>
    abinit
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/abinit/abinit/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    github-abinit
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" >
      
      <label class="md-nav__link" for="__nav_1">
        User Guides
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="User Guides" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          User Guides
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        NewUser
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/abinit/" class="md-nav__link">
        Abinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/abitk/" class="md-nav__link">
        Abitk
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/aim/" class="md-nav__link">
        Aim
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/anaddb/" class="md-nav__link">
        Anaddb
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/atdep/" class="md-nav__link">
        aTDEP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/cut3d/" class="md-nav__link">
        Cut3d
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/fold2bloch/" class="md-nav__link">
        Fold2Bloch
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/mrgddb/" class="md-nav__link">
        Mrgddb
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/mrgscr/" class="md-nav__link">
        Mrgscr
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/multibinit/" class="md-nav__link">
        Multibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/optic/" class="md-nav__link">
        Optic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/respfn/" class="md-nav__link">
        Respfn
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../guide/spacegroup/" class="md-nav__link">
        Spacegroup
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_1_15" type="checkbox" id="__nav_1_15" >
      
      <label class="md-nav__link" for="__nav_1_15">
        Installation
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Installation" data-md-level="2">
        <label class="md-nav__title" for="__nav_1_15">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../installation/" class="md-nav__link">
        HowTo
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_MacOS/" class="md-nav__link">
        MacOS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_Ubuntu/" class="md-nav__link">
        Ubuntu
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_CentOS/" class="md-nav__link">
        CentOS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_EasyBuild/" class="md-nav__link">
        EasyBuild
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../INSTALL_gpu/" class="md-nav__link">
        GPUs
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" >
      
      <label class="md-nav__link" for="__nav_2">
        Topics
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Topics" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Topics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/features/" class="md-nav__link">
        Features
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/" class="md-nav__link">
        Topic List
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Abipy/" class="md-nav__link">
        Abipy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/APPA/" class="md-nav__link">
        APPA
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Artificial/" class="md-nav__link">
        Artificial
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/aTDEP/" class="md-nav__link">
        aTDEP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/AtomCentered/" class="md-nav__link">
        AtomCentered
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/AtomManipulator/" class="md-nav__link">
        AtomManipulator
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/AtomTypes/" class="md-nav__link">
        AtomTypes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Bader/" class="md-nav__link">
        Bader
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Band2eps/" class="md-nav__link">
        Band2eps
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Berry/" class="md-nav__link">
        Berry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/BandOcc/" class="md-nav__link">
        BandOcc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/BSE/" class="md-nav__link">
        BSE
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/BoundingProcess/" class="md-nav__link">
        BoundingProcess
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ConstrainedDFT/" class="md-nav__link">
        ConstrainedDFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ConstrainedPol/" class="md-nav__link">
        ConstrainedPol
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Control/" class="md-nav__link">
        Control
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Coulomb/" class="md-nav__link">
        Coulomb
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/CrossingBarriers/" class="md-nav__link">
        CrossingBarriers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/CalcUJ/" class="md-nav__link">
        CalcUJ
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/crystal/" class="md-nav__link">
        Crystal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DFT%2BU/" class="md-nav__link">
        DFT+U
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DeltaSCF/" class="md-nav__link">
        DeltaSCF
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DensityPotential/" class="md-nav__link">
        DensityPotential
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Dev/" class="md-nav__link">
        Dev
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DFPT/" class="md-nav__link">
        DFPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DMFT/" class="md-nav__link">
        DMFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/DynamicsMultibinit/" class="md-nav__link">
        DynamicsMultibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/EffectiveMass/" class="md-nav__link">
        EffectiveMass
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/EFG/" class="md-nav__link">
        EFG
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Elastic/" class="md-nav__link">
        Elastic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElPhonInt/" class="md-nav__link">
        ElPhonInt
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElPhonTransport/" class="md-nav__link">
        ElPhonTransport
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElecDOS/" class="md-nav__link">
        ElecDOS
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ElecBandStructure/" class="md-nav__link">
        ElecBandStructure
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ExtFPMD/" class="md-nav__link">
        ExtFPMD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/FileFormats/" class="md-nav__link">
        FileFormats
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/FitProcess/" class="md-nav__link">
        FitProcess
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/ForcesStresses/" class="md-nav__link">
        ForcesStresses
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/FrequencyMeshMBPT/" class="md-nav__link">
        FrequencyMeshMBPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GeoConstraints/" class="md-nav__link">
        GeoConstraints
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GeoOpt/" class="md-nav__link">
        GeoOpt
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Git/" class="md-nav__link">
        Git
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GSintroduction/" class="md-nav__link">
        GSintroduction
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GW/" class="md-nav__link">
        GW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GWR/" class="md-nav__link">
        GWR
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/GWls/" class="md-nav__link">
        GWls
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Hybrids/" class="md-nav__link">
        Hybrids
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Install/" class="md-nav__link">
        Install
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/k-points/" class="md-nav__link">
        K points
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LatticeModel/" class="md-nav__link">
        LatticeModel
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LatticeWannier/" class="md-nav__link">
        LatticeWannier
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LWFModel/" class="md-nav__link">
        LWFModel
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LDAminushalf/" class="md-nav__link">
        LDAminushalf
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/LOTF/" class="md-nav__link">
        LOTF
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/longwave/" class="md-nav__link">
        Longwave
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Macroave/" class="md-nav__link">
        Macroave
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/MagField/" class="md-nav__link">
        MagField
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/MagMom/" class="md-nav__link">
        MagMom
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/MolecularDynamics/" class="md-nav__link">
        MolecularDynamics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/multidtset/" class="md-nav__link">
        Multidtset
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/NMR/" class="md-nav__link">
        NMR
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/nonlinear/" class="md-nav__link">
        Nonlinear
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Optic/" class="md-nav__link">
        Optic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Output/" class="md-nav__link">
        Output
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/parallelism/" class="md-nav__link">
        Parallelism
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PAW/" class="md-nav__link">
        PAW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PIMD/" class="md-nav__link">
        PIMD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Planewaves/" class="md-nav__link">
        Planewaves
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Phonons/" class="md-nav__link">
        Phonons
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PhononBands/" class="md-nav__link">
        PhononBands
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PhononWidth/" class="md-nav__link">
        PhononWidth
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PortabilityNonRegression/" class="md-nav__link">
        PortabilityNonRegression
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/positron/" class="md-nav__link">
        Positron
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/printing/" class="md-nav__link">
        Printing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/PseudosPAW/" class="md-nav__link">
        PseudosPAW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/q-points/" class="md-nav__link">
        Q points
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/RandStopPow/" class="md-nav__link">
        RandStopPow
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Recursion/" class="md-nav__link">
        Recursion
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/RPACorrEn/" class="md-nav__link">
        RPACorrEn
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SCFControl/" class="md-nav__link">
        SCFControl
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SCFAlgorithms/" class="md-nav__link">
        SCFAlgorithms
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SelfEnergy/" class="md-nav__link">
        SelfEnergy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SmartSymm/" class="md-nav__link">
        SmartSymm
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/spinpolarisation/" class="md-nav__link">
        Spinpolarisation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/SpinDynamicsMultibinit/" class="md-nav__link">
        SpinDynamicsMultibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/STM/" class="md-nav__link">
        STM
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Susceptibility/" class="md-nav__link">
        Susceptibility
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TDDFT/" class="md-nav__link">
        TDDFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TDepES/" class="md-nav__link">
        TDepES
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Temperature/" class="md-nav__link">
        Temperature
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TransPath/" class="md-nav__link">
        TransPath
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/TuningSpeedMem/" class="md-nav__link">
        TuningSpeedMem
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Unfolding/" class="md-nav__link">
        Unfolding
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/UnitCell/" class="md-nav__link">
        UnitCell
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/vdw/" class="md-nav__link">
        Vdw
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Verification/" class="md-nav__link">
        Verification
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Wannier/" class="md-nav__link">
        Wannier
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/Wavelets/" class="md-nav__link">
        Wavelets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/xc/" class="md-nav__link">
        Xc
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../topics/external_resources/" class="md-nav__link">
        External Resources
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" >
      
      <label class="md-nav__link" for="__nav_3">
        Variables
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Variables" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Variables
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/" class="md-nav__link">
        All Variables
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_2" type="checkbox" id="__nav_3_2" >
      
      <label class="md-nav__link" for="__nav_3_2">
        Abinit
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Abinit" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          Abinit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/basic/" class="md-nav__link">
        Basic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/bse/" class="md-nav__link">
        Bethe-Salpeter
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/dev/" class="md-nav__link">
        Developers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/dmft/" class="md-nav__link">
        DMFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/eph/" class="md-nav__link">
        Electron-Phonon
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/ffield/" class="md-nav__link">
        Varff
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/files/" class="md-nav__link">
        File-handling
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/geo/" class="md-nav__link">
        Geometry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/gstate/" class="md-nav__link">
        Ground-State
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/gw/" class="md-nav__link">
        GW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/internal/" class="md-nav__link">
        Internal
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/paral/" class="md-nav__link">
        Parallelism
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/paw/" class="md-nav__link">
        PAW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/dfpt/" class="md-nav__link">
        DFPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/rlx/" class="md-nav__link">
        Relaxation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/vdw/" class="md-nav__link">
        VdW
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/w90/" class="md-nav__link">
        Wannier90
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/anaddb/" class="md-nav__link">
        Anaddb
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/atdep/" class="md-nav__link">
        aTDEP
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/multibinit/" class="md-nav__link">
        Multibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/optic/" class="md-nav__link">
        Optic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/aim/" class="md-nav__link">
        Aim
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/external_parameters/" class="md-nav__link">
        External Parameters
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../variables/varset_stats/" class="md-nav__link">
        Statistics
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      <label class="md-nav__link" for="__nav_4">
        Tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        Overview
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_2" type="checkbox" id="__nav_4_2" >
      
      <label class="md-nav__link" for="__nav_4_2">
        Basic tutorials
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Basic tutorials" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          Basic tutorials
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../base1/" class="md-nav__link">
        basic1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../base2/" class="md-nav__link">
        basic2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../base3/" class="md-nav__link">
        basic3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../base4/" class="md-nav__link">
        basic4
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../abinit_build/" class="md-nav__link">
        ABINIT_build
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paw1/" class="md-nav__link">
        PAW1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../spin/" class="md-nav__link">
        Spin
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../polarization/" class="md-nav__link">
        Polarization & finite field
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rf1/" class="md-nav__link">
        DFPT1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../rf2/" class="md-nav__link">
        DFPT2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../basepar/" class="md-nav__link">
        Parallelism
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_10" type="checkbox" id="__nav_4_10" >
      
      <label class="md-nav__link" for="__nav_4_10">
        ABINIT postprocessors
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="ABINIT postprocessors" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_10">
          <span class="md-nav__icon md-icon"></span>
          ABINIT postprocessors
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../atdep1/" class="md-nav__link">
        aTDEP1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../cut3d/" class="md-nav__link">
        cut3D
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../fold2bloch/" class="md-nav__link">
        fold2bloch
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../optic/" class="md-nav__link">
        optic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../wannier90/" class="md-nav__link">
        wannier90
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../z2pack/" class="md-nav__link">
        Z2pack
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_11" type="checkbox" id="__nav_4_11" >
      
      <label class="md-nav__link" for="__nav_4_11">
        DFT beyond basics
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DFT beyond basics" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_11">
          <span class="md-nav__icon md-icon"></span>
          DFT beyond basics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../nuc/" class="md-nav__link">
        properties at the nucleus
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dftu/" class="md-nav__link">
        DFT+U
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../ucalc_crpa/" class="md-nav__link">
        cRPA U(J)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lruj/" class="md-nav__link">
        Linear Response U(J)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paw2/" class="md-nav__link">
        PAW2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paw3/" class="md-nav__link">
        PAW3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../positron/" class="md-nav__link">
        positron
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_12" type="checkbox" id="__nav_4_12" >
      
      <label class="md-nav__link" for="__nav_4_12">
        Many-Body Theory & excitations
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Many-Body Theory & excitations" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_12">
          <span class="md-nav__icon md-icon"></span>
          Many-Body Theory & excitations
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gw1/" class="md-nav__link">
        GW1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gw2/" class="md-nav__link">
        GW2
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gwr_intro/" class="md-nav__link">
        GWR_intro
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../gwr1/" class="md-nav__link">
        GWR1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../bse/" class="md-nav__link">
        Bethe-Salpeter
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../dmft/" class="md-nav__link">
        DMFT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../tddft/" class="md-nav__link">
        TDDFT (Casida)
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_13" type="checkbox" id="__nav_4_13" >
      
      <label class="md-nav__link" for="__nav_4_13">
        DFPT & electron-phonon
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="DFPT & electron-phonon" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_13">
          <span class="md-nav__icon md-icon"></span>
          DFPT & electron-phonon
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../elastic/" class="md-nav__link">
        elastic
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../nlo/" class="md-nav__link">
        nonlinear
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lattice_wannier/" class="md-nav__link">
        lattice_wannier
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lw_quad/" class="md-nav__link">
        quadrupoles
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph_intro/" class="md-nav__link">
        eph_intro
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph4mob/" class="md-nav__link">
        eph for mobilities
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph4zpr/" class="md-nav__link">
        eph for zero-point renormalization
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph_legacy/" class="md-nav__link">
        eph_legacy
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../eph_tdep_legacy/" class="md-nav__link">
        eph_tdep_legacy
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_14" type="checkbox" id="__nav_4_14" >
      
      <label class="md-nav__link" for="__nav_4_14">
        Multibinit
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Multibinit" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_14">
          <span class="md-nav__icon md-icon"></span>
          Multibinit
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../multibinit/" class="md-nav__link">
        introduction to multibinit
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lattice_model/" class="md-nav__link">
        lattice_model
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../spin_model/" class="md-nav__link">
        spin_model
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../lwf_model/" class="md-nav__link">
        lwf_model
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4_15" type="checkbox" id="__nav_4_15" checked>
      
      <label class="md-nav__link" for="__nav_4_15">
        Advanced parallelism
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Advanced parallelism" data-md-level="2">
        <label class="md-nav__title" for="__nav_4_15">
          <span class="md-nav__icon md-icon"></span>
          Advanced parallelism
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          paral_band_PW
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        paral_band_PW
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#explore-the-k-pointsplane-wavesbands-parallelization" class="md-nav__link">
    Explore the k-points/plane waves/bands parallelization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-simple-way-to-begin-automatic-distributed-parallelism" class="md-nav__link">
    A simple way to begin: automatic distributed parallelism
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-more-sophisticated-method" class="md-nav__link">
    A more sophisticated method
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#even-more-sophisticated-bands-per-process-bandpp" class="md-nav__link">
    Even more sophisticated: BANDs Per Process (bandpp)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hybrid-parallelism-mpiopenmp" class="md-nav__link">
    Hybrid parallelism: MPI+OpenMP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-the-kgb-parallelization" class="md-nav__link">
    6 The KGB parallelization
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_gswvl/" class="md-nav__link">
        paral_wavelets
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_moldyn/" class="md-nav__link">
        paral_MD
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_images/" class="md-nav__link">
        paral_images
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_dfpt/" class="md-nav__link">
        paral_DFPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../paral_mbt/" class="md-nav__link">
        paral_MBPT
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_5" type="checkbox" id="__nav_5" >
      
      <label class="md-nav__link" for="__nav_5">
        FAQ
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="FAQ" data-md-level="1">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          FAQ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/configuration_and_compilation/" class="md-nav__link">
        Configuration and compilation
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/general_questions/" class="md-nav__link">
        General questions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/pre_and_post_processing/" class="md-nav__link">
        Pre/Post processing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/ground_state/" class="md-nav__link">
        Ground state
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/dfpt/" class="md-nav__link">
        DFPT
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/Troubleshooting/" class="md-nav__link">
        Troubleshooting (old-dokuwiki)
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../faq/tuning_abinit/" class="md-nav__link">
        Tuning (old-dokuwiki)
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_6" type="checkbox" id="__nav_6" >
      
      <label class="md-nav__link" for="__nav_6">
        Theory
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Theory" data-md-level="1">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/geometry/" class="md-nav__link">
        Geometry
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/spherical_harmonics/" class="md-nav__link">
        Spherical Harmonics
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/wavefunctions/" class="md-nav__link">
        Wavefunctions
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/noncollinear/" class="md-nav__link">
        Noncollinear
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/pseudopotentials/" class="md-nav__link">
        Pseudopotentials
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/mbt/" class="md-nav__link">
        Many-Body Perturbation Theory
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/bse/" class="md-nav__link">
        Bethe-Salpeter
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/documents/" class="md-nav__link">
        Documents
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/acknowledgments/" class="md-nav__link">
        Acknowledgments
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/bibliography/" class="md-nav__link">
        Bibliography
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../theory/acronyms/" class="md-nav__link">
        Acronyms
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      <label class="md-nav__link" for="__nav_7">
        Developers
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Developers" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Developers
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/git_and_gitlab/" class="md-nav__link">
        Git and Gitlab
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/developers_howto/" class="md-nav__link">
        HowTo for developers
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/abimkdocs/" class="md-nav__link">
        Abimkdocs
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/markdown/" class="md-nav__link">
        Markdown
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_5" type="checkbox" id="__nav_7_5" >
      
      <label class="md-nav__link" for="__nav_7_5">
        Test Suite
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Test Suite" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_5">
          <span class="md-nav__icon md-icon"></span>
          Test Suite
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/testsuite/" class="md-nav__link">
        Test list
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/testsuite_howto/" class="md-nav__link">
        Test Suite Howto
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/new_testsuite/" class="md-nav__link">
        YAML-based test suite Howto
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/yaml_tools_api/" class="md-nav__link">
        YAML-based test suite Python tools and API
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/XgType/" class="md-nav__link">
        XgType
      </a>
    </li>
  

          
            
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_7" type="checkbox" id="__nav_7_7" >
      
      <label class="md-nav__link" for="__nav_7_7">
        Pseudos
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="Pseudos" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_7">
          <span class="md-nav__icon md-icon"></span>
          Pseudos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp1_info/" class="md-nav__link">
        psp1
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp3_info/" class="md-nav__link">
        psp3
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp45_info/" class="md-nav__link">
        psp45
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp5spinorbit_info/" class="md-nav__link">
        psp5
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp6_info/" class="md-nav__link">
        psp6
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/psp8_info/" class="md-nav__link">
        psp8
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/codestats/" class="md-nav__link">
        Code stats
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/autoconf_examples/" class="md-nav__link">
        Autoconf_examples
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../developers/testlink/" class="md-nav__link">
        Test Page for linkcheck
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      <label class="md-nav__link" for="__nav_8">
        About
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          About
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/release-notes/" class="md-nav__link">
        Release Notes
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/contributing/" class="md-nav__link">
        Contributing
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/history/" class="md-nav__link">
        History
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="../../about/license/" class="md-nav__link">
        License
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#explore-the-k-pointsplane-wavesbands-parallelization" class="md-nav__link">
    Explore the k-points/plane waves/bands parallelization
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    Introduction
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-simple-way-to-begin-automatic-distributed-parallelism" class="md-nav__link">
    A simple way to begin: automatic distributed parallelism
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#a-more-sophisticated-method" class="md-nav__link">
    A more sophisticated method
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#even-more-sophisticated-bands-per-process-bandpp" class="md-nav__link">
    Even more sophisticated: BANDs Per Process (bandpp)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hybrid-parallelism-mpiopenmp" class="md-nav__link">
    Hybrid parallelism: MPI+OpenMP
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6-the-kgb-parallelization" class="md-nav__link">
    6 The KGB parallelization
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              

                
                  <a href="https://github.com/abinit/abinit/edit/master/doc/tutorial/paral_bandpw.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="parallelization-of-ground-state-calculations">Parallelization of ground state calculations<a class="headerlink" href="#parallelization-of-ground-state-calculations" title="Permanent link">&para;</a></h1>
<h2 id="explore-the-k-pointsplane-wavesbands-parallelization">Explore the <em>k-points/plane waves/bands</em> parallelization<a class="headerlink" href="#explore-the-k-pointsplane-wavesbands-parallelization" title="Permanent link">&para;</a></h2>
<p>This tutorial discusses how to perform ground-state calculations on hundreds/thousands
of computing unit (CPUs) cores using ABINIT.</p>
<p>You will learn how to use some keywords related to the <strong>KGB</strong> parallelization scheme where
<strong>K</strong> stands for <em>k-point</em>, <strong>G</strong> refers to the wavevector of a <em>planewave</em>, and <strong>B</strong> stands for <em>Band</em>.
It is possible to use ABINIT with other levels of parallelism but this is not the focus of this tutorial.
You will learn how to speedup your calculations and how to improve their convergence rate.</p>
<p>This tutorial should take about 1.5 hour and requires access to 64 CPU core parallel computer except for the last section which requires 256 CPU cores.</p>
<p>You are supposed to know already some basics of ABINIT.
Some useful references: <a class="wikilink citation-wikilink" data-tippy-content="Parallel eigensolvers in plane-wave Density Functional Theory" data-toggle="popover" href="/theory/bibliography#levitt2015">[Levitt2015]</a>, <a class="wikilink citation-wikilink" data-tippy-content="Large-scale ab initio calculations based on three levels of parallelization" data-toggle="popover" href="/theory/bibliography#bottin2008">[Bottin2008]</a>, <a class="wikilink citation-wikilink" data-tippy-content="Toward the Optimal Preconditioned Eigensolver: Locally Optimal Block Preconditioned Conjugate Gradient Method" data-toggle="popover" href="/theory/bibliography#knyazev2001">[Knyazev2001]</a></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Supposing you made your own installation of ABINIT, the input files to run the examples
are in the <em>~abinit/tests/</em> directory where <em>~abinit</em> is the <strong>absolute path</strong> of the abinit top-level directory.
If you have NOT made your own install, ask your system administrator where to find the package,
especially the executable and test files.</p>
<p>In case you work on your own PC or workstation, to make things easier, we suggest you define
some handy environment variables by executing the following lines in the terminal:</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span> <span class="nv">ABI_HOME</span><span class="o">=</span>Replace_with_absolute_path_to_abinit_top_level_dir <span class="c1"># Change this line</span>
<span class="nb">export</span> <span class="nv">PATH</span><span class="o">=</span><span class="nv">$ABI_HOME</span>/src/98_main/:<span class="nv">$PATH</span>      <span class="c1"># Do not change this line: path to executable</span>
<span class="nb">export</span> <span class="nv">ABI_TESTS</span><span class="o">=</span><span class="nv">$ABI_HOME</span>/tests/             <span class="c1"># Do not change this line: path to tests dir</span>
<span class="nb">export</span> <span class="nv">ABI_PSPDIR</span><span class="o">=</span><span class="nv">$ABI_TESTS</span>/Psps_for_tests/  <span class="c1"># Do not change this line: path to pseudos dir</span>
</code></pre></div>
<p>Examples in this tutorial use these shell variables: copy and paste
the code snippets into the terminal (<strong>remember to set ABI_HOME first!</strong>) or, alternatively,
source the <code>set_abienv.sh</code> script located in the <em>~abinit</em> directory:</p>
<div class="highlight"><pre><span></span><code><span class="nb">source</span> ~abinit/set_abienv.sh
</code></pre></div>
<p>The &lsquo;export PATH&rsquo; line adds the directory containing the executables to your <a href="http://www.linfo.org/path_env_var.html">PATH</a>
so that you can invoke the code by simply typing <em>abinit</em> in the terminal instead of providing the absolute path.</p>
<p>To execute the tutorials, create a working directory (<code>Work*</code>) and
copy there the input files of the lesson.</p>
<p>Most of the tutorials do not rely on parallelism (except specific <a class="wikilink lesson-wikilink" href="/tutorial/basepar">tutorials on parallelism</a>).
However you can run most of the tutorial examples in parallel with MPI, see the <a class="wikilink topic-wikilink" data-tippy-content="How to set parameters for a parallel calculation" data-toggle="popover" href="/topics/parallelism">topic on parallelism</a>.</p>
</div>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p><em>Before continuing you might work in a different subdirectory as for the other
tutorials. Why not work_paral_kgb?</em></p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>In what follows, the names of files are mentioned as if you were in this subdirectory.
All the input files can be found in the <code>\$ABI_TESTS/tutoparal/Input</code> directory.
You can compare your results with reference output files located in <code>\$ABI_TESTS/tutoparal/Refs</code>.</p>
<p>In the following, when &ldquo;run ABINIT over <em>nn</em> CPU cores&rdquo; appears, you have to use
a specific command line according to the operating system and architecture of
the computer you are using. This can be for instance: <code>mpirun -n nn abinit input.abi</code>
or the use of a specific submission file.</p>
</div>
<p>When the size of the system increases up to 100 or 1000 atoms, it is usually
impossible to perform <em>ab initio</em> calculations with a single computing core.
This is because the basis sets used to solve the problem (plane waves, bands, &hellip;) increase
&mdash; linearly, as the square, or even exponentially &mdash;.
The computational resources are limited by two factors:</p>
<ul>
<li>The memory, <em>i.e</em>. the amount of data stored in RAM,</li>
<li>The computing efficiency, with specific bottlenecks.</li>
</ul>
<p>Therefore, it is mandatory to adopt a parallelization strategy:</p>
<ol>
<li>Distribute or share the data across a large number of computing nodes,</li>
<li>Parallelize the time consuming routines.</li>
</ol>
<p>In this tutorial, we will discuss:</p>
<ul>
<li>How to improve performance by using a large number of computing units (CPU cores),</li>
<li>
<p>How to decrease the computational time for a given number of CPU cores by:</p>
<ol>
<li>Reducing the time needed to perform one electronic iteration (improve efficiency)</li>
<li>Reducing the number of electronic iterations (improve convergence)</li>
</ol>
</li>
</ul>
<p>The tests are performed on a 107 gold atom system.
In this tutorial the plane-wave
cutoff energy is strongly reduced, for practical reasons.</p>
<h2 id="a-simple-way-to-begin-automatic-distributed-parallelism">A simple way to begin: automatic distributed parallelism<a class="headerlink" href="#a-simple-way-to-begin-automatic-distributed-parallelism" title="Permanent link">&para;</a></h2>
<p>The easiest way to activate the KGB parallelization in ABINIT is to
add just one input variable in the input file, <a class="wikilink codevar-wikilink" href="/variables/paral#paral_kgb">paral_kgb</a>, which controls
everything concerning the KGB parallelization, including the choice of the iterative
eigensolver (<a class="wikilink codevar-wikilink" href="/variables/dev#wfoptalg">wfoptalg</a> <strong>= 1, 4, 14, 114</strong>) and the use of a parallel 3dim-FFT.
Then you have to choose between 2 strategies:</p>
<ul>
<li>Activate the &mdash; not so good &mdash; flag <a class="wikilink codevar-wikilink" href="/variables/paral#autoparal">autoparal</a><strong>=1</strong> (automatic parallelization)
and use the associated <a class="wikilink codevar-wikilink" href="/variables/paral#max_ncpus">max_ncpus</a> variable (maximum number of CPU cores you want),</li>
</ul>
<p>or</p>
<ul>
<li>Manually define the number of processes associated to each level of parallelism:
  <a class="wikilink codevar-wikilink" href="/variables/paral#np_spkpt">np_spkpt</a> (number of processes for spin and k points),
  <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a> (number of processes for bands),
  <a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a> (number of processes for plane-waves/FFT).</li>
</ul>
<p>OK, let&rsquo;s start!</p>
<p>Copy the <code>tparal_bandpw_01.abi</code> file the tutorial directory into your working directory.</p>
<div class="text-center"><button id="uuid-97695f59-b9a1-4e93-bbd6-b3d39de66ddb" class="md-button md-button--secondary"> View tests/tutoparal/Input/tparal_bandpw_01.abi </button></div>
<div id="uuid-b6342adf-8678-40b2-83f7-0d0ccb546f69" class="my_dialog" title="tests/tutoparal/Input/tparal_bandpw_01.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1">#############################################</span>
<span class="c1"># Gold with one vacancy (107 atoms of gold) #</span>
<span class="c1">#############################################</span>

<span class="c1"># Definition of the unit cell</span>
<span class="c1"># ===========================</span>
natom         <span class="m">107</span>

ntypat        <span class="m">1</span>

<span class="c1"># Species     </span>
<span class="c1">#             Au  </span>
znucl         
              <span class="m">79</span>  

typat         <span class="m">107</span>*1

acell         <span class="m">2</span>.30100000000000e+01   <span class="m">2</span>.30100000000000e+01   <span class="m">2</span>.30100000000000e+01

xred          
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.66415066890000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66415066890000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.32513080460000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.67486919540000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66415066890000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">1</span>.66415066890000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.32513080460000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01   <span class="m">3</span>.33140408550000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33584933110000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01   <span class="m">6</span>.66859591450000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.67486919540000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.33584933110000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01   <span class="m">3</span>.33140408550000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01   <span class="m">6</span>.66859591450000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.66415066890000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66415066890000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32513080460000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32916578170000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.33584933110000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01
              <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33140408550000e-01   <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33161164200000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.33161164200000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.33161164200000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.66838835800000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33584933110000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33140408550000e-01   <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32916578170000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.66838835800000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67486919540000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67083421830000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33584933110000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01
              <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.33584933110000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66859591450000e-01   <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66838835800000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66859591450000e-01   <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67083421830000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01

pp_dirpath   <span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span>
pseudos      <span class="s2">&quot;Pseudodojo_paw_pw_standard/Au.xml&quot;</span>

<span class="c1"># Electronic configuration</span>
<span class="c1"># ========================</span>
nband         <span class="m">640</span>
occopt        <span class="m">3</span> 
tsmear        <span class="m">0</span>.002
nkpt          <span class="m">1</span>

<span class="c1"># Convergence parameters</span>
<span class="c1"># ======================</span>
ecut          <span class="m">5</span>  <span class="c1"># Irrealist. Just to reduce the computation time in order to perform some benchmark</span>
pawecutdg     <span class="m">5</span>  <span class="c1"># Minimal value not converge to run with ecut</span>

<span class="c1"># Control of the SCF cycle</span>
<span class="c1"># ========================</span>
nstep         <span class="m">5</span>
toldfe        <span class="m">1</span>.e-7

<span class="c1"># Parallelization</span>
<span class="c1"># ===============</span>
paral_kgb     <span class="m">1</span>
autoparal     <span class="m">1</span>
max_ncpus     <span class="m">64</span>
timopt        -3 <span class="c1"># Get timing information of the run in the *.abo (output) file</span>

<span class="c1">##############################################################</span>
<span class="c1"># This section is used only for regression testing of ABINIT #</span>
<span class="c1">##############################################################</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% expected_failure = yes</span>
<span class="c1">#%% [NCPU_1]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tparal_bandpw_01_MPI1.abo, tolnlines = 0, tolabs = 1.100e-03, tolrel = 3.000e-03</span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 1</span>
<span class="c1">#%% nprocs_to_test = 1</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = F. Bottin, J. Bieder</span>
<span class="c1">#%% keywords = </span>
<span class="c1">#%% description =  Gold with one vacancy (107 atoms of gold).</span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-b6342adf-8678-40b2-83f7-0d0ccb546f69", "#uuid-97695f59-b9a1-4e93-bbd6-b3d39de66ddb") }); </script>

<p>Then run ABINIT on 1 CPU core (using 1 MPI process and 1 <em>OpenMP</em> thread).</p>
<p>ABINIT should stop without starting a calculation (don&rsquo;t pay attention to the error message).
At the end of the output file <code>tparal_bandpw_01.abo</code>, you will see:</p>
<div class="highlight"><pre><span></span><code> Searching for all possible proc distributions for this input with <span class="ni">#CPUs</span>&lt;=64:

 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 |    np_spkpt|       npfft|      npband|      bandpp|  <span class="ni">#MPI</span>(proc)|    WEIGHT|
 |    1&lt;&lt;    1|    1&lt;&lt;   22|    1&lt;&lt;   64|    1&lt;&lt;  640|    1&lt;&lt;   64|  &lt;=    64|
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 |           1|           4|          16|          10|          64|    42.328|
 |           1|           8|           8|          20|          64|    41.844|
 |           1|          16|           4|          40|          64|    41.730|
 |           1|           6|          10|          16|          60|    40.093|
 |           1|          15|           4|          40|          60|    39.054|
 |           1|           4|          16|           8|          64|    39.043|
 |           1|          12|           5|          32|          60|    39.026|
 |           1|           8|           8|          16|          64|    38.598|
 |           1|          16|           4|          32|          64|    38.493|
 |           1|           3|          20|           8|          60|    38.319|
 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
 Only the best possible choices for nproc are printed...
</code></pre></div>
<p>A weight is assigned to each distribution of processors. As indicated, you are advised
to select a processor distribution with a high <em>weight</em>. If we just focus on <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a>
and <a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a>, we see that, for 64 MPI processes, the recommended distribution <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a>x<a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a> is 16x4.</p>
<p>In a second step you can launch ABINIT in parallel on 64 cores by
changing your input file as follows:</p>
<div class="highlight"><pre><span></span><code><span class="gd">- autoparal     1</span>
<span class="gd">- max_ncpus     64</span>
<span class="gi">+ npband        16</span>
<span class="gi">+ npfft         4</span>
</code></pre></div>
<p>You can now perform your calculations using the KGB parallelization in ABINIT.
But somehow, you did it without understanding how you got the result&hellip;</p>
<h2 id="a-more-sophisticated-method">A more sophisticated method<a class="headerlink" href="#a-more-sophisticated-method" title="Permanent link">&para;</a></h2>
<p>In this part we will try to recover the previous process distribution, but with a better
understanding. As shown above, the pair (<a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a> x <a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a>) of input variables
can have various values: (64x1), (32x2), (16x4), (8x8), (4x16).
In order to perform these 5 calculations you can use the <code>tparal_bandpw_02.abi</code>.</p>
<div class="text-center"><button id="uuid-6d906aeb-5956-462c-b5ea-260c47cdbf13" class="md-button md-button--secondary"> View tests/tutoparal/Input/tparal_bandpw_02.abi </button></div>
<div id="uuid-2b9f261b-b04d-414c-a475-65a0ed07b949" class="my_dialog" title="tests/tutoparal/Input/tparal_bandpw_02.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1">#############################################</span>
<span class="c1"># Gold with one vacancy (107 atoms of gold) #</span>
<span class="c1">#############################################</span>

<span class="c1"># Definition of the unit cell</span>
<span class="c1"># ===========================</span>
natom         <span class="m">107</span>

ntypat        <span class="m">1</span>

<span class="c1"># Species     </span>
<span class="c1">#             Au  </span>
znucl         
              <span class="m">79</span>  

typat         <span class="m">107</span>*1

acell         <span class="m">2</span>.30100000000000e+01   <span class="m">2</span>.30100000000000e+01   <span class="m">2</span>.30100000000000e+01

xred          
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.66415066890000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66415066890000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.32513080460000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.67486919540000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66415066890000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">1</span>.66415066890000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.32513080460000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01   <span class="m">3</span>.33140408550000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33584933110000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01   <span class="m">6</span>.66859591450000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.67486919540000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.33584933110000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01   <span class="m">3</span>.33140408550000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01   <span class="m">6</span>.66859591450000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.66415066890000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66415066890000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32513080460000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32916578170000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.33584933110000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01
              <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33140408550000e-01   <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33161164200000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.33161164200000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.33161164200000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.66838835800000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33584933110000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33140408550000e-01   <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32916578170000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.66838835800000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67486919540000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67083421830000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33584933110000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01
              <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.33584933110000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66859591450000e-01   <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66838835800000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66859591450000e-01   <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67083421830000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01

pp_dirpath   <span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span>
pseudos      <span class="s2">&quot;Pseudodojo_paw_pw_standard/Au.xml&quot;</span>

<span class="c1"># Electronic configuration</span>
<span class="c1"># ========================</span>
nband         <span class="m">640</span>
occopt        <span class="m">3</span> 
tsmear        <span class="m">0</span>.002
nkpt          <span class="m">1</span>

<span class="c1"># Convergence parameters</span>
<span class="c1"># ======================</span>
ecut          <span class="m">5</span>  <span class="c1"># Irrealist. Just to reduce the computation time in order to perform some benchmark</span>
pawecutdg     <span class="m">5</span>  <span class="c1"># Minimal value not converge to run with ecut</span>

<span class="c1"># Control of the SCF cycle</span>
<span class="c1"># ========================</span>
nstep         <span class="m">5</span>
toldfe        <span class="m">1</span>.e-7

<span class="c1"># Parallelization</span>
<span class="c1"># ===============</span>
paral_kgb     <span class="m">1</span>
npband        <span class="m">16</span>  <span class="c1"># Change this line according to the tutorial  </span>
npfft         <span class="m">4</span>   <span class="c1"># Change this line according to the tutorial</span>
timopt        -3  <span class="c1"># Get timing information of the run in the *.abo (output) file</span>

<span class="c1">##############################################################</span>
<span class="c1"># This section is used only for regression testing of ABINIT #</span>
<span class="c1">##############################################################</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% [NCPU_64]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tparal_bandpw_02_MPI64.abo, tolnlines = 170, tolabs = 1.1e-3, tolrel = 1.0e-2 </span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 64</span>
<span class="c1">#%% nprocs_to_test = 64</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = F. Bottin, J. Bieder</span>
<span class="c1">#%% keywords = </span>
<span class="c1">#%% description = </span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-2b9f261b-b04d-414c-a475-65a0ed07b949", "#uuid-6d906aeb-5956-462c-b5ea-260c47cdbf13") }); </script>

<p>Change the line corresponding to the processor distribution.
A first calculation with:
<div class="highlight"><pre><span></span><code><span class="gd">- npband         16</span>
<span class="gd">- npfft          4</span>
<span class="gi">+ npband         64</span>
<span class="gi">+ npfft          1</span>
</code></pre></div></p>
<p>A second one with:
<div class="highlight"><pre><span></span><code><span class="gd">- npband         64</span>
<span class="gd">- npfft          1</span>
<span class="gi">+ npband         32</span>
<span class="gi">+ npfft          2</span>
</code></pre></div></p>
<p>And so on, until you have run all 5 calculations (<a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a>x<a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a>) : (64x1), (32x2), (16x4), (8x8), (4x16).</p>
<p>Store all the output files by renaming them as follows:
The timing of each calculation can be retrieved using the shell command:
<code>tparal_bandpw_02.64.01.abo</code>, <code>tparal_bandpw_02.32.02.abo</code>,
<code>tparal_bandpw_02.16.04.abo</code>, <code>tparal_bandpw_02.08.08.abo</code> and
<code>tparal_bandpw_02.04.16.abo</code></p>
<p>The timing of each calculation can be retrieved using the shell command:
<div class="highlight"><pre><span></span><code>grep Proc *.abo
</code></pre></div></p>
<div class="highlight"><pre><span></span><code>tparal_bandpw_02.04.16.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">62</span>.9  <span class="nv">wall</span><span class="o">=</span>         <span class="m">69</span>.4
tparal_bandpw_02.08.08.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">57</span>.9  <span class="nv">wall</span><span class="o">=</span>         <span class="m">64</span>.0
tparal_bandpw_02.16.04.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">56</span>.0  <span class="nv">wall</span><span class="o">=</span>         <span class="m">61</span>.8
tparal_bandpw_02.32.02.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">57</span>.1  <span class="nv">wall</span><span class="o">=</span>         <span class="m">62</span>.8
tparal_bandpw_02.64.01.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">60</span>.7  <span class="nv">wall</span><span class="o">=</span>         <span class="m">66</span>.4
</code></pre></div>
<p>As far as the timing is concerned, the best distributions are the ones
proposed in previous section: (16x4) seems to be the best one.
The prediction using <a class="wikilink codevar-wikilink" href="/variables/paral#autoparal">autoparal</a><strong>=1</strong> was pretty good.</p>
<p>Up to now, we have not learned more than before. We have so far only
considered the timing of 10 electronic steps.</p>
<p>However the <em>Locally Optimal Block Preconditioned Conjugate Gradient</em> algorithm (LOBPCG)
&mdash; used in ABINIT by default when <a class="wikilink codevar-wikilink" href="/variables/paral#paral_kgb">paral_kgb</a> == 1 &mdash; operates a diagonalization by block of eigenvectors.
Each block of eigenvectors is concurrently diagonalized by the <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a> processes,
one block after the other. When the <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a> value is modified, the size of the block
changes accordingly (it is exactly equal to <code>npband</code>), and the solutions of the eigensolver are modified.
One calculation can be the quickest if we look at the time needed by one iteration
but the slowest at the end because many more steps are performed.
In order to see this, we can have a look at the convergence rate at the end
of the calculations.
The last iterations of the SCF loops are:</p>
<div class="highlight"><pre><span></span><code>grep <span class="s2">&quot;ETOT  5&quot;</span> *.abo
tparal_bandpw_02.04.16.abo: ETOT  <span class="m">5</span>  -3654.9080524851    -1.683E-04 <span class="m">6</span>.622E-05 <span class="m">2</span>.509E-04
tparal_bandpw_02.08.08.abo: ETOT  <span class="m">5</span>  -3654.9081359132    -2.710E-04 <span class="m">6</span>.111E-05 <span class="m">2</span>.318E-04
tparal_bandpw_02.16.04.abo: ETOT  <span class="m">5</span>  -3654.9082768015    -6.727E-05 <span class="m">5</span>.277E-05 <span class="m">1</span>.490E-04
tparal_bandpw_02.32.02.abo: ETOT  <span class="m">5</span>  -3654.9081759902    -2.737E-04 <span class="m">2</span>.495E-05 <span class="m">1</span>.968E-04
tparal_bandpw_02.64.01.abo: ETOT  <span class="m">5</span>  -3654.9083410155    -1.580E-04 <span class="m">6</span>.181E-05 <span class="m">1</span>.440E-04
</code></pre></div>
<p>The last column indicates the convergence of the <strong>residual of the density</strong> (because we are using PAW, otherwise it would be the residual of the potential in norm-conserving).
You can see that this quantity is the smallest when <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a> is
the highest. This result is expected: the convergence is better when the size
of the block is the largest. But this <strong>best convergence</strong> is obtained for
the (64x1) distribution&hellip; when the <strong>worst timing</strong> is measured.</p>
<p>Already at the third iteration this behaviour is observed !
<div class="highlight"><pre><span></span><code>grep <span class="s2">&quot;ETOT  3&quot;</span> *.abo
tparal_bandpw_02.04.16.abo: ETOT  <span class="m">3</span>  -3654.8846449612    -2.877E-01 <span class="m">5</span>.690E-04 <span class="m">7</span>.055E-02
tparal_bandpw_02.08.08.abo: ETOT  <span class="m">3</span>  -3654.8848503583    -2.884E-01 <span class="m">8</span>.889E-04 <span class="m">7</span>.093E-02
tparal_bandpw_02.16.04.abo: ETOT  <span class="m">3</span>  -3654.8858758622    -2.798E-01 <span class="m">5</span>.805E-04 <span class="m">6</span>.792E-02
tparal_bandpw_02.32.02.abo: ETOT  <span class="m">3</span>  -3654.8866790037    -2.689E-01 <span class="m">6</span>.794E-05 <span class="m">6</span>.472E-02
tparal_bandpw_02.64.01.abo: ETOT  <span class="m">3</span>  -3654.8885890816    -2.528E-01 <span class="m">4</span>.112E-05 <span class="m">5</span>.918E-02
</code></pre></div></p>
<p>So, you face a dilemma. The calculation with the smallest number of iterations
(the best convergence) is not the best concerning the timing of one iteration
(the best efficiency), and vice versa&hellip; The best choice is a compromise.</p>
<p>In the following we will choose the (16x4) pair, because it
definitively offers more guarantees concerning the convergence and the timing.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You could check that the convergence is not changed when the <a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a> value is modified.</p>
</div>
<h2 id="even-more-sophisticated-bands-per-process-bandpp">Even more sophisticated: BANDs Per Process (bandpp)<a class="headerlink" href="#even-more-sophisticated-bands-per-process-bandpp" title="Permanent link">&para;</a></h2>
<p>We have seen in the previous section that the best convergence is obtained
when the size of the block is the largest. This size was exactly equal to the
<a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a> value. It was only possible to increase the block size by increasing
the number of MPI processes.</p>
<ul>
<li>
<p><em>Is it possible to do better?</em></p>
<p>The answer is <strong>yes</strong>! The input variable named <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> (BANDs Per Process)
enables to increase the block size without changing the number of processes
dedicated to bands.</p>
</li>
<li>
<p><em>How does this work?</em></p>
<p>As previoulsy, each block of bands is diagonalized by <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a> MPI processes in parallel.
But, if <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> is activated, each process handles <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> bands.
The block size is now equal to <code>npband x bandpp</code>. 
Accordingly the block size can be
modified (usually increased) by playing with the value of <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a>, without changing
the number of MPI processes.
Note that FFTs are still performed by the <a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a> MPI processes.</p>
</li>
</ul>
<p>In the following we use the same settings as previously, just performing more electronic step:</p>
<div class="highlight"><pre><span></span><code><span class="gi">+ nstep         10</span>
<span class="gi">+ bandpp        1 # This is the default value</span>
</code></pre></div>
<div class="text-center"><button id="uuid-615e78e9-802c-4042-891e-5d9738d70df0" class="md-button md-button--secondary"> View tests/tutoparal/Input/tparal_bandpw_03.abi </button></div>
<div id="uuid-b1403347-a55f-4bdb-b45a-2df9930c23a7" class="my_dialog" title="tests/tutoparal/Input/tparal_bandpw_03.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1">#############################################</span>
<span class="c1"># Gold with one vacancy (107 atoms of gold) #</span>
<span class="c1">#############################################</span>

<span class="c1"># Definition of the unit cell</span>
<span class="c1"># ===========================</span>
natom         <span class="m">107</span>

ntypat        <span class="m">1</span>

<span class="c1"># Species     </span>
<span class="c1">#             Au  </span>
znucl         
              <span class="m">79</span>  

typat         <span class="m">107</span>*1

acell         <span class="m">2</span>.30100000000000e+01   <span class="m">2</span>.30100000000000e+01   <span class="m">2</span>.30100000000000e+01

xred          
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.66415066890000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66415066890000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.32513080460000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.67486919540000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66415066890000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">1</span>.66415066890000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.32513080460000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01   <span class="m">3</span>.33140408550000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33584933110000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01   <span class="m">6</span>.66859591450000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.67486919540000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.33584933110000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01   <span class="m">3</span>.33140408550000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01   <span class="m">6</span>.66859591450000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.66415066890000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66415066890000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32513080460000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32916578170000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.33584933110000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01
              <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33140408550000e-01   <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33161164200000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.33161164200000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.33161164200000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.66838835800000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33584933110000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33140408550000e-01   <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32916578170000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.66838835800000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67486919540000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67083421830000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33584933110000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01
              <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.33584933110000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66859591450000e-01   <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66838835800000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66859591450000e-01   <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67083421830000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01

pp_dirpath   <span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span>
pseudos      <span class="s2">&quot;Pseudodojo_paw_pw_standard/Au.xml&quot;</span>

<span class="c1"># Electronic configuration</span>
<span class="c1"># ========================</span>
nband         <span class="m">640</span>
occopt        <span class="m">3</span> 
tsmear        <span class="m">0</span>.002
nkpt          <span class="m">1</span>

<span class="c1"># Convergence parameters</span>
<span class="c1"># ======================</span>
ecut          <span class="m">5</span>  <span class="c1"># Irrealist. Just to reduce the computation time in order to perform some benchmark</span>
pawecutdg     <span class="m">5</span>  <span class="c1"># Minimal value not converge to run with ecut</span>

<span class="c1"># Control of the SCF cycle</span>
<span class="c1"># ========================</span>
nstep         <span class="m">10</span>
toldfe        <span class="m">1</span>.e-7

<span class="c1"># Parallelization</span>
<span class="c1"># ===============</span>
paral_kgb     <span class="m">1</span>
npband        <span class="m">16</span>  <span class="c1"># Change this line according to the tutorial  </span>
bandpp        <span class="m">2</span>   <span class="c1"># Change this line according to the tutorial</span>
npfft         <span class="m">4</span>   <span class="c1"># Change this line according to the tutorial</span>
timopt        -3  <span class="c1"># Get timing information of the run in the *.abo (output) file</span>

<span class="c1">##############################################################</span>
<span class="c1"># This section is used only for regression testing of ABINIT #</span>
<span class="c1">##############################################################</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% [NCPU_64]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tparal_bandpw_03_MPI64.abo, tolnlines = 170, tolabs = 1.1e-3, tolrel = 1.0e-2 </span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 64</span>
<span class="c1">#%% nprocs_to_test = 64</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = F. Bottin, J. Bieder</span>
<span class="c1">#%% keywords = </span>
<span class="c1">#%% description = </span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-b1403347-a55f-4bdb-b45a-2df9930c23a7", "#uuid-615e78e9-802c-4042-891e-5d9738d70df0") }); </script>

<p>Copy the input file <code>tparal_bandpw_03.abi</code> then run ABINIT over 64 CPUs,
setting <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a><strong>=1</strong> and then <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a><strong>=2</strong>. The output files will be
named <code>tparal_bandpw_03.bandpp1.abo</code> and <code>tparal_bandpw_03.bandpp2.abo</code>, respectively. A
comparison of these two files shows that the convergence is better in the
second case.
Conclusion: for a given number of processors, it is possible to improve
the convergence by increasing bandpp.</p>
<p>However, as you can see, the CPU time per iteration
increases when <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> increases: </p>
<div class="highlight"><pre><span></span><code>grep Proc tparal_bandpw_03.bandpp1.abo tparal_bandpw_03.bandpp2.abo
tparal_bandpw_03.bandpp1.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">90</span>.0  <span class="nv">wall</span><span class="o">=</span>         <span class="m">95</span>.6
tparal_bandpw_03.bandpp2.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">90</span>.6  <span class="nv">wall</span><span class="o">=</span>         <span class="m">96</span>.4
</code></pre></div>
<p>Now look at the last iteration
<div class="highlight"><pre><span></span><code>grep <span class="s2">&quot;ETOT 10&quot;</span> tparal_bandpw_03.bandpp1.abo tparal_bandpw_03.bandpp2.abo
tparal_bandpw_03.bandpp1.abo: ETOT <span class="m">10</span>  -3654.9085401615    -2.882E-08 <span class="m">5</span>.100E-05 <span class="m">1</span>.247E-08
tparal_bandpw_03.bandpp2.abo: ETOT <span class="m">10</span>  -3654.9085401624    -3.744E-08 <span class="m">2</span>.632E-05 <span class="m">8</span>.003E-09
</code></pre></div></p>
<p>With <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a>=2, the calculation is more converged ! </p>
<p>We can also compare the (16x4)+<a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a><strong>=2</strong> distribution (16x2=32) with
the (32x2)+<a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a><strong>=1</strong> (32x1=32) one.
These 2 calculation have <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a>x<a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a>=32 (and <a class="wikilink codevar-wikilink" href="/variables/basic#nband">nband</a>x<a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a>=64).
Thus the convergence is the same !
Use the same input file and change it according to:</p>
<div class="highlight"><pre><span></span><code><span class="gd">- npband        16 </span>
<span class="gd">- bandpp        2  </span>
<span class="gd">- npfft         4  </span>
<span class="gi">+ npband        32 </span>
<span class="gi">+ bandpp        1  </span>
<span class="gi">+ npfft         2  </span>
</code></pre></div>
<p>Then run ABINIT over 64 MPI processes and name the output file <code>tparal_bandpw_03.32.02.bandpp1.abo</code> 
(This is one of the calculation you already did in the previous section but with <a class="wikilink codevar-wikilink" href="/variables/basic#nstep">nstep</a>=10 instead of 5).
Perform a <code>diff</code> between the two output files <code>tparal_bandpw_03.bandpp2.abo</code> 
and <code>tparal_bandpw_03.32.02.bandpp1.abo</code>. 
As you can see, the two calculations give exactly the same 
convergence rate. This was expected since, in both cases, the block sizes are equal (to 32)
and the number of FFT processors <a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a> does not affect the convergence.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>It is possible to adjust the distribution of processes, without changing the
convergence, by reducing <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a> and increasing <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> proportionally.</p>
</div>
<ul>
<li>
<p><em>Where does this CPU time consumption come from?</em></p>
<p>As previously explained, each MPI processes handles <code>bandpp</code> bands <strong>sequentially</strong>.
Thus the <em>sequential part</em> of the code increases when <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> increases.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Be carefull ! Depending on the number of plane waves and the the number of bands, increasing <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a>
can increase or decrease the cpu time ! Usually starting from 1, increasing <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> first decreases or maintains the cpu time,
and continuing increasing <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> will then increase the cpu time. 
Experience it by yourself (also depends on the hardware).</p>
</div>
<p>We will see in the next section how the use of <em>hybrid parallelism</em> can again improve this&hellip;</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Using only MPI parallelism, the timing of a single electronic step should theoretically increase
when <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> increases but the convergence rate is better.</p>
</div>
<h2 id="hybrid-parallelism-mpiopenmp">Hybrid parallelism: MPI+<em>OpenMP</em><a class="headerlink" href="#hybrid-parallelism-mpiopenmp" title="Permanent link">&para;</a></h2>
<p>In modern supercomputers, the computing units (CPU cores) are no more equally distributed.
They are grouped by <strong>nodes</strong> in which they share the same memory access.
In so-called <em>many-core</em> architecture CPU cores can be numerous on the same node.
You could continue to use them as if they were not sharing the memory (using MPI only)
but this is not the most efficient way to take benefit from the computer.
The best practice is to use <em>hybrid</em> parallelism, mixing distributed memory parallelism
(MPI, between nodes) and shared memory parallelism ( <em>OpenMP</em>, inside a node). As you will
see, this will also have consequences on the performance of the iterative diagonalization
algorithm (LOBPCG).
Let&rsquo;s try!</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>To use ABINIT with both MPI and OpenMP, make sure to compile abinit with
<code>--enable-openmp</code> to activate OpenMP support
<strong>and</strong> to link against a linear algebra library that support multithreading like <a href="https://software.intel.com/content/www/us/en/develop/tools/oneapi/components/onemkl/link-line-advisor.html">mkl</a></p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When we say &ldquo;set <code>OMP_NUM_THREADS=XX</code>&rdquo;, set your environment with <code>export OMP_NUM_THREADS=XX</code> for <code>bash</code> or <code>setenv OMP_NUM_THREADS XX</code> for <code>csh</code></p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When using threads, we have to impose <a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a> <strong>= 1</strong>.
The best is to suppress it from the input file.</p>
</div>
<p>The <code>tparal_bandpw_04.abi</code> input file has the parallelization set to <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a>=32 and <a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a>=2.
Thus it uses 32 MPI processes. We have set <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a>=2.</p>
<ol>
<li>Run ABINIT using 64 MPI processes and 1 <em>OpenMP</em> threads (set <code>OMP_NUM_THREADS=1</code>). Copy the output file to <code>tparal_bandpw_04.bandpp2.1thread.abo</code></li>
<li>Set <a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a>=1 and run ABINIT using 32 MPI processes and 2 <em>OpenMP</em> threads (set <code>OMP_NUM_THREADS=2</code>). Copy the output file to <code>tparal_bandpw_04.bandpp2.2thread.abo</code></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>32 MPI x 2 threads = 64 cores.</p>
</div>
<div class="text-center"><button id="uuid-dbe57488-f79f-4156-87ff-23b9f57dfde9" class="md-button md-button--secondary"> View tests/tutoparal/Input/tparal_bandpw_04.abi </button></div>
<div id="uuid-b7702151-7f41-4f6a-b9d4-2c189197ad4c" class="my_dialog" title="tests/tutoparal/Input/tparal_bandpw_04.abi" hidden><div><div class="codehilite small-text"><pre><span></span><span class="c1">#############################################</span>
<span class="c1"># Gold with one vacancy (107 atoms of gold) #</span>
<span class="c1">#############################################</span>

<span class="c1"># Definition of the unit cell</span>
<span class="c1"># ===========================</span>
natom         <span class="m">107</span>

ntypat        <span class="m">1</span>

<span class="c1"># Species     </span>
<span class="c1">#             Au  </span>
znucl         
              <span class="m">79</span>  

typat         <span class="m">107</span>*1

acell         <span class="m">2</span>.30100000000000e+01   <span class="m">2</span>.30100000000000e+01   <span class="m">2</span>.30100000000000e+01

xred          
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.66415066890000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66415066890000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.32513080460000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.67486919540000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66415066890000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">1</span>.66415066890000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.32513080460000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01   <span class="m">3</span>.33140408550000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33584933110000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01   <span class="m">6</span>.66859591450000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01   <span class="m">1</span>.63260959810000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">1</span>.63260959810000e-01   <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.67486919540000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.33584933110000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.66496231940000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01   <span class="m">3</span>.33140408550000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01   <span class="m">8</span>.36739040190000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01   <span class="m">6</span>.66859591450000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.66415066890000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66415066890000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32513080460000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32916578170000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.33584933110000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01
              <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33140408550000e-01   <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33161164200000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.33161164200000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.33161164200000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.66838835800000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33584933110000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.33140408550000e-01   <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">3</span>.32916578170000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.66838835800000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">1</span>.63260959810000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">1</span>.63260959810000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67486919540000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67083421830000e-01   <span class="m">1</span>.66496231940000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33584933110000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">3</span>.33140408550000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">8</span>.36739040190000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00   <span class="m">6</span>.66859591450000e-01
              <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">1</span>.66496231940000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.33584933110000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66859591450000e-01   <span class="m">3</span>.33140408550000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66838835800000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">3</span>.32916578170000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">3</span>.32916578170000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">8</span>.33503768060000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01   <span class="m">6</span>.67083421830000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01   <span class="m">6</span>.66971121710000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">1</span>.65969123860000e-01
              <span class="m">8</span>.36739040190000e-01   <span class="m">8</span>.36739040190000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.66859591450000e-01   <span class="m">6</span>.66859591450000e-01   <span class="m">0</span>.00000000000000e+00
              <span class="m">6</span>.67083421830000e-01   <span class="m">8</span>.33503768060000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.33503768060000e-01   <span class="m">6</span>.67083421830000e-01   <span class="m">5</span>.00000000000000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">3</span>.32135680110000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">3</span>.33028878290000e-01
              <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01   <span class="m">8</span>.34030876140000e-01
              <span class="m">8</span>.34030876140000e-01   <span class="m">8</span>.34030876140000e-01   <span class="m">6</span>.67864319890000e-01
              <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01   <span class="m">6</span>.66971121710000e-01

pp_dirpath   <span class="s2">&quot;</span><span class="nv">$ABI_PSPDIR</span><span class="s2">&quot;</span>
pseudos      <span class="s2">&quot;Pseudodojo_paw_pw_standard/Au.xml&quot;</span>

<span class="c1"># Electronic configuration</span>
<span class="c1"># ========================</span>
nband         <span class="m">640</span>
occopt        <span class="m">3</span> 
tsmear        <span class="m">0</span>.002
nkpt          <span class="m">1</span>

<span class="c1"># Convergence parameters</span>
<span class="c1"># ======================</span>
ecut          <span class="m">5</span>  <span class="c1"># Irrealist. Just to reduce the computation time in order to perform some benchmark</span>
pawecutdg     <span class="m">5</span>  <span class="c1"># Minimal value not converge to run with ecut</span>

<span class="c1"># Control of the SCF cycle</span>
<span class="c1"># ========================</span>
nstep         <span class="m">10</span>
toldfe        <span class="m">1</span>.e-7

<span class="c1"># Parallelization</span>
<span class="c1"># ===============</span>
paral_kgb     <span class="m">1</span>
npband        <span class="m">32</span>  <span class="c1"># Change this line according to the tutorial  </span>
bandpp        <span class="m">2</span>   <span class="c1"># Change this line according to the tutorial</span>
npfft         <span class="m">2</span>   <span class="c1"># Change this line according to the tutorial</span>
timopt        -3  <span class="c1"># Get timing information of the run in the *.abo (output) file</span>

<span class="c1">##############################################################</span>
<span class="c1"># This section is used only for regression testing of ABINIT #</span>
<span class="c1">##############################################################</span>
<span class="c1">#%%&lt;BEGIN TEST_INFO&gt;</span>
<span class="c1">#%% [setup]</span>
<span class="c1">#%% executable = abinit</span>
<span class="c1">#%% [NCPU_64]</span>
<span class="c1">#%% files_to_test = </span>
<span class="c1">#%%   tparal_bandpw_04_MPI64.abo, tolnlines = 170, tolabs = 1.1e-3, tolrel = 1.0e-2 </span>
<span class="c1">#%% [paral_info]</span>
<span class="c1">#%% max_nprocs = 64</span>
<span class="c1">#%% nprocs_to_test = 64</span>
<span class="c1">#%% [extra_info]</span>
<span class="c1">#%% authors = F. Bottin, J. Bieder</span>
<span class="c1">#%% keywords = </span>
<span class="c1">#%% description = </span>
<span class="c1">#%%&lt;END TEST_INFO&gt;</span>
</pre></div>
</div></div>

<script> $(function() { abidocs_jqueryui_dialog("#uuid-b7702151-7f41-4f6a-b9d4-2c189197ad4c", "#uuid-dbe57488-f79f-4156-87ff-23b9f57dfde9") }); </script>

<p>Let&rsquo;s have a look at the timings and compare them :</p>
<div class="highlight"><pre><span></span><code>grep Proc tparal_bandpw_04.bandpp2.1thread.abo tparal_bandpw_04.bandpp2.2thread.abo
tparal_bandpw_04.bandpp2.1thread.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">97</span>.0  <span class="nv">wall</span><span class="o">=</span>        <span class="m">102</span>.5
tparal_bandpw_04.bandpp2.2thread.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>        <span class="m">148</span>.3  <span class="nv">wall</span><span class="o">=</span>         <span class="m">86</span>.5
</code></pre></div>
<p>As you can wee, the new output file show a larger computing time for process 0: (cpu=....) disappointing?
Not really: you have to keep in mind that this timing is for one MPI process, adding the timings
of all the <em>OpenMP</em> tasks for this process. In the pure MPI case, we thus have <code>97 sec.</code> per task;
but in the <em>hybrid</em> case, we have <code>148/2=74 sec.</code> per task. 
As you can see, the &ldquo;wall= ....&rdquo; time is closer to thos value and is more or less the real user time.
Therefore with 2 threads, the run last 86s whereas with only 1 thread, the run last 102s !!</p>
<p>For the total 64 cores, the total cpu time used by ABINIT is <code>97x64=6208 sec.</code> in the MPI case, <code>74*32=2368 sec.</code> in the hybrid case.
This is much better!
The best way to confirm that is to look at the <em>Wall Time</em> (cumulated on all tasks) at the end
of the output file:</p>
<div class="highlight"><pre><span></span><code>grep Overall tparal_bandpw_04.bandpp2.1thread.abo tparal_bandpw_04.bandpp2.2thread.abo
tparal_bandpw_04.bandpp2.1thread.abo:+Overall <span class="nb">time</span> at end <span class="o">(</span>sec<span class="o">)</span> : <span class="nv">cpu</span><span class="o">=</span>       <span class="m">6419</span>.3  <span class="nv">wall</span><span class="o">=</span>       <span class="m">6555</span>.8
tparal_bandpw_04.bandpp2.2thread.abo:+Overall <span class="nb">time</span> at end <span class="o">(</span>sec<span class="o">)</span> : <span class="nv">cpu</span><span class="o">=</span>       <span class="m">4853</span>.7  <span class="nv">wall</span><span class="o">=</span>       <span class="m">2766</span>.3
</code></pre></div>
<p><em>How does ABINIT distribute the workload?</em></p>
<p>Each block of bands is diagonalized by <a class="wikilink codevar-wikilink" href="/variables/paral#npband">npband</a> MPI processes.
As previously, each process handles <code>bandpp</code> bands but now using the <em>OpenMP</em> tasks.
This means that <code>bandpp x npband</code> bands are computed in parallel using
<code>nthreads x npband</code> tasks (<code>bandpp</code> is supposed to be a multiple of <code>nthreads</code> to get the best performances).
This is in principle more efficient than in the pure MPI case.
Scalar products, matrix multiplications and other algebra operations are done in parallel by the <em>OpenMP</em> tasks (<a class="wikilink codevar-wikilink" href="/variables/paral#npfft">npfft</a> not used).
Doing so, the communications between MPI processes are also reduced !</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When using threads, <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> needs not to be a multiple of threads but it is <strong>highly recommanded</strong>!</p>
</div>
<ul>
<li><em>How do we choose the number of threads?</em></li>
</ul>
<p>Well, it strongly depends on the computer architecture and the case!</p>
<p>A computer is made of <em>nodes</em>. On each node, there are <em>sockets</em> containing a given number
  of CPU cores. All the cores of one <em>node</em> can access the RAM of all the <em>sockets</em> but this access
  is faster on their own <em>socket</em>. This is the origin of the famous <em>Non Uniform Memory
  Access</em> effect (NUMA). The number of <em>threads</em> has thus to be a divisor of the total
  number of cores in the node, but it is better to choose a divisor of the number of
  cores in a <em>socket</em>. Indeed ABINIT performance is very sensitive to NUMA effect.</p>
<p>In the following, let&rsquo;s learn how to use ABINIT on 4 <em>OpenMP</em> threads&hellip;
First we change the input file as follows:</p>
<div class="highlight"><pre><span></span><code><span class="gd">- npband        32</span>
<span class="gd">- bandpp        2</span>
<span class="gi">+ npband        16</span>
<span class="gi">+ bandpp        4</span>
</code></pre></div>
<p>Then we run ABINIT using 16 MPI processes and 4 threads (still 64 cores) and rename the output file <code>tparal_bandpw_04.bandpp4.4thread.abo</code>
And we compare the timing of this &ldquo;4 threads&rdquo; case with the previous &ldquo;2 threads&rdquo; case:</p>
<div class="highlight"><pre><span></span><code>grep Overall tparal_bandpw_04.bandpp2.2thread.abo tparal_bandpw_04.bandpp4.4thread.abo
tparal_bandpw_04.bandpp2.2thread.abo:+Overall <span class="nb">time</span> at end <span class="o">(</span>sec<span class="o">)</span> : <span class="nv">cpu</span><span class="o">=</span>       <span class="m">4853</span>.7  <span class="nv">wall</span><span class="o">=</span>       <span class="m">2766</span>.3
tparal_bandpw_04.bandpp4.4thread.abo:+Overall <span class="nb">time</span> at end <span class="o">(</span>sec<span class="o">)</span> : <span class="nv">cpu</span><span class="o">=</span>       <span class="m">4423</span>.2  <span class="nv">wall</span><span class="o">=</span>       <span class="m">1316</span>.8
</code></pre></div>
<p>We again have improved ABINIT performances!</p>
<ul>
<li><em>Can we do better?</em></li>
</ul>
<p>In principle, yes. As previously explained, we have to increase the block size for
  the LOBPCG diagonalization algorithm. </p>
<p>Let&rsquo;s try it, just changing the <a class="wikilink codevar-wikilink" href="/variables/paral#bandpp">bandpp</a> value in input file:</p>
<div class="highlight"><pre><span></span><code><span class="gd">- bandpp        4</span>
<span class="gi">+ bandpp        8</span>
</code></pre></div>
<p>We don&rsquo;t change here the number of threads (keeping 4).
And we obtain the following timings:</p>
<div class="highlight"><pre><span></span><code>grep Overall tparal_bandpw_04.bandpp4.4thread.abo tparal_bandpw_04.bandpp8.4thread.abo
tparal_bandpw_04.bandpp4.4thread.abo:+Overall time at end (sec) : cpu=       4423.2  wall=       1316.8
tparal_bandpw_04.bandpp8.4thread.abo:+Overall time at end (sec) : cpu=       4704.6  wall=       1417.3
</code></pre></div>
<p>The new settings do not give a better result&hellip;<strong>but</strong> for a few second you have a better convergence
<div class="highlight"><pre><span></span><code>grep &quot;ETOT 10&quot; tparal_bandpw_04.bandpp4.4thread.abo tparal_bandpw_04.bandpp8.4thread.abo
tparal_bandpw_04.bandpp4.4thread.abo: ETOT 10  -3654.9085401627    -5.105E-09 2.274E-05 1.673E-09
tparal_bandpw_04.bandpp8.4thread.abo: ETOT 10  -3654.9085401627    -1.376E-09 1.912E-05 6.053E-10
</code></pre></div>
Convergence has a cost&hellip;</p>
<p>To help you in choosing the distribution of processes/tasks, you can launch ABINIT with
the <a class="wikilink codevar-wikilink" href="/variables/paral#autoparal">autoparal</a><strong>=1</strong> and <a class="wikilink codevar-wikilink" href="/variables/paral#max_ncpus">max_ncpus</a> keywords. <a class="wikilink codevar-wikilink" href="/variables/paral#max_ncpus">max_ncpus</a> should be equal the
total number of targeted CPU cores, i.e. <code>nthreads x nMPI</code> and you should launch ABINIT on 1 MPI
process with <code>OMP_NUM_THREADS=nn</code>.
You can try this with <code>max_ncpus=64</code> and <code>OMP_NUM_THREADS=4</code>&hellip;</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The rules to distribute the workload are:</p>
<ul>
<li><code>npband x bandpp</code> (size of a block) should be maximized.
   It has to divide the number of bands (<code>nband</code>)</li>
<li><code>bandpp</code> should be a multiple of the number of <em>OpenMP</em> tasks</li>
<li><code>nband</code> has to be a multiple of <code>npband x bandpp</code>.</li>
<li>In any case, the ideal distribution is system dependent!</li>
</ul>
</div>
<h2 id="6-the-kgb-parallelization">6 The KGB parallelization<a class="headerlink" href="#6-the-kgb-parallelization" title="Permanent link">&para;</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For this part, a cluster was used and therefore the timing for <code>tparal_bandpw_03.abi</code> is different than the previous run in the previous section.
<strong>Use the same cluster to run <code>tparal_bandpw_03.abi</code> and the following run.</strong></p>
</div>
<p>Up to now, we only performed a &ldquo;GB&rdquo; parallelization, using 2 levels (bands and/or FFT).
If the system has more than 1 <em>k-point</em>, one can add a third level of parallelization
and perform a full &ldquo;KBG&rdquo; parallelization. There is no difficulty in
adding processes to this level.</p>
<p>To test the full parallelism, we restart
with the same input file as in <code>tparal_bandpw_03.abi</code> and add a denser <em>k-point</em> grid.
In this case, the system has 4 <em>k-points</em> in
the <em>irreducible Brillouin zone</em> (IBZ) so the calculation can be parallelized over (at most) 4 <em>k-points</em>
MPI processes. This is done using the <a class="wikilink codevar-wikilink" href="/variables/paral#np_spkpt">np_spkpt</a> input variable:</p>
<div class="highlight"><pre><span></span><code><span class="gd">-     nkpt          1</span>
<span class="gi">+    ngkpt         4 4 4</span>
<span class="gi">+ np_spkpt         4</span>
</code></pre></div>
<p>We need 4 times more processes than before, so run ABINIT over
256 CPU cores (only MPI) with the <code>tparal_bandpw_05.abi</code> file.
The timing obtained in the output file <code>tparal_bandpw_05.abo</code> and <code>tparal_bandpw_03.abo</code> are:</p>
<p><div class="highlight"><pre><span></span><code>grep Proc tparal_bandpw_03.abo tparal_bandpw_05.abo 
tparal_bandpw_03.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">44</span>.2  <span class="nv">wall</span><span class="o">=</span>         <span class="m">45</span>.5
tparal_bandpw_05.abo:- Proc.   <span class="m">0</span> individual <span class="nb">time</span> <span class="o">(</span>sec<span class="o">)</span>: <span class="nv">cpu</span><span class="o">=</span>         <span class="m">49</span>.3  <span class="nv">wall</span><span class="o">=</span>         <span class="m">50</span>.4
</code></pre></div>
They are quasi-identical !
This means that the scalability of ABINIT is quasi-linear on the <em>k-point</em> level.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>When you want to parallelize a calculation, begin by the k-point level, then
follow with the band level; then activate the FFT level or OpenMP threads.</p>
</div>
<p>Here, the timing obtained for the output <code>tparal_bandpw_05.abo</code> leads to a hypothetical
speedup of <span><span class="MathJax_Preview">45.5/50.4 \times 256\approx 231</span><script type="math/tex">45.5/50.4 \times 256\approx 231</script></span>, which is good, but not 256 as expected if the scaling was
linear. Indeed, the time needed here is slightly longer (5 sec. more) than
the one obtained in <code>tparal_bandpw_03.abo</code>.
To go further, let&rsquo;s compare the time spent in all the routines.
All the input files you have used contain the input variable <a class="wikilink codevar-wikilink" href="/variables/gstate#timopt">timopt</a>=-3 which activates the timing of different subparts of the run. 
You can find the results a the end of the output files before the references.</p>
<p>A first clue to undestand this not perfect speedup comes from the sequential code which is not parallelized. 
This sequential part is mainly (99%) done outside the &ldquo;vtowfk level&rdquo;.</p>
<p>Let&rsquo;s have a look at the time spend in the well parallelized subroutine <code>vtowfk</code>:</p>
<div class="highlight"><pre><span></span><code>grep -e <span class="s1">&#39;- vtowfk *[[:digit:]]&#39;</span> tparal_bandpw_03.abo tparal_bandpw_05.abo
tparal_bandpw_03.abo:- vtowfk                      <span class="m">2574</span>.132  <span class="m">89</span>.4   <span class="m">2589</span>.639  <span class="m">89</span>.3            <span class="m">640</span>                   <span class="m">0</span>.99       <span class="m">0</span>.99
tparal_bandpw_03.abo:- vtowfk                      <span class="m">2574</span>.132  <span class="m">89</span>.4   <span class="m">2589</span>.639  <span class="m">89</span>.3            <span class="m">640</span>                   <span class="m">0</span>.99       <span class="m">0</span>.99
tparal_bandpw_05.abo:- vtowfk                     <span class="m">10521</span>.057  <span class="m">82</span>.3  <span class="m">10595</span>.093  <span class="m">82</span>.3           <span class="m">2560</span>                   <span class="m">0</span>.99       <span class="m">0</span>.99
tparal_bandpw_05.abo:- vtowfk                     <span class="m">10521</span>.057  <span class="m">82</span>.3  <span class="m">10595</span>.093  <span class="m">82</span>.3           <span class="m">2560</span>                   <span class="m">0</span>.99       <span class="m">0</span>.99
</code></pre></div>
<p>We see that the KGB parallelization performs really well, since the wall time
spent within <code>vtowfk</code> is approximatively equal: <span><span class="MathJax_Preview">10521.057/256\approx 2574.132/64\approx 40</span><script type="math/tex">10521.057/256\approx 2574.132/64\approx 40</script></span>.
So, the speedup is quasi-linear in <code>vtowfk</code>. The problem comes from parts outside
<code>vtowfk</code> which are not parallelized and are responsible for the negligible
(100-82.3)% of time spent in sequential. These parts are no longer negligible
when you parallelize over hundreds of processors. The time spent in <code>vtowfk</code>
corresponds to 89.4% of the overall time when you don&rsquo;t parallelize over k-points,
and only 82.3% when you parallelize.</p>
<p>This behaviour is related to the <a href="https://en.wikipedia.org/wiki/Amdahl%27s_law">Amdhal&rsquo;s law</a>:</p>
<blockquote>
<p>The speedup of a program using multiple processes in parallel computing is
limited by the time needed for the sequential fraction of the program.</p>
</blockquote>
<p>For example, if a program needs 20 hours using a single processor core,
and a particular portion of 1 hour cannot be parallelized, while the remaining
portion of 19 hours (95%) can be parallelized, then regardless of how
many processor cores we have, the minimum execution time cannot be
less than that critical 1 hour. Hence the speedup is limited to 20.</p>
<p>In our case, the part above the loop over <em>k-points</em> in not parallelized by the
KGB parallelization. Even if this part is very small &mdash; less than 1% &mdash;
it determines an upper bound for the speedup.</p>
<!--
<sub><sup>To do in the future: discuss convergence, wfoptalg, nline</sup></sub>
-->
                
                  
                
              

<!--
Add dropdown button with toolbar (based on https://bootsnipp.com/snippets/featured/inbox-by-gmail)
and return to Top button (based on https://codepen.io/rdallaire/pen/apoyx)
-->
<div class="md-container">
  <div class="row">
    <div id="inbox">
      <div class="fab btn-group show-on-hover dropup">
        <div data-toggle="tooltip" data-placement="left" title="Menu" style="margin-left: 42px;">
          <button id="return-to-top" type="button" class="btn btn-primary btn-io dropdown-toggle" data-toggle="dropdown">
            <span class="fa-stack fa-2x">
               <i class="fa fa-circle fa-stack-2x fab-backdrop"></i>
               <i class="fa fa-chevron-up fa-stack-1x fa-inverse fab-primary"></i>
               <i class="fa fa-map-signs fa-stack-1x fa-inverse fab-secondary"></i>
            </span>
          </button>
        </div>
        <ul class="dropdown-menu dropdown-menu-right" role="menu">
        
        
          <li>
            <a href="https://docs.abinit.org/about/release-notes/"
               data-toggle="popover" data-tippy-content="About">
               <i class="fa fa-info-circle"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/developers/git_and_gitlab/"
               data-toggle="popover" data-tippy-content="Developers">
               <i class="fa fa-terminal"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/theory/geometry/"
               data-toggle="popover" data-tippy-content="Theory">
               <i class="fa fa-book"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/faq/configuration_and_compilation/"
               data-toggle="popover" data-tippy-content="FAQ">
               <i class="fa fa-graduation-cap"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/tutorial/"
               data-toggle="popover" data-tippy-content="Tutorials">
               <i class="fa fa-file-text-o"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/variables/"
               data-toggle="popover" data-tippy-content="Variables">
               <i class="fa fa-question"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/topics/features/"
               data-toggle="popover" data-tippy-content="Topics">
               <i class="fa fa-user-circle-o"></i>
            </a>
          </li>
        
          <li>
            <a href="https://docs.abinit.org/"
               data-toggle="popover" data-tippy-content="User Guides">
               <i class="fa "></i>
            </a>
          </li>
        
        </ul>
      </div>
    </div>
  </div>
</div>

              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <nav class="md-footer__inner md-grid" aria-label="Footer">
      
        <a href="../lwf_model/" class="md-footer__link md-footer__link--prev" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              lwf_model
            </div>
          </div>
        </a>
      
      
        <a href="../paral_gswvl/" class="md-footer__link md-footer__link--next" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              paral_wavelets
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
            <center>Abinit version b'10.2.3-dirty'</center>
        
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2020-2024 The Abinit Group
            
            (FB, JB, MT)
            
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
        
      </div>
      
  <div class="md-footer-social">
    
      
      
        
        
      
      <a href="https://github.com/abinit/abinit" target="_blank" rel="noopener" title="github.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://www.youtube.com/watch?v=gcbfb_Mteo4" target="_blank" rel="noopener" title="www.youtube.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="http://www.facebook.com/abinit.org" target="_blank" rel="noopener" title="www.facebook.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
      </a>
    
      
      
        
        
      
      <a href="https://twitter.com/hashtag/abinit" target="_blank" rel="noopener" title="twitter.com" class="md-footer-social__link">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
      </a>
    
  </div>

    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.tabs", "header.autohide"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}, "search": "../../assets/javascripts/workers/search.fb4a9340.min.js", "version": "b'10.2.3-dirty'"}</script>
    
    
      <script src="../../assets/javascripts/bundle.a1c7c35e.min.js"></script>
      
        <script src="../../extra_javascript/abidocs.js"></script>
      
    
  </body>
</html>